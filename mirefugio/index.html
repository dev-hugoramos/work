<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espacio Seguro - Apoyo Emocional</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        .app-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            position: relative;
        }

        .floating-circle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 20s infinite ease-in-out;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(-100px)
            }
        }

        .content-wrapper {
            position: relative;
            z-index: 10;
            padding: 2rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header-section {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px 20px 0 0;
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
        }

        .result-card {
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 20px;
        }

        .emotion-badge {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            font-weight: 600;
            margin: 10px 0;
        }

        .empathy-message {
            font-size: 1.3rem;
            line-height: 1.8;
            margin: 1.5rem 0;
        }

        .alert-help {
            background: rgba(255, 59, 48, 0.9);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .music-control {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .music-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="app-container">
            <div class="floating-circle" :style="{width:'200px',height:'200px',top:'10%',left:'5%'}"></div>
            <div class="floating-circle" :style="{width:'150px',height:'150px',top:'60%',right:'10%'}"></div>

            <div class="content-wrapper">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="header-section">
                                    <h1>üåü Espacio Seguro üåü</h1>
                                    <p class="mb-0">Un lugar donde tus emociones importan</p>
                                </div>
                                <div class="card-body p-4">
                                    <!-- Nombre -->
                                    <div v-if="!nameSubmitted">
                                        <label class="form-label fw-bold">¬øCu√°l es tu nombre?</label>
                                        <input v-model="name" type="text" class="form-control"
                                            placeholder="Escribe tu nombre..." @keyup.enter="submitName">
                                        <button @click="submitName" class="btn btn-primary w-100 mt-3"
                                            :disabled="!name.trim()">‚ú® Continuar</button>
                                    </div>

                                    <!-- Sentimientos -->
                                    <div v-if="nameSubmitted && !submitted">
                                        <p class="text-muted">üëã Hola, <strong>{{ name }}</strong></p>
                                        <label class="form-label fw-bold">¬øC√≥mo te sientes hoy?</label>
                                        <textarea v-model="feeling" class="form-control" rows="4"
                                            placeholder="Comparte lo que sientes..." ref="feelingInput"></textarea>
                                        <button @click="analyzeEmotion" class="btn btn-primary w-100 mt-3"
                                            :disabled="!feeling || loading">
                                            <span v-if="!loading">üí¨ Compartir mis sentimientos</span>
                                            <span v-else>Analizando...</span>
                                        </button>
                                    </div>

                                    <div v-if="loading" class="text-center py-4">
                                        <div class="spinner-border text-primary"></div>
                                        <p class="mt-2">Comprendiendo tus emociones...</p>
                                    </div>

                                    <!-- Resultado -->
                                    <div v-if="result && !loading">
                                        <div id="captureArea" class="result-card">
                                            <div class="text-center mb-3">
                                                <div class="emotion-badge">{{ emotionEmoji }} {{ emotionLabel }}</div>
                                            </div>
                                            <div class="empathy-message">{{ empathyMessage }}</div>
                                            <div class="text-center mt-4">
                                                <small>üíù Para: {{ name }}</small>
                                                <div v-if="quote" class="mt-2"><em>"{{ quote }}"</em></div>
                                            </div>
                                        </div>

                                        <div v-if="needsHelp" class="alert alert-help">
                                            <h5>ü§ó Hay gente aqu√≠ para ayudarte:</h5>
                                            <p>Si est√°s pasando por un momento dif√≠cil:</p>
                                            <ul>
                                                <li><strong>L√≠nea de la Vida (M√©xico):</strong> 800 911 2000</li>
                                                <li><strong>SAPTEL:</strong> 55 5259 8121</li>
                                            </ul>
                                        </div>

                                        <div class="text-center mt-4">
                                            <button @click="saveAsImage" class="btn btn-success btn-lg me-2">üì∏ Guardar
                                                frase</button>
                                            <button @click="reset" class="btn btn-outline-secondary btn-lg">üîÑ Nuevo
                                                sentimiento</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Footer -->
                            <div class="text-center text-white mt-4">
                                <p class="mb-2">üíª Desarrollado con ‚ù§Ô∏è por <strong>Hugo Ramos Espino</strong></p>
                                <a href="https://ko-fi.com/hugoramos" target="_blank" class="btn btn-sm" style="background: #FF5E5B; color: white; border-radius: 10px; text-decoration: none; padding: 8px 20px; font-weight: 600;">
                                    ‚òï Ap√≥yame en Ko-fi
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- M√∫sica -->
            <div class="music-control">
                <button @click="toggleMusic" class="music-btn">{{ isPlaying ? 'üîä' : 'üîá' }}</button>
            </div>
        </div>

        <!-- Audio din√°mico -->
        
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    name: '',
                    feeling: '',
                    submitted: false,
                    loading: false,
                    result: null,
                    isPlaying: false,
                    nameSubmitted: false,
                    emotionMap: {
                        'joy': { label: 'Alegr√≠a', emoji: 'üòä', type: 'positive' },
                        'sadness': { label: 'Tristeza', emoji: 'üò¢', type: 'negative' },
                        'anger': { label: 'Enojo', emoji: 'üò†', type: 'negative' },
                        'fear': { label: 'Miedo', emoji: 'üò®', type: 'negative' },
                        'love': { label: 'Amor', emoji: '‚ù§Ô∏è', type: 'positive' },
                        'surprise': { label: 'Sorpresa', emoji: 'üòÆ', type: 'neutral' },
                        'neutral': { label: 'Neutral', emoji: 'üòê', type: 'neutral' }
                    },
                    empathyPhrases: {
                        'joy': [
                            '¬°{name}, qu√© alegr√≠a tan inmensa saber que est√°s radiante! Tu energ√≠a positiva es contagiosa y el mundo necesita m√°s personas como t√∫. Estos momentos de felicidad son tesoros que debes guardar en tu coraz√≥n. Recuerda siempre que mereces cada instante de esta dicha, y que tu sonrisa tiene el poder de iluminar incluso los d√≠as m√°s oscuros de quienes te rodean. ¬°Sigue brillando con esa luz √∫nica que llevas dentro! üåü‚ú®',
                            '{name}, es maravilloso ver c√≥mo la alegr√≠a fluye a trav√©s de ti. Este sentimiento tan hermoso que experimentas es una muestra de tu capacidad para apreciar las cosas buenas de la vida. No permitas que nada ni nadie apague esa chispa especial que te caracteriza. Comparte esta felicidad con el mundo, porque tu energ√≠a positiva puede transformar vidas. Eres una bendici√≥n y mereces celebrar cada victoria, por peque√±a que parezca. ¬°Que esta alegr√≠a se multiplique en tu vida! üí´üåà',
                            '¬°Qu√© hermoso es verte as√≠ de feliz, {name}! La vida te est√° sonriendo y t√∫ le est√°s devolviendo la sonrisa. Este momento de plenitud que est√°s viviendo es el resultado de tu valent√≠a, tu perseverancia y tu capacidad de ver el lado bueno de las cosas. Guarda este sentimiento en tu memoria para esos d√≠as en que las cosas se pongan dif√≠ciles. Eres luz pura, y el universo conspira a tu favor. ¬°Sigue adelante con esa actitud tan inspiradora! üéâüíñ'
                        ],
                        'sadness': [
                            '{name}, mi coraz√≥n est√° contigo en este momento tan dif√≠cil. La tristeza que sientes es profunda y completamente v√°lida. No hay prisa por "estar bien", date el tiempo que necesites para procesar lo que est√°s viviendo. Llorar no es se√±al de debilidad, sino de valent√≠a al permitirte sentir. Aunque ahora parezca imposible, te prometo que este dolor no ser√° eterno. Poco a poco, encontrar√°s luz en medio de la oscuridad. Eres incre√≠blemente fuerte, incluso en tu vulnerabilidad. No est√°s solo/a en esto, hay personas que se preocupan por ti profundamente. Perm√≠tete recibir apoyo y amor. Los d√≠as mejores llegar√°n, paso a paso. üíôü§ó',
                            'Querido/a {name}, puedo sentir el peso de la tristeza que cargas en este momento, y quiero que sepas que est√° bien sentirse as√≠. No tienes que fingir estar bien para nadie. La vida nos presenta momentos oscuros, pero justamente esos momentos nos ense√±an sobre nuestra propia fortaleza. S√© gentil contigo mismo/a, date permiso para sanar a tu propio ritmo. Recuerda que esta tormenta pasar√°, y cuando lo haga, saldr√°s de ella siendo una versi√≥n m√°s sabia y resiliente de ti. Aunque no lo veas ahora, hay esperanza esper√°ndote. Mereces amor, comprensi√≥n y d√≠as llenos de paz. Te abrazo desde la distancia. üåôüíú',
                            '{name}, siento mucho que est√©s atravesando este momento de dolor. La tristeza puede sentirse como un oc√©ano interminable, pero quiero recordarte algo importante: has sobrevivido al 100% de tus d√≠as m√°s dif√≠ciles hasta ahora, y tambi√©n superar√°s este. No est√°s roto/a, est√°s sanando. Cada l√°grima que derramas es parte de tu proceso de liberaci√≥n. Date tiempo, date espacio, date amor. Busca apoyo en quienes te quieren y, si lo necesitas, no dudes en pedir ayuda profesional. Tu valor no disminuye por estar pasando un mal momento. Eres valioso/a, importante y profundamente amado/a. La luz volver√° a tu vida. üåÖüíï'
                        ],
                        'anger': [
                            '{name}, veo que est√°s sintiendo mucha frustraci√≥n y enojo, y quiero que sepas que tu emoci√≥n es completamente v√°lida. Tienes derecho a sentirte as√≠. Sin embargo, no permitas que este sentimiento te consuma por dentro. El enojo puede ser una fuerza destructiva o transformadora, y t√∫ tienes el poder de elegir. Te invito a respirar profundamente, a alejarte de la situaci√≥n si es posible, y a buscar formas saludables de canalizar esta energ√≠a. Quiz√°s escribir, hacer ejercicio, o hablar con alguien de confianza. Recuerda que responder con calma no significa que no est√©s molesto/a, significa que tienes el control. Eres m√°s grande que este momento de ira. üå¨Ô∏èüí™',
                            'Querido/a {name}, entiendo perfectamente tu frustraci√≥n y enojo. A veces la vida nos pone en situaciones que nos hacen hervir la sangre, y est√° bien reconocer esos sentimientos. Pero quiero recordarte algo: t√∫ no eres tu enojo, eres mucho m√°s que esta emoci√≥n temporal. Este sentimiento pasar√°, pero las decisiones que tomes mientras est√©s enojado/a podr√≠an tener consecuencias duraderas. T√≥mate un momento, respira, cuenta hasta diez si es necesario. Canaliza esa energ√≠a poderosa hacia algo constructivo. Tu paz mental es m√°s valiosa que tener la raz√≥n o vengarte. Eres capaz de transformar esta tormenta en crecimiento personal. üßò‚ú®',
                            '{name}, puedo percibir la intensidad de lo que est√°s sintiendo ahora mismo. El enojo es una emoci√≥n humana natural, pero no dejes que te controle. Tienes todo el derecho de estar molesto/a, pero tambi√©n tienes el poder de elegir c√≥mo responder. Preg√∫ntate: ¬øesta situaci√≥n seguir√° siendo importante en 5 a√±os? A veces, dar un paso atr√°s nos ayuda a ver las cosas con perspectiva. Busca formas saludables de liberar esa energ√≠a: camina, corre, grita en un lugar seguro si lo necesitas. Tu bienestar emocional es prioritario. Eres fuerte, sabio/a y capaz de navegar esta tormenta con gracia. üî•üïäÔ∏è'
                        ],
                        'fear': [
                            '{name}, reconocer tu miedo ya es un acto de valent√≠a incre√≠ble. El miedo es una emoci√≥n natural que nos protege, pero no debemos dejar que nos paralice. Lo que est√°s sintiendo es real y v√°lido, pero quiero que recuerdes algo fundamental: has enfrentado miedos antes y has salido victorioso/a. Eres m√°s fuerte de lo que crees. El miedo solo tiene el poder que t√∫ le das. Respira profundo, da un paso a la vez, y ver√°s c√≥mo ese monstruo que parece gigante se hace m√°s peque√±o con cada avance. No est√°s solo en esto. Conf√≠a en ti, conf√≠a en el proceso, y recuerda que al otro lado del miedo est√° tu crecimiento. ü¶ãüí´',
                            'Querido/a {name}, puedo sentir la ansiedad y el miedo que est√°s experimentando en este momento. Es una sensaci√≥n abrumadora, lo s√©, pero quiero que sepas algo: el miedo no define tu futuro, solo muestra que te importa. Ese temor que sientes es evidencia de que est√°s a punto de crecer, de expandirte m√°s all√° de tu zona de confort. Los guerreros m√°s valientes no son aquellos que no sienten miedo, sino aquellos que avanzan a pesar de √©l. T√∫ eres ese guerrero/a. Cada paso que das, por peque√±o que sea, es una victoria. Respira, centra tu mente, y recuerda que tienes todo lo necesario dentro de ti para superar esto. üåüüí™',
                            '{name}, el miedo que sientes ahora mismo es intenso, pero temporal. Quiero recordarte que algunos de tus mayores logros en la vida han venido despu√©s de momentos de gran temor. El miedo es solo una emoci√≥n, no es una profec√≠a. No te dice lo que va a pasar, solo te muestra lo mucho que te importa el resultado. Perm√≠tete sentir ese miedo, ac√©ptalo, pero no dejes que tome las decisiones por ti. Eres infinitamente m√°s poderoso/a que cualquier miedo. Busca apoyo si lo necesitas, habla sobre lo que sientes, y da un paso a la vez. La valent√≠a no es la ausencia de miedo, es actuar a pesar de √©l. Y t√∫ eres valiente. üåà‚ú®'
                        ],
                        'love': [
                            '¬°{name}, qu√© hermoso es el amor que est√°s sintiendo! Este sentimiento tan puro y poderoso que habita en tu coraz√≥n es uno de los regalos m√°s preciosos de la vida. El amor, en cualquiera de sus formas, tiene el poder de transformar, sanar y dar sentido a nuestra existencia. Cultiva ese amor con cuidado, prot√©gelo, pero tambi√©n comp√°rtelo sin miedo. Eres un ser lleno de luz y capacidad de amar profundamente, y eso es algo extraordinario. Perm√≠tete vivir este sentimiento plenamente, sin reservas, porque el amor verdadero siempre merece ser celebrado. Que este amor te llene de alegr√≠a y te inspire a ser la mejor versi√≥n de ti mismo/a. ‚ù§Ô∏èüíï',
                            '{name}, el amor que sientes en este momento es m√°gico y transformador. Ya sea amor rom√°ntico, familiar, de amistad o amor propio, este sentimiento es la fuerza m√°s poderosa del universo. Alimenta ese amor con acciones conscientes, palabras amables y presencia genuina. Recuerda que amar tambi√©n es un acto de valent√≠a, porque nos hace vulnerables, pero tambi√©n nos hace humanos. Disfruta cada momento, cada conversaci√≥n, cada gesto de afecto. Eres digno/a de dar y recibir amor abundante. Que este sentimiento siga creciendo en tu vida. üåπ‚ú®',
                            '¬°Qu√© maravilloso, {name}! El amor que est√°s experimentando es la evidencia de que tu coraz√≥n est√° abierto y dispuesto a conectar profundamente. Este sentimiento tan especial merece ser honrado y cuidado. No tengas miedo de expresar lo que sientes, de mostrar tu vulnerabilidad, porque ah√≠ es donde reside la verdadera fuerza del amor. Ya sea amor hacia otra persona, hacia tu familia, tus amigos, o hacia ti mismo/a, este sentimiento es el que da color y significado a nuestra existencia. Perm√≠tete vivirlo plenamente, sin miedo al futuro. El presente es tuyo, y est√° lleno de amor. üíñüåü'
                        ],
                        'surprise': [
                            '¬°{name}, qu√© emocionante es vivir momentos inesperados! La vida tiene una forma m√°gica de sorprendernos justo cuando menos lo esperamos. Esta sensaci√≥n de asombro que est√°s sintiendo es un recordatorio hermoso de que la vida est√° llena de posibilidades infinitas. Mant√©n tu mente abierta y tu coraz√≥n receptivo a todo lo que el universo tiene preparado para ti. Las mejores historias que contaremos en el futuro son aquellas que nunca vimos venir. Disfruta de esta sorpresa, aprende de ella, y perm√≠tele que agregue un nuevo matiz a tu historia personal. Eres parte de algo m√°s grande y maravilloso. ‚ú®üéâ',
                            'Querido/a {name}, las sorpresas son los condimentos que hacen que la vida sea verdaderamente interesante. Este momento inesperado que est√°s viviendo tiene algo que ense√±arte, algo que mostrarte sobre ti mismo/a o sobre el mundo. Abraza lo desconocido con curiosidad y entusiasmo. La vida es impredecible, y esa es precisamente su belleza. Cada sorpresa es una oportunidad para crecer, para ver las cosas desde una nueva perspectiva, para expandir tu comprensi√≥n del mundo. Disfruta este momento, docum√©ntalo en tu memoria, y permite que enriquezca tu experiencia de vida. ¬°El universo siempre tiene algo extraordinario preparado para ti! üåàüí´',
                            '{name}, ¬°qu√© hermoso es dejarse sorprender por la vida! Este momento inesperado que est√°s experimentando es una prueba de que la vida siempre encuentra formas de maravillarnos. Mant√©n esa capacidad de asombro, esa chispa de curiosidad que te caracteriza. Las personas que pueden sorprenderse son aquellas que permanecen j√≥venes de esp√≠ritu sin importar su edad. Aprovecha esta energ√≠a renovada para hacer algo diferente, para atreverte a explorar nuevos caminos. La sorpresa es el recordatorio del universo de que siempre hay m√°s por descubrir, m√°s por vivir, m√°s por amar. ¬°Disfruta el viaje! üéä‚ú®'
                        ],
                        'neutral': [
                            '{name}, los d√≠as tranquilos tambi√©n tienen su propia belleza y prop√≥sito. No todos los d√≠as tienen que ser una monta√±a rusa de emociones, y est√° perfectamente bien sentirse en equilibrio. Este momento de calma que est√°s experimentando te permite reflexionar, recargar energ√≠as y prepararte para lo que venga. Aprovecha esta serenidad para agradecer lo que tienes, organizar tus pensamientos y conectar contigo mismo/a. La vida no siempre necesita grandes emociones para ser significativa; a veces, la quietud es suficiente para nutrir el alma. üåøüïäÔ∏è',
                            'Querido/a {name}, el sentirse neutral o tranquilo es un regalo que muchas veces pasa desapercibido. Estos momentos de equilibrio nos permiten respirar, reorganizar nuestras ideas y disfrutar de la vida sin presi√≥n. Aprovecha esta oportunidad para conectar contigo mismo, para hacer algo que te guste y que te nutra internamente. La neutralidad no es ausencia de emoci√≥n, es un espacio para la claridad y la introspecci√≥n. Date permiso de disfrutarlo sin culpa ni expectativas. üíõ‚ú®',
                            '{name}, estar en un estado neutral es una forma de equilibrio que la vida nos ofrece. No todos los momentos necesitan ser intensos para ser valiosos. Esta calma te permite observar tu entorno, cuidar de ti mismo/a y planificar tus pr√≥ximos pasos con claridad. La neutralidad es un momento de pausa, de preparaci√≥n, de reflexi√≥n. Disfruta de este estado, aprecia la tranquilidad y usa este tiempo para fortalecerte y conectar contigo y con los que te rodean. üå∏üïäÔ∏è'
                        ]
                    }
                }
            },
            computed: {
                emotionLabel() {
                    if (!this.result) return '';
                    return this.emotionMap[this.result.emotion]?.label || 'Emoci√≥n';
                },
                emotionEmoji() {
                    if (!this.result) return '';
                    return this.emotionMap[this.result.emotion]?.emoji || 'üòä';
                },
                empathyMessage() {
                    if (!this.result) return '';
                    const message = this.generateEmpathyResponse(this.result.emotion, this.feeling);
                    //this.speakMessage(message);
                    return message;
                },
                needsHelp() {
                    if (!this.result) return false;
                    const negativeEmotions = ['sadness', 'anger', 'fear'];
                    return negativeEmotions.includes(this.result.emotion) && this.result.score > 0.7;
                }
            },
            methods: {
                detectEmotionFromKeywords(text) {
                    const lowerText = text.toLowerCase();
                    const keywords = {
                        'sadness': ['triste', 'tristeza', 'deprimido', 'depresi√≥n', 'lloro', 'llorar', 'llorando', 'dolor', 'p√©rdida', 'muerte', 'muri√≥', 'falleci√≥', 'duelo', 'solo', 'sola', 'soledad', 'vac√≠o', 'desesperado', 'desesperanza', 'melancol√≠a', 'nostalgia', 'perd√≠', 'extra√±o', 'falta', 'abandonado', 'desanimado'],
                        'anger': ['enojado', 'enojo', 'rabia', 'furioso', 'furia', 'molesto', 'irritado', 'frustrado', 'frustraci√≥n', 'odio', 'coraje', 'enfadado', 'ira', 'injusto', 'injusticia', 'harto', 'cansado de', 'indignado', 'maldito', 'cabr√≥n', 'no puedo m√°s', 'me da rabia'],
                        'fear': ['miedo', 'temor', 'asustado', 'aterrado', 'p√°nico', 'ansiedad', 'ansioso', 'nervioso', 'preocupado', 'preocupaci√≥n', 'terror', 'angustia', 'angustiado', 'inseguro', 'inseguridad', 'amenaza', 'peligro', 'tengo miedo', 'me asusta', 'vulnerable'],
                        'joy': ['feliz', 'felicidad', 'alegre', 'alegr√≠a', 'contento', 'emocionado', 'emoci√≥n', 'dichoso', 'euf√≥rico', 'radiante', 'maravilloso', 'genial', 'incre√≠ble', 'fant√°stico', 'excelente', 'bendecido', 'afortunado', 'agradecido', 'celebrar', 'logr√©', 'consegu√≠'],
                        'love': ['amor', 'amo', 'quiero', 'cari√±o', 'te amo', 'enamorado', 'enamorada', 'adorar', 'adoro', 'pasi√≥n', 'afecto', 'rom√°ntico', 'coraz√≥n', 'beso', 'abrazo', 'pareja', 'novio', 'novia', 'esposo', 'esposa', 'familia']
                    };
                    let scores = { 'sadness': 0, 'anger': 0, 'fear': 0, 'joy': 0, 'love': 0, 'neutral': 0 };
                    for (let emotion in keywords) {
                        keywords[emotion].forEach(keyword => {
                            if (lowerText.includes(keyword)) scores[emotion] += 1;
                        });
                    }
                    let maxScore = 0;
                    let detectedEmotion = 'neutral';
                    for (let emotion in scores) {
                        if (scores[emotion] > maxScore) {
                            maxScore = scores[emotion];
                            detectedEmotion = emotion;
                        }
                    }
                    return { emotion: detectedEmotion, score: maxScore > 0 ? 0.8 : 0.3 };
                },
                submitName() {
                    if (!this.name.trim()) { alert('Por favor ingresa tu nombre'); return; }
                    this.nameSubmitted = true;
                    this.$nextTick(() => { if (this.$refs.feelingInput) this.$refs.feelingInput.focus(); });
                },
                async analyzeEmotion() {
                    if (!this.feeling.trim()) { alert('Por favor comparte c√≥mo te sientes'); return; }
                    this.loading = true;
                    this.submitted = true;
                    try {
                        const keywordResult = this.detectEmotionFromKeywords(this.feeling);
                        if (keywordResult.score >= 0.8) {
                            this.result = keywordResult;
                        } else {
                            try {
                                const response = await fetch("https://api-inference.huggingface.co/models/finiteautomata/beto-emotion-analysis", {
                                    method: "POST",
                                    headers: { "Content-Type": "application/json" },
                                    body: JSON.stringify({ inputs: this.feeling })
                                });
                                const data = await response.json();
                                if (data && data[0] && data[0].length > 0) {
                                    const topEmotion = data[0].reduce((prev, curr) => (prev.score > curr.score) ? prev : curr);
                                    this.result = (keywordResult.score > topEmotion.score * 0.5) ? keywordResult : { emotion: topEmotion.label.toLowerCase(), score: topEmotion.score };
                                } else { this.result = keywordResult.score > 0 ? keywordResult : { emotion: 'neutral', score: 0.5 }; }
                            } catch { this.result = keywordResult.score > 0 ? keywordResult : { emotion: 'neutral', score: 0.5 }; }
                        }
                    } catch (e) { console.error(e); this.result = { emotion: 'neutral', score: 0.5 }; }
                    finally { this.loading = false; }
                },
                generateEmpathyResponse(emotion, text) {
                    const name = this.name || "Amigo/a";
                    text = text.toLowerCase();
                    const isLoss = text.includes("muri√≥") || text.includes("falleci√≥") || text.includes("muerte");
                    const isAnxiety = text.includes("ansiedad") || text.includes("preocupado") || text.includes("nervioso");
                    const isLonely = text.includes("solo") || text.includes("sola") || text.includes("soledad");
                    const isSelfDoubt = text.includes("in√∫til") || text.includes("no sirvo") || text.includes("no valgo");
                    if (isLoss) return `${name}, lamento profundamente tu p√©rdida. Perder a alguien tan importante deja un vac√≠o imposible de llenar, y est√° bien que necesites llorar. No te obligues a estar bien a√∫n. El amor que sientes por esa persona no se borra con el tiempo; se transforma en recuerdos que te acompa√±ar√°n siempre. Perm√≠tete sentir, recordar, llorar. No est√°s solo en esto. üíú`;
                    if (isAnxiety) return `${name}, puedo sentir tu ansiedad y preocupaci√≥n. Respira. No tienes que tener todas las respuestas hoy. Date permiso de ir paso a paso, de cuidarte, de soltar un poco el control. A veces, lo mejor que puedes hacer es simplemente estar aqu√≠, en el presente. Tienes m√°s fortaleza de la que crees. üåø`;
                    if (isLonely) return `${name}, la soledad puede sentirse pesada, pero no significa que est√©s olvidado. Hay personas que te valoran m√°s de lo que imaginas. Usa este momento para reconectarte contigo mismo, y recuerda que pedir compa√±√≠a o apoyo no te hace d√©bil. Eres valioso, incluso cuando nadie lo dice en voz alta. üí´`;
                    if (isSelfDoubt) return `${name}, entiendo que te sientas as√≠, pero por favor recuerda: tu valor no depende de lo que hagas o logres. Ya eres suficiente solo por ser t√∫. Tienes una historia, una luz, una esencia que nadie m√°s posee. No te compares, no te castigues. Perm√≠tete descansar, sanar, creer en ti otra vez. ‚ù§Ô∏è`;
                    const phrases = this.empathyPhrases[emotion] || this.empathyPhrases['neutral'];
                    return phrases[Math.floor(Math.random() * phrases.length)].replace('{name}', name);
                },
                toggleMusic() {
                    const audio = this.$refs.bgMusic;
                    if (this.isPlaying) { audio.pause(); } else { audio.play().catch(e => console.log(e)); }
                    this.isPlaying = !this.isPlaying;
                },
                async saveAsImage() {
                    const element = document.getElementById('captureArea');
                    try {
                        const canvas = await html2canvas(element, { backgroundColor: null, scale: 2 });
                        const link = document.createElement('a');
                        link.download = `espacio-seguro-${this.name}.jpg`;
                        link.href = canvas.toDataURL('image/jpeg', 0.95);
                        link.click();
                    } catch (e) { console.error(e); alert('Hubo un error al guardar la imagen.'); }
                },
                reset() {
                    this.feeling = '';
                    this.submitted = false;
                    this.result = null;
                    this.$nextTick(() => { if (this.$refs.feelingInput) this.$refs.feelingInput.focus(); });
                },
                speakMessage(message) {
                    if (!('speechSynthesis' in window)) return;
                    const utterance = new SpeechSynthesisUtterance(message);
                    utterance.lang = 'es-ES';
                    window.speechSynthesis.cancel();
                    window.speechSynthesis.speak(utterance);
                }
            }
        }).mount('#app');
    </script>

</body>

</html>
