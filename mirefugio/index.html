<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Espacio Seguro - Una aplicaciÃ³n inteligente de apoyo emocional que te ayuda a entender y procesar tus sentimientos con IA avanzada">
    <meta name="keywords" content="salud mental, emociones, bienestar, apoyo emocional, terapia, IA, inteligencia artificial">
    <meta name="author" content="Hugo Ramos Espino">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Espacio Seguro - Apoyo Emocional Inteligente">
    <meta property="og:description" content="Una aplicaciÃ³n inteligente que te ayuda a entender y procesar tus emociones con anÃ¡lisis de IA avanzado">
    <meta property="og:type" content="website">
    <title>Espacio Seguro - Apoyo Emocional Inteligente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        .app-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 30%, #f093fb 70%, #f5576c 100%);
            position: relative;
        }

        .floating-circle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 20s infinite ease-in-out;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(-100px)
            }
        }

        .content-wrapper {
            position: relative;
            z-index: 10;
            padding: 2rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header-section {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px 20px 0 0;
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
        }

        .result-card {
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 20px;
        }

        .emotion-badge {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            font-weight: 600;
            margin: 10px 0;
        }

        .empathy-message {
            font-size: 1.3rem;
            line-height: 1.8;
            margin: 1.5rem 0;
        }

        .alert-help {
            background: rgba(255, 59, 48, 0.9);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .music-control {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .music-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            visibility: hidden;
        }

        .fade {
            transition: opacity 0.6s ease;
            opacity: 1;
        }

        .fade-leave-active {
            opacity: 0;
        }

        .insights-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .insights-header h5 {
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .insights-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
        }

        .insight-item {
            margin-bottom: 0.8rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .insight-item:last-child {
            margin-bottom: 0;
        }

        .emotion-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
        }

        .history-preview {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .emotion-timeline {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .emotion-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .emotion-dot:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        .smart-suggestions {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .suggestion-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            transition: transform 0.2s ease;
        }

        .suggestion-item:hover {
            transform: translateX(5px);
        }

        .suggestion-item:last-child {
            margin-bottom: 0;
        }

        .volume-control {
            margin-top: 10px;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* Mejoras para mÃ³viles */
        @media (max-width: 768px) {
            .app-container {
                padding: 0;
            }

            .content-wrapper {
                padding: 1rem;
            }

            .header-section h1 {
                font-size: 2rem;
            }

            .card {
                margin: 0;
                border-radius: 15px;
            }

            .card-body {
                padding: 1.5rem !important;
            }

            .btn-lg {
                font-size: 1rem;
                padding: 0.75rem 1rem;
            }

            .music-control {
                bottom: 20px;
                right: 20px;
            }

            .music-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .empathy-message {
                font-size: 1.1rem;
                line-height: 1.6;
            }

            .insights-card {
                padding: 1rem;
            }

            .smart-suggestions {
                padding: 1rem;
            }

            .result-card {
                padding: 1.5rem;
            }

            .floating-circle {
                display: none;
            }

            .btn {
                margin-bottom: 0.5rem;
                width: 100%;
            }

            .btn + .btn {
                margin-left: 0;
            }
        }

        @media (max-width: 480px) {
            .header-section h1 {
                font-size: 1.8rem;
            }

            .empathy-message {
                font-size: 1rem;
            }

            .insights-card,
            .smart-suggestions {
                padding: 0.8rem;
            }

            .music-control {
                bottom: 15px;
                right: 15px;
            }

            .music-btn {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
        }

        /* Animaciones suaves */
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        }

        .btn {
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .suggestion-item {
            transition: all 0.3s ease;
        }

        .suggestion-item:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.3);
        }

        /* Mejoras de accesibilidad */
        .btn:focus,
        input:focus,
        textarea:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        /* Efectos de carga mejorados */
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3rem;
        }

        /* Mejoras visuales adicionales */
        .emotion-badge {
            font-size: 1.1rem;
            padding: 12px 24px;
        }

        .confidence-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
        }

        .confidence-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A, #FFD700);
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="app-container">
            <div class="floating-circle" :style="{width:'200px',height:'200px',top:'10%',left:'5%'}"></div>
            <div class="floating-circle" :style="{width:'150px',height:'150px',top:'60%',right:'10%'}"></div>

            <div class="content-wrapper">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="header-section">
                                    <h1>ğŸŒŸ Mi Refugio ğŸŒŸ</h1>
                                    <p class="mb-0">Un lugar donde tus emociones importan</p>
                                </div>
                                <div class="card-body p-4">
                                    <!-- Nombre -->
                                    <div v-if="!nameSubmitted">
                                        <label class="form-label fw-bold" for="nameInput">Â¿CuÃ¡l es tu nombre?</label>
                                        <input v-model="name" type="text" class="form-control" id="nameInput"
                                            placeholder="Escribe tu nombre..." @keyup.enter="submitName"
                                            aria-describedby="nameHelp" autocomplete="name">
                                        <div id="nameHelp" class="form-text">Tu nombre nos ayuda a personalizar tu experiencia</div>
                                        <button @click="submitName" class="btn btn-primary w-100 mt-3"
                                            :disabled="!name.trim()" aria-label="Continuar con el nombre ingresado">âœ¨ Continuar</button>
                                    </div>

                                    <!-- Sentimientos -->
                                    <div v-if="nameSubmitted && !submitted">
                                        <p class="text-muted">ğŸ‘‹ Hola, <strong>{{ name }}</strong></p>
                                        <label class="form-label fw-bold" for="feelingInput">Â¿CÃ³mo te sientes hoy?</label>
                                        <textarea v-model="feeling" class="form-control" rows="4" id="feelingInput"
                                            placeholder="Comparte lo que sientes..." ref="feelingInput"
                                            aria-describedby="feelingHelp" autocomplete="off"></textarea>
                                        <div id="feelingHelp" class="form-text">Describe libremente tus emociones, pensamientos o experiencias</div>
                                        <button @click="analyzeEmotion" class="btn btn-primary w-100 mt-3"
                                            :disabled="!feeling || loading" aria-label="Analizar mis sentimientos">
                                            <span v-if="!loading">ğŸ’¬ Compartir mis sentimientos</span>
                                            <span v-else>Analizando...</span>
                                        </button>
                                    </div>

                                    <div v-if="loading" class="text-center py-4">
                                        <div class="spinner-border text-primary"></div>
                                        <p class="mt-2">Comprendiendo tus emociones...</p>
                                    </div>

                                    <!-- Resultado -->
                                    <div v-if="result && !loading">
                                        <div id="captureArea" class="result-card">
                                            <div class="text-center mb-3">
                                                <div class="emotion-badge">
                                                    <span class="emotion-indicator" :style="{backgroundColor: emotionMap[result.emotion]?.color}"></span>
                                                    {{ emotionEmoji }} {{ emotionLabel }}
                                                    <span v-if="result.confidence" class="ms-2">
                                                        ({{ Math.round(result.confidence * 100) }}% confianza)
                                                    </span>
                                                </div>
                                                <div v-if="result.confidence" class="confidence-bar mt-2">
                                                    <div class="confidence-fill" :style="{width: (result.confidence * 100) + '%'}"></div>
                                                </div>
                                            </div>
                                            <div class="empathy-message" v-if="result && !loading"
                                                v-bind:class="{ fade: fadeEffect }">
                                                {{ empathyMessage }}
                                            </div>
                                            <div class="text-center mt-4">
                                                <small>ğŸ’ Para: {{ name }}</small>
                                                <div v-if="quote" class="mt-2"><em>"{{ quote }}"</em></div>
                                                
                                                <!-- Vista previa del historial emocional -->
                                                <div v-if="userHistory.length > 1" class="history-preview">
                                                    <small><strong>ğŸ“Š Tu viaje emocional reciente:</strong></small>
                                                    <div class="emotion-timeline">
                                                        <div v-for="(entry, index) in userHistory.slice(-7)" 
                                                             :key="index"
                                                             class="emotion-dot" 
                                                             :style="{backgroundColor: emotionMap[entry.emotion]?.color}"
                                                             :title="`${emotionMap[entry.emotion]?.label} - ${new Date(entry.timestamp).toLocaleDateString()}`">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Insights Inteligentes -->
                                        <div v-if="aiInsights" class="insights-card mt-3">
                                            <div class="insights-header">
                                                <h5>ğŸ§  Insights sobre tu bienestar emocional</h5>
                                            </div>
                                            <div class="insights-content">
                                                <div class="insight-item">
                                                    <strong>Tendencia:</strong> 
                                                    <span :class="{
                                                        'text-success': aiInsights.trend === 'positivo',
                                                        'text-warning': aiInsights.trend === 'neutral',
                                                        'text-danger': aiInsights.trend === 'negativo'
                                                    }">
                                                        {{ aiInsights.trend === 'positivo' ? 'ğŸ“ˆ Mejorando' : 
                                                           aiInsights.trend === 'negativo' ? 'ğŸ“‰ Necesita atenciÃ³n' : 'ğŸ“Š Estable' }}
                                                    </span>
                                                </div>
                                                <div v-if="aiInsights.pattern" class="insight-item">
                                                    <strong>PatrÃ³n emocional:</strong> 
                                                    <span :class="{
                                                        'text-success': aiInsights.pattern === 'mejorando',
                                                        'text-warning': aiInsights.pattern === 'estable',
                                                        'text-danger': aiInsights.pattern === 'empeorando'
                                                    }">
                                                        {{ aiInsights.pattern === 'mejorando' ? 'âœ¨ Progreso positivo' : 
                                                           aiInsights.pattern === 'empeorando' ? 'âš ï¸ Considera apoyo' : 'ğŸ”„ Estable' }}
                                                    </span>
                                                </div>
                                                <div class="insight-item">
                                                    <strong>RecomendaciÃ³n personalizada:</strong>
                                                    <p class="mb-0">{{ aiInsights.recommendation }}</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div v-if="needsHelp" class="alert alert-help">
                                            <h5>ğŸ¤— Hay gente aquÃ­ para ayudarte:</h5>
                                            <p>Si estÃ¡s pasando por un momento difÃ­cil, no estÃ¡s solo/a:</p>
                                            <ul>
                                                <li><strong>ğŸš¨ Emergencias:</strong> 911</li>
                                                <li><strong>LÃ­nea de la Vida (MÃ©xico):</strong> 800 911 2000</li>
                                                <li><strong>SAPTEL (Suicidio):</strong> 55 5259 8121</li>
                                                <li><strong>Crisis Text Line:</strong> EnvÃ­a HOME al 741741</li>
                                                <li><strong>LÃ­nea de Ayuda PsicolÃ³gica:</strong> 800 911 2000</li>
                                            </ul>
                                            <p class="mb-0"><strong>Recuerda:</strong> Tu vida tiene valor. Busca ayuda profesional. No tienes que enfrentar esto solo/a. ğŸ’™</p>
                                        </div>

                                        <!-- Sugerencias Inteligentes -->
                                        <div v-if="result" class="smart-suggestions">
                                            <h6>ğŸ’¡ Sugerencias personalizadas para ti</h6>
                                            <div class="suggestion-item" v-for="suggestion in getSmartSuggestions()" :key="suggestion">
                                                {{ suggestion }}
                                            </div>
                                        </div>

                                        <div class="text-center mt-4">
                                            <button @click="saveAsImage" class="btn btn-success btn-lg me-2">ğŸ“¸ Guardar
                                                frase</button>
                                            <button @click="reset" class="btn btn-outline-secondary btn-lg">ğŸ”„ Nuevo
                                                sentimiento</button>
                                            <button v-if="userHistory.length > 0" @click="viewHistory" class="btn btn-info btn-lg ms-2">ğŸ“ˆ Ver historial</button>
                                        </div>
                                        
                                        <!-- Opciones adicionales -->
                                        <div v-if="userHistory.length > 0" class="text-center mt-3">
                                            <small class="text-muted">Opciones de privacidad:</small><br>
                                            <button @click="exportData" class="btn btn-sm btn-outline-primary me-2">ğŸ“ Exportar datos</button>
                                            <button @click="clearHistory" class="btn btn-sm btn-outline-danger">ğŸ—‘ï¸ Limpiar historial</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Footer -->
                            <div class="text-center text-white mt-4">
                                <p class="mb-2">ğŸ’» Desarrollado con â¤ï¸ por <strong>Hugo Ramos Espino</strong></p>
                                <a href="https://ko-fi.com/hugoramos" target="_blank" class="btn btn-sm"
                                    style="background: #FF5E5B; color: white; border-radius: 10px; text-decoration: none; padding: 8px 20px; font-weight: 600;">
                                    â˜• ApÃ³yame en Ko-fi
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MÃºsica -->
            <div class="music-control">
                <button @click="toggleMusic" class="music-btn" :title="isPlaying ? 'Pausar mÃºsica' : 'Reproducir mÃºsica'">
                    {{ isPlaying ? 'ğŸ”Š' : 'ğŸ”‡' }}
                </button>
                <div class="volume-control" v-if="isPlaying">
                    <input type="range" min="0" max="1" step="0.1" v-model="musicVolume" 
                           @input="updateVolume" class="volume-slider" title="Control de volumen">
                </div>
            </div>
        </div>

        <!-- Audio dinÃ¡mico -->
        <audio ref="bgMusic" :src="currentMusic" loop preload="auto" @ended="nextTrack"></audio>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    name: '',
                    feeling: '',
                    submitted: false,
                    loading: false,
                    result: null,
                    isPlaying: false,
                    nameSubmitted: false,
                    userHistory: JSON.parse(localStorage.getItem('emotionHistory') || '[]'),
                    currentMood: JSON.parse(localStorage.getItem('currentMood') || 'null'),
                    aiInsights: null,
                    currentMusic: null,
                    musicVolume: 0.3,
                    emotionMap: {
                        'joy': { label: 'AlegrÃ­a', emoji: 'ğŸ˜Š', type: 'positive', color: '#FFD93D' },
                        'sadness': { label: 'Tristeza', emoji: 'ğŸ˜¢', type: 'negative', color: '#6C7CE7' },
                        'anger': { label: 'Enojo', emoji: 'ğŸ˜ ', type: 'negative', color: '#FF6B6B' },
                        'fear': { label: 'Miedo', emoji: 'ğŸ˜¨', type: 'negative', color: '#8E44AD' },
                        'love': { label: 'Amor', emoji: 'â¤ï¸', type: 'positive', color: '#FF69B4' },
                        'surprise': { label: 'Sorpresa', emoji: 'ğŸ˜®', type: 'neutral', color: '#FFA726' },
                        'neutral': { label: 'Neutral', emoji: 'ğŸ˜', type: 'neutral', color: '#95A5A6' },
                        'anxiety': { label: 'Ansiedad', emoji: 'ğŸ˜°', type: 'negative', color: '#9B59B6' },
                        'excitement': { label: 'EmociÃ³n', emoji: 'ğŸ¤©', type: 'positive', color: '#F39C12' },
                        'gratitude': { label: 'Gratitud', emoji: 'ğŸ™', type: 'positive', color: '#27AE60' },
                        'confusion': { label: 'ConfusiÃ³n', emoji: 'ğŸ˜•', type: 'neutral', color: '#95A5A6' },
                        'hopeful': { label: 'Esperanza', emoji: 'ğŸŒŸ', type: 'positive', color: '#3498DB' }
                    },
                    empathyPhrases: {
                        'joy': [
                            'Â¡{name}, quÃ© alegrÃ­a tan inmensa saber que estÃ¡s radiante! Tu energÃ­a positiva es contagiosa y el mundo necesita mÃ¡s personas como tÃº. Estos momentos de felicidad son tesoros que debes guardar en tu corazÃ³n. Recuerda siempre que mereces cada instante de esta dicha, y que tu sonrisa tiene el poder de iluminar incluso los dÃ­as mÃ¡s oscuros de quienes te rodean. Â¡Sigue brillando con esa luz Ãºnica que llevas dentro! ğŸŒŸâœ¨',
                            '{name}, es maravilloso ver cÃ³mo la alegrÃ­a fluye a travÃ©s de ti. Este sentimiento tan hermoso que experimentas es una muestra de tu capacidad para apreciar las cosas buenas de la vida. No permitas que nada ni nadie apague esa chispa especial que te caracteriza. Comparte esta felicidad con el mundo, porque tu energÃ­a positiva puede transformar vidas. Eres una bendiciÃ³n y mereces celebrar cada victoria, por pequeÃ±a que parezca. Â¡Que esta alegrÃ­a se multiplique en tu vida! ğŸ’«ğŸŒˆ',
                            'Â¡QuÃ© hermoso es verte asÃ­ de feliz, {name}! La vida te estÃ¡ sonriendo y tÃº le estÃ¡s devolviendo la sonrisa. Este momento de plenitud que estÃ¡s viviendo es el resultado de tu valentÃ­a, tu perseverancia y tu capacidad de ver el lado bueno de las cosas. Guarda este sentimiento en tu memoria para esos dÃ­as en que las cosas se pongan difÃ­ciles. Eres luz pura, y el universo conspira a tu favor. Â¡Sigue adelante con esa actitud tan inspiradora! ğŸ‰ğŸ’–'
                        ],
                        'sadness': [
                            '{name}, mi corazÃ³n estÃ¡ contigo en este momento tan difÃ­cil. La tristeza que sientes es profunda y completamente vÃ¡lida. No hay prisa por "estar bien", date el tiempo que necesites para procesar lo que estÃ¡s viviendo. Llorar no es seÃ±al de debilidad, sino de valentÃ­a al permitirte sentir. Aunque ahora parezca imposible, te prometo que este dolor no serÃ¡ eterno. Poco a poco, encontrarÃ¡s luz en medio de la oscuridad. Eres increÃ­blemente fuerte, incluso en tu vulnerabilidad. No estÃ¡s solo/a en esto, hay personas que se preocupan por ti profundamente. PermÃ­tete recibir apoyo y amor. Los dÃ­as mejores llegarÃ¡n, paso a paso. ğŸ’™ğŸ¤—',
                            'Querido/a {name}, puedo sentir el peso de la tristeza que cargas en este momento, y quiero que sepas que estÃ¡ bien sentirse asÃ­. No tienes que fingir estar bien para nadie. La vida nos presenta momentos oscuros, pero justamente esos momentos nos enseÃ±an sobre nuestra propia fortaleza. SÃ© gentil contigo mismo/a, date permiso para sanar a tu propio ritmo. Recuerda que esta tormenta pasarÃ¡, y cuando lo haga, saldrÃ¡s de ella siendo una versiÃ³n mÃ¡s sabia y resiliente de ti. Aunque no lo veas ahora, hay esperanza esperÃ¡ndote. Mereces amor, comprensiÃ³n y dÃ­as llenos de paz. Te abrazo desde la distancia. ğŸŒ™ğŸ’œ',
                            '{name}, siento mucho que estÃ©s atravesando este momento de dolor. La tristeza puede sentirse como un ocÃ©ano interminable, pero quiero recordarte algo importante: has sobrevivido al 100% de tus dÃ­as mÃ¡s difÃ­ciles hasta ahora, y tambiÃ©n superarÃ¡s este. No estÃ¡s roto/a, estÃ¡s sanando. Cada lÃ¡grima que derramas es parte de tu proceso de liberaciÃ³n. Date tiempo, date espacio, date amor. Busca apoyo en quienes te quieren y, si lo necesitas, no dudes en pedir ayuda profesional. Tu valor no disminuye por estar pasando un mal momento. Eres valioso/a, importante y profundamente amado/a. La luz volverÃ¡ a tu vida. ğŸŒ…ğŸ’•'
                        ],
                        'anger': [
                            '{name}, veo que estÃ¡s sintiendo mucha frustraciÃ³n y enojo, y quiero que sepas que tu emociÃ³n es completamente vÃ¡lida. Tienes derecho a sentirte asÃ­. Sin embargo, no permitas que este sentimiento te consuma por dentro. El enojo puede ser una fuerza destructiva o transformadora, y tÃº tienes el poder de elegir. Te invito a respirar profundamente, a alejarte de la situaciÃ³n si es posible, y a buscar formas saludables de canalizar esta energÃ­a. QuizÃ¡s escribir, hacer ejercicio, o hablar con alguien de confianza. Recuerda que responder con calma no significa que no estÃ©s molesto/a, significa que tienes el control. Eres mÃ¡s grande que este momento de ira. ğŸŒ¬ï¸ğŸ’ª',
                            'Querido/a {name}, entiendo perfectamente tu frustraciÃ³n y enojo. A veces la vida nos pone en situaciones que nos hacen hervir la sangre, y estÃ¡ bien reconocer esos sentimientos. Pero quiero recordarte algo: tÃº no eres tu enojo, eres mucho mÃ¡s que esta emociÃ³n temporal. Este sentimiento pasarÃ¡, pero las decisiones que tomes mientras estÃ©s enojado/a podrÃ­an tener consecuencias duraderas. TÃ³mate un momento, respira, cuenta hasta diez si es necesario. Canaliza esa energÃ­a poderosa hacia algo constructivo. Tu paz mental es mÃ¡s valiosa que tener la razÃ³n o vengarte. Eres capaz de transformar esta tormenta en crecimiento personal. ğŸ§˜âœ¨',
                            '{name}, puedo percibir la intensidad de lo que estÃ¡s sintiendo ahora mismo. El enojo es una emociÃ³n humana natural, pero no dejes que te controle. Tienes todo el derecho de estar molesto/a, pero tambiÃ©n tienes el poder de elegir cÃ³mo responder. PregÃºntate: Â¿esta situaciÃ³n seguirÃ¡ siendo importante en 5 aÃ±os? A veces, dar un paso atrÃ¡s nos ayuda a ver las cosas con perspectiva. Busca formas saludables de liberar esa energÃ­a: camina, corre, grita en un lugar seguro si lo necesitas. Tu bienestar emocional es prioritario. Eres fuerte, sabio/a y capaz de navegar esta tormenta con gracia. ğŸ”¥ğŸ•Šï¸'
                        ],
                        'fear': [
                            '{name}, reconocer tu miedo ya es un acto de valentÃ­a increÃ­ble. El miedo es una emociÃ³n natural que nos protege, pero no debemos dejar que nos paralice. Lo que estÃ¡s sintiendo es real y vÃ¡lido, pero quiero que recuerdes algo fundamental: has enfrentado miedos antes y has salido victorioso/a. Eres mÃ¡s fuerte de lo que crees. El miedo solo tiene el poder que tÃº le das. Respira profundo, da un paso a la vez, y verÃ¡s cÃ³mo ese monstruo que parece gigante se hace mÃ¡s pequeÃ±o con cada avance. No estÃ¡s solo en esto. ConfÃ­a en ti, confÃ­a en el proceso, y recuerda que al otro lado del miedo estÃ¡ tu crecimiento. ğŸ¦‹ğŸ’«',
                            'Querido/a {name}, puedo sentir la ansiedad y el miedo que estÃ¡s experimentando en este momento. Es una sensaciÃ³n abrumadora, lo sÃ©, pero quiero que sepas algo: el miedo no define tu futuro, solo muestra que te importa. Ese temor que sientes es evidencia de que estÃ¡s a punto de crecer, de expandirte mÃ¡s allÃ¡ de tu zona de confort. Los guerreros mÃ¡s valientes no son aquellos que no sienten miedo, sino aquellos que avanzan a pesar de Ã©l. TÃº eres ese guerrero/a. Cada paso que das, por pequeÃ±o que sea, es una victoria. Respira, centra tu mente, y recuerda que tienes todo lo necesario dentro de ti para superar esto. ğŸŒŸğŸ’ª',
                            '{name}, el miedo que sientes ahora mismo es intenso, pero temporal. Quiero recordarte que algunos de tus mayores logros en la vida han venido despuÃ©s de momentos de gran temor. El miedo es solo una emociÃ³n, no es una profecÃ­a. No te dice lo que va a pasar, solo te muestra lo mucho que te importa el resultado. PermÃ­tete sentir ese miedo, acÃ©ptalo, pero no dejes que tome las decisiones por ti. Eres infinitamente mÃ¡s poderoso/a que cualquier miedo. Busca apoyo si lo necesitas, habla sobre lo que sientes, y da un paso a la vez. La valentÃ­a no es la ausencia de miedo, es actuar a pesar de Ã©l. Y tÃº eres valiente. ğŸŒˆâœ¨'
                        ],
                        'love': [
                            'Â¡{name}, quÃ© hermoso es el amor que estÃ¡s sintiendo! Este sentimiento tan puro y poderoso que habita en tu corazÃ³n es uno de los regalos mÃ¡s preciosos de la vida. El amor, en cualquiera de sus formas, tiene el poder de transformar, sanar y dar sentido a nuestra existencia. Cultiva ese amor con cuidado, protÃ©gelo, pero tambiÃ©n compÃ¡rtelo sin miedo. Eres un ser lleno de luz y capacidad de amar profundamente, y eso es algo extraordinario. PermÃ­tete vivir este sentimiento plenamente, sin reservas, porque el amor verdadero siempre merece ser celebrado. Que este amor te llene de alegrÃ­a y te inspire a ser la mejor versiÃ³n de ti mismo/a. â¤ï¸ğŸ’•',
                            '{name}, el amor que sientes en este momento es mÃ¡gico y transformador. Ya sea amor romÃ¡ntico, familiar, de amistad o amor propio, este sentimiento es la fuerza mÃ¡s poderosa del universo. Alimenta ese amor con acciones conscientes, palabras amables y presencia genuina. Recuerda que amar tambiÃ©n es un acto de valentÃ­a, porque nos hace vulnerables, pero tambiÃ©n nos hace humanos. Disfruta cada momento, cada conversaciÃ³n, cada gesto de afecto. Eres digno/a de dar y recibir amor abundante. Que este sentimiento siga creciendo en tu vida. ğŸŒ¹âœ¨',
                            'Â¡QuÃ© maravilloso, {name}! El amor que estÃ¡s experimentando es la evidencia de que tu corazÃ³n estÃ¡ abierto y dispuesto a conectar profundamente. Este sentimiento tan especial merece ser honrado y cuidado. No tengas miedo de expresar lo que sientes, de mostrar tu vulnerabilidad, porque ahÃ­ es donde reside la verdadera fuerza del amor. Ya sea amor hacia otra persona, hacia tu familia, tus amigos, o hacia ti mismo/a, este sentimiento es el que da color y significado a nuestra existencia. PermÃ­tete vivirlo plenamente, sin miedo al futuro. El presente es tuyo, y estÃ¡ lleno de amor. ğŸ’–ğŸŒŸ'
                        ],
                        'surprise': [
                            'Â¡{name}, quÃ© emocionante es vivir momentos inesperados! La vida tiene una forma mÃ¡gica de sorprendernos justo cuando menos lo esperamos. Esta sensaciÃ³n de asombro que estÃ¡s sintiendo es un recordatorio hermoso de que la vida estÃ¡ llena de posibilidades infinitas. MantÃ©n tu mente abierta y tu corazÃ³n receptivo a todo lo que el universo tiene preparado para ti. Las mejores historias que contaremos en el futuro son aquellas que nunca vimos venir. Disfruta de esta sorpresa, aprende de ella, y permÃ­tele que agregue un nuevo matiz a tu historia personal. Eres parte de algo mÃ¡s grande y maravilloso. âœ¨ğŸ‰',
                            'Querido/a {name}, las sorpresas son los condimentos que hacen que la vida sea verdaderamente interesante. Este momento inesperado que estÃ¡s viviendo tiene algo que enseÃ±arte, algo que mostrarte sobre ti mismo/a o sobre el mundo. Abraza lo desconocido con curiosidad y entusiasmo. La vida es impredecible, y esa es precisamente su belleza. Cada sorpresa es una oportunidad para crecer, para ver las cosas desde una nueva perspectiva, para expandir tu comprensiÃ³n del mundo. Disfruta este momento, documÃ©ntalo en tu memoria, y permite que enriquezca tu experiencia de vida. Â¡El universo siempre tiene algo extraordinario preparado para ti! ğŸŒˆğŸ’«',
                            '{name}, Â¡quÃ© hermoso es dejarse sorprender por la vida! Este momento inesperado que estÃ¡s experimentando es una prueba de que la vida siempre encuentra formas de maravillarnos. MantÃ©n esa capacidad de asombro, esa chispa de curiosidad que te caracteriza. Las personas que pueden sorprenderse son aquellas que permanecen jÃ³venes de espÃ­ritu sin importar su edad. Aprovecha esta energÃ­a renovada para hacer algo diferente, para atreverte a explorar nuevos caminos. La sorpresa es el recordatorio del universo de que siempre hay mÃ¡s por descubrir, mÃ¡s por vivir, mÃ¡s por amar. Â¡Disfruta el viaje! ğŸŠâœ¨'
                        ],
                        'neutral': [
                            '{name}, los dÃ­as tranquilos tambiÃ©n tienen su propia belleza y propÃ³sito. No todos los dÃ­as tienen que ser una montaÃ±a rusa de emociones, y estÃ¡ perfectamente bien sentirse en equilibrio. Este momento de calma que estÃ¡s experimentando te permite reflexionar, recargar energÃ­as y prepararte para lo que venga. Aprovecha esta serenidad para agradecer lo que tienes, organizar tus pensamientos y conectar contigo mismo/a. La vida no siempre necesita grandes emociones para ser significativa; a veces, la quietud es suficiente para nutrir el alma. ğŸŒ¿ğŸ•Šï¸',
                            'Querido/a {name}, el sentirse neutral o tranquilo es un regalo que muchas veces pasa desapercibido. Estos momentos de equilibrio nos permiten respirar, reorganizar nuestras ideas y disfrutar de la vida sin presiÃ³n. Aprovecha esta oportunidad para conectar contigo mismo, para hacer algo que te guste y que te nutra internamente. La neutralidad no es ausencia de emociÃ³n, es un espacio para la claridad y la introspecciÃ³n. Date permiso de disfrutarlo sin culpa ni expectativas. ğŸ’›âœ¨',
                            '{name}, estar en un estado neutral es una forma de equilibrio que la vida nos ofrece. No todos los momentos necesitan ser intensos para ser valiosos. Esta calma te permite observar tu entorno, cuidar de ti mismo/a y planificar tus prÃ³ximos pasos con claridad. La neutralidad es un momento de pausa, de preparaciÃ³n, de reflexiÃ³n. Disfruta de este estado, aprecia la tranquilidad y usa este tiempo para fortalecerte y conectar contigo y con los que te rodean. ğŸŒ¸ğŸ•Šï¸'
                        ],
                        'anxiety': [
                            '{name}, puedo sentir la ansiedad que te estÃ¡ acompaÃ±ando en este momento. Es una sensaciÃ³n intensa y real, y quiero que sepas que no estÃ¡s solo en esto. La ansiedad es como una tormenta en tu mente, pero como todas las tormentas, pasarÃ¡. Respira profundamente conmigo: inhala lentamente por la nariz, siente cÃ³mo se llena tu pecho, y exhala suavemente por la boca. Repite esto contigo mismo. Eres mÃ¡s fuerte que esta ansiedad, aunque ahora no lo sientas asÃ­. Date permiso de ir paso a paso, sin presionarte. ğŸŒŠğŸ’™',
                            'Querido/a {name}, la ansiedad puede sentirse como un laberinto sin salida, pero quiero recordarte algo importante: has enfrentado momentos difÃ­ciles antes y has salido adelante. Esta ansiedad que sientes ahora es temporal, aunque parezca eterna. Intenta la tÃ©cnica 5-4-3-2-1: nombra 5 cosas que puedes ver, 4 que puedes tocar, 3 que puedes oÃ­r, 2 que puedes oler, 1 que puedes saborear. Esto te ayudarÃ¡ a anclarte en el presente. Eres valiente por reconocer lo que sientes. ğŸŒ¸ğŸ’ª',
                            '{name}, siento mucho que estÃ©s experimentando ansiedad en este momento. Es una emociÃ³n muy intensa y puede sentirse abrumadora. Quiero que sepas que es completamente normal sentirse asÃ­, y que no hay nada malo en ti por experimentar ansiedad. Prueba hacer ejercicios de respiraciÃ³n, caminar un poco, o hacer algo que te guste. Si la ansiedad persiste, no dudes en buscar ayuda profesional. Tu bienestar mental es tan importante como tu salud fÃ­sica. Mereces paz y tranquilidad. ğŸ•Šï¸ğŸ’œ'
                        ],
                        'excitement': [
                            'Â¡{name}, quÃ© maravilloso es sentir esta emociÃ³n tan intensa! La emociÃ³n es como un fuego que ilumina tu alma y te llena de energÃ­a positiva. Aprovecha esta sensaciÃ³n para hacer algo que realmente te apasione. Cuando estamos emocionados, somos capaces de lograr cosas increÃ­bles. Canaliza esta energÃ­a hacia tus objetivos, tus sueÃ±os, hacia lo que realmente te importa. La vida te estÃ¡ regalando este momento de entusiasmo, Â¡disfrÃºtalo al mÃ¡ximo! ğŸš€âœ¨',
                            '{name}, la emociÃ³n que sientes ahora mismo es pura magia. Es esa sensaciÃ³n que nos recuerda que estamos vivos y que la vida estÃ¡ llena de posibilidades infinitas. No dejes que esta energÃ­a se desperdicie. Ãšsala para crear, para explorar, para atreverte a hacer algo nuevo. La emociÃ³n es combustible para el alma, y tÃº tienes un tanque lleno. Â¡QuÃ© hermoso es verte asÃ­ de radiante! ğŸŒŸğŸ’«',
                            'Â¡QuÃ© hermoso verte tan emocionado/a, {name}! Esta energÃ­a positiva que irradias es contagiosa y transformadora. La emociÃ³n es uno de los regalos mÃ¡s preciosos de la vida, y cuando la sentimos, todo parece posible. Aprovecha este momento para hacer algo que te haga feliz, para compartir tu alegrÃ­a con otros, o para dar el siguiente paso hacia algo que realmente deseas. Tu entusiasmo es tu superpoder. Â¡Ãšsalo sabiamente! ğŸ‰ğŸ’–'
                        ],
                        'gratitude': [
                            '{name}, quÃ© hermoso es sentir gratitud en tu corazÃ³n. Esta emociÃ³n tan pura y transformadora tiene el poder de cambiar completamente tu perspectiva de la vida. La gratitud no solo es un sentimiento, es una prÃ¡ctica que puede transformar tu mundo. Cada vez que sientes gratitud, estÃ¡s reconociendo la abundancia que ya existe en tu vida. Sigue cultivando este sentimiento, compÃ¡rtelo con otros, y verÃ¡s cÃ³mo se multiplica la belleza a tu alrededor. Eres un ser lleno de luz y apreciaciÃ³n. ğŸ™âœ¨',
                            'Querido/a {name}, la gratitud que sientes ahora mismo es como una semilla que has plantado en tu corazÃ³n y que estÃ¡ floreciendo. Es hermoso ver cÃ³mo reconoces las bendiciones en tu vida, por pequeÃ±as que parezcan. La gratitud nos conecta con lo esencial, con lo que realmente importa. Escribe sobre lo que agradeces, comparte tu gratitud con quienes amas, y observa cÃ³mo esta prÃ¡ctica transforma tu dÃ­a a dÃ­a. Eres un ejemplo de cÃ³mo vivir con el corazÃ³n abierto. ğŸŒ¸ğŸ’',
                            '{name}, sentir gratitud es uno de los regalos mÃ¡s hermosos que puedes darte a ti mismo/a. Esta emociÃ³n te conecta con la abundancia de la vida y te recuerda todo lo bueno que ya tienes. La gratitud es como un imÃ¡n que atrae mÃ¡s cosas buenas hacia ti. No solo estÃ¡s agradecido/a, estÃ¡s practicando una forma de vida que te llena de paz y satisfacciÃ³n. Sigue reconociendo las pequeÃ±as y grandes bendiciones que te rodean. Eres un ser lleno de sabidurÃ­a y amor. ğŸŒºğŸ’•'
                        ],
                        'confusion': [
                            '{name}, es completamente normal sentirse confundido/a a veces. La confusiÃ³n no es un signo de debilidad, sino una seÃ±al de que estÃ¡s procesando informaciÃ³n nueva o navegando por una situaciÃ³n compleja. Date permiso de no tener todas las respuestas inmediatamente. A veces, la claridad llega cuando menos la esperamos. TÃ³mate el tiempo que necesites para reflexionar, haz preguntas si puedes, y recuerda que no tienes que resolver todo de una vez. La confusiÃ³n es solo una parada temporal en tu camino hacia la comprensiÃ³n. ğŸŒ«ï¸ğŸ’™',
                            'Querido/a {name}, la confusiÃ³n puede sentirse como estar perdido en una niebla, pero quiero recordarte que las mejores respuestas a menudo vienen despuÃ©s de momentos de incertidumbre. No te presiones por entender todo de inmediato. A veces, la vida nos presenta situaciones que requieren tiempo para procesar. Habla con alguien de confianza, escribe tus pensamientos, o simplemente date espacio para sentir sin necesidad de entender. La claridad llegarÃ¡ cuando estÃ©s listo/a para recibirla. ğŸŒ…ğŸ¤”',
                            '{name}, sentir confusiÃ³n es parte natural del proceso de aprendizaje y crecimiento. No significa que hayas hecho algo mal o que no seas lo suficientemente inteligente. De hecho, reconocer que estÃ¡s confundido/a muestra que eres consciente y que te importa encontrar la respuesta correcta. Date tiempo, sÃ© paciente contigo mismo/a, y no tengas miedo de pedir ayuda si la necesitas. Cada momento de confusiÃ³n es una oportunidad para aprender algo nuevo sobre ti y el mundo que te rodea. ğŸ§­ğŸ’«'
                        ],
                        'hopeful': [
                            'Â¡{name}, quÃ© hermoso es sentir esperanza en tu corazÃ³n! La esperanza es como una estrella que brilla incluso en la noche mÃ¡s oscura. Es esa chispa de luz que nos recuerda que siempre hay posibilidades, que siempre hay algo por lo que luchar. Tu esperanza no es ingenua, es valiente. Es la decisiÃ³n consciente de creer en un futuro mejor, incluso cuando el presente es difÃ­cil. MantÃ©n esa esperanza viva, alimÃ©ntala con acciones pequeÃ±as cada dÃ­a, y verÃ¡s cÃ³mo se convierte en realidad. ğŸŒŸğŸ’«',
                            'Querido/a {name}, la esperanza que sientes es uno de los regalos mÃ¡s preciosos que puedes tener. No es solo un sentimiento, es una fuerza que puede mover montaÃ±as. Cuando tienes esperanza, tienes poder para crear el cambio que deseas ver en tu vida. La esperanza te da la fuerza para seguir adelante cuando las cosas se ponen difÃ­ciles. Comparte tu esperanza con otros, porque es contagiosa y puede iluminar el camino de quienes te rodean. Eres un faro de luz en este mundo. ğŸ•¯ï¸âœ¨',
                            '{name}, sentir esperanza es como tener un jardÃ­n secreto en tu corazÃ³n donde las flores mÃ¡s hermosas pueden florecer. Es esa certeza interna de que las cosas pueden mejorar, de que hay un maÃ±ana lleno de posibilidades. Tu esperanza no es fantasÃ­a, es fe en tu propia capacidad de crear y atraer cosas buenas a tu vida. Cada dÃ­a que eliges la esperanza sobre el miedo, estÃ¡s eligiendo la vida. Sigue creyendo, sigue esperando, porque tu esperanza es el primer paso hacia la realizaciÃ³n de tus sueÃ±os. ğŸŒˆğŸ’–'
                        ]
                    },
                    musicPlaylist: {
                        'joy': [
                            'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
                            // MÃºsica alegre y energÃ©tica
                        ],
                        'sadness': [
                            'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
                            // MÃºsica calmante y consoladora
                        ],
                        'anger': [
                            'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
                            // MÃºsica relajante para canalizar la energÃ­a
                        ],
                        'fear': [
                            'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
                            // MÃºsica tranquilizadora
                        ],
                        'love': [
                            'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
                            // MÃºsica romÃ¡ntica y cÃ¡lida
                        ],
                        'anxiety': [
                            'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
                            // MÃºsica de meditaciÃ³n y relajaciÃ³n
                        ],
                        'gratitude': [
                            'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
                            // MÃºsica inspiradora y elevadora
                        ],
                        'hopeful': [
                            'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
                            // MÃºsica optimista y motivadora
                        ],
                        'neutral': [
                            'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
                            // MÃºsica ambiente suave
                        ]
                    }
                }
            },
            computed: {
                emotionLabel() {
                    if (!this.result) return '';
                    return this.emotionMap[this.result.emotion]?.label || 'EmociÃ³n';
                },
                emotionEmoji() {
                    if (!this.result) return '';
                    return this.emotionMap[this.result.emotion]?.emoji || 'ğŸ˜Š';
                },
                empathyMessage() {
                    if (!this.result) return '';
                    const message = this.generateEmpathyResponse(this.result.emotion, this.feeling);
                    //this.speakMessage(message);
                    return message;
                },
                needsHelp() {
                    if (!this.result) return false;
                    const negativeEmotions = ['sadness', 'anger', 'fear', 'anxiety'];
                    const crisisKeywords = ['suicidio', 'suicidar', 'matarme', 'no quiero vivir', 'cÃ¡ncer', 'enfermo', 'tumor'];
                    const hasCrisisKeywords = crisisKeywords.some(keyword => 
                        this.feeling.toLowerCase().includes(keyword)
                    );
                    return (negativeEmotions.includes(this.result.emotion) && this.result.score > 0.7) || hasCrisisKeywords;
                },
                emotionalTrend() {
                    if (this.userHistory.length < 3) return 'insuficiente';
                    const recent = this.userHistory.slice(-5);
                    const positiveCount = recent.filter(e => ['joy', 'love', 'gratitude', 'excitement', 'hopeful'].includes(e.emotion)).length;
                    const negativeCount = recent.filter(e => ['sadness', 'anger', 'fear', 'anxiety'].includes(e.emotion)).length;
                    
                    if (positiveCount > negativeCount + 1) return 'mejorando';
                    if (negativeCount > positiveCount + 1) return 'empeorando';
                    return 'estable';
                }
            },
            methods: {
                detectEmotionFromKeywords(text) {
                    const lowerText = text.toLowerCase();
                    const keywords = {
                        'sadness': ['triste', 'tristeza', 'deprimido', 'depresiÃ³n', 'lloro', 'llorar', 'llorando', 'dolor', 'pÃ©rdida', 'muerte', 'muriÃ³', 'falleciÃ³', 'duelo', 'solo', 'sola', 'soledad', 'vacÃ­o', 'desesperado', 'desesperanza', 'melancolÃ­a', 'nostalgia', 'perdÃ­', 'extraÃ±o', 'falta', 'abandonado', 'desanimado', 'sufro', 'sufrimiento'],
                        'anger': ['enojado', 'enojo', 'rabia', 'furioso', 'furia', 'molesto', 'irritado', 'frustrado', 'frustraciÃ³n', 'odio', 'coraje', 'enfadado', 'ira', 'injusto', 'injusticia', 'harto', 'cansado de', 'indignado', 'maldito', 'cabrÃ³n', 'no puedo mÃ¡s', 'me da rabia', 'estÃºpido', 'idiota'],
                        'fear': ['miedo', 'temor', 'asustado', 'aterrado', 'pÃ¡nico', 'terror', 'angustia', 'angustiado', 'inseguro', 'inseguridad', 'amenaza', 'peligro', 'tengo miedo', 'me asusta', 'vulnerable'],
                        'anxiety': ['ansiedad', 'ansioso', 'nervioso', 'preocupado', 'preocupaciÃ³n', 'estrÃ©s', 'estresado', 'agobiado', 'agobio', 'presiÃ³n', 'presionado', 'tensiÃ³n', 'tenso'],
                        'joy': ['feliz', 'felicidad', 'alegre', 'alegrÃ­a', 'contento', 'emocionado', 'emociÃ³n', 'dichoso', 'eufÃ³rico', 'radiante', 'maravilloso', 'genial', 'increÃ­ble', 'fantÃ¡stico', 'excelente', 'bendecido', 'afortunado', 'celebrar', 'logrÃ©', 'conseguÃ­', 'Ã©xito', 'victoria'],
                        'love': ['amor', 'amo', 'quiero', 'cariÃ±o', 'te amo', 'enamorado', 'enamorada', 'adorar', 'adoro', 'pasiÃ³n', 'afecto', 'romÃ¡ntico', 'corazÃ³n', 'beso', 'abrazo', 'pareja', 'novio', 'novia', 'esposo', 'esposa', 'familia'],
                        'gratitude': ['agradecido', 'agradecida', 'gracias', 'bendecido', 'bendecida', 'afortunado', 'afortunada', 'suerte', 'fortuna', 'agradezco', 'reconocimiento'],
                        'excitement': ['emocionado', 'emocionada', 'excitado', 'excitada', 'expectativa', 'anticipaciÃ³n', 'esperando', 'anhelando', 'deseando'],
                        'confusion': ['confundido', 'confundida', 'confusiÃ³n', 'perdido', 'perdida', 'no entiendo', 'no sÃ©', 'duda', 'dudoso', 'incierto'],
                        'hopeful': ['esperanza', 'esperanzado', 'esperanzada', 'optimista', 'positivo', 'positiva', 'fe', 'creer', 'confÃ­o']
                    };
                    
                    let scores = {};
                    for (let emotion in keywords) {
                        scores[emotion] = 0;
                    }
                    
                    // AnÃ¡lisis mÃ¡s inteligente con pesos
                    for (let emotion in keywords) {
                        keywords[emotion].forEach(keyword => {
                            const count = (lowerText.match(new RegExp(keyword, 'g')) || []).length;
                            scores[emotion] += count;
                        });
                    }
                    
                    // Detectar emociones complejas
                    const complexPatterns = {
                        'anxiety': /(?:muy|mucho|demasiado)\s+(?:ansioso|nervioso|preocupado)/,
                        'excitement': /(?:muy|mucho)\s+(?:emocionado|excitado)/,
                        'hopeful': /(?:tengo|siento)\s+(?:esperanza|fe)/
                    };
                    
                    for (let emotion in complexPatterns) {
                        if (complexPatterns[emotion].test(lowerText)) {
                            scores[emotion] += 2;
                        }
                    }
                    
                    // Analizar contexto emocional del historial
                    if (this.userHistory.length > 0) {
                        const recentEmotions = this.userHistory.slice(-3).map(entry => entry.emotion);
                        const emotionCounts = recentEmotions.reduce((acc, emotion) => {
                            acc[emotion] = (acc[emotion] || 0) + 1;
                            return acc;
                        }, {});
                        
                        // Dar peso a emociones recientes
                        for (let emotion in emotionCounts) {
                            if (scores[emotion]) {
                                scores[emotion] += emotionCounts[emotion] * 0.5;
                            }
                        }
                    }
                    
                    let maxScore = 0;
                    let detectedEmotion = 'neutral';
                    for (let emotion in scores) {
                        if (scores[emotion] > maxScore) {
                            maxScore = scores[emotion];
                            detectedEmotion = emotion;
                        }
                    }
                    
                    return { 
                        emotion: detectedEmotion, 
                        score: maxScore > 0 ? Math.min(0.9, 0.3 + (maxScore * 0.1)) : 0.3,
                        confidence: maxScore > 0 ? Math.min(1, maxScore / 3) : 0.3
                    };
                },
                submitName() {
                    if (!this.name.trim()) { alert('Por favor ingresa tu nombre'); return; }
                    this.nameSubmitted = true;
                    this.$nextTick(() => { if (this.$refs.feelingInput) this.$refs.feelingInput.focus(); });
                },
                async analyzeEmotion() {
                    if (!this.feeling.trim()) { alert('Por favor comparte cÃ³mo te sientes'); return; }
                    this.loading = true;
                    this.submitted = true;
                    try {
                        const keywordResult = this.detectEmotionFromKeywords(this.feeling);
                        let finalResult = keywordResult;
                        
                        // Intentar con API de IA si el anÃ¡lisis local no es muy confiable
                        if (keywordResult.confidence < 0.7) {
                            try {
                                const response = await fetch("https://api-inference.huggingface.co/models/finiteautomata/beto-emotion-analysis", {
                                    method: "POST",
                                    headers: { "Content-Type": "application/json" },
                                    body: JSON.stringify({ inputs: this.feeling })
                                });
                                const data = await response.json();
                                if (data && data[0] && data[0].length > 0) {
                                    const topEmotion = data[0].reduce((prev, curr) => (prev.score > curr.score) ? prev : curr);
                                    const aiResult = { emotion: topEmotion.label.toLowerCase(), score: topEmotion.score, confidence: topEmotion.score };
                                    
                                    // Combinar resultados inteligentemente
                                    if (aiResult.score > keywordResult.score) {
                                        finalResult = aiResult;
                                    }
                                }
                            } catch (error) {
                                console.log('API no disponible, usando anÃ¡lisis local');
                            }
                        }
                        
                        this.result = finalResult;
                        
                        // Guardar en historial
                        const historyEntry = {
                            timestamp: new Date().toISOString(),
                            emotion: finalResult.emotion,
                            score: finalResult.score,
                            text: this.feeling,
                            name: this.name
                        };
                        
                        this.userHistory.push(historyEntry);
                        if (this.userHistory.length > 50) {
                            this.userHistory = this.userHistory.slice(-50); // Mantener solo los Ãºltimos 50
                        }
                        
                        localStorage.setItem('emotionHistory', JSON.stringify(this.userHistory));
                        localStorage.setItem('currentMood', JSON.stringify(finalResult));
                        
                        // Generar insights inteligentes
                        this.generateInsights();
                        
                        // Cambiar mÃºsica segÃºn la emociÃ³n
                        this.changeMusicByEmotion(finalResult.emotion);
                        
                    } catch (e) { 
                        console.error(e); 
                        this.result = { emotion: 'neutral', score: 0.5, confidence: 0.3 }; 
                    }
                    finally { this.loading = false; }
                },
                generateInsights() {
                    if (this.userHistory.length < 3) return;
                    
                    const recentEntries = this.userHistory.slice(-7); // Ãšltimos 7 dÃ­as
                    const emotionCounts = {};
                    let totalScore = 0;
                    
                    recentEntries.forEach(entry => {
                        emotionCounts[entry.emotion] = (emotionCounts[entry.emotion] || 0) + 1;
                        totalScore += entry.score;
                    });
                    
                    const avgScore = totalScore / recentEntries.length;
                    const dominantEmotion = Object.keys(emotionCounts).reduce((a, b) => 
                        emotionCounts[a] > emotionCounts[b] ? a : b
                    );
                    
                    const insights = {
                        trend: avgScore > 0.6 ? 'positivo' : avgScore < 0.4 ? 'negativo' : 'neutral',
                        dominantEmotion: dominantEmotion,
                        pattern: this.detectEmotionalPattern(),
                        recommendation: this.getPersonalizedRecommendation(dominantEmotion, avgScore)
                    };
                    
                    this.aiInsights = insights;
                },
                
                detectEmotionalPattern() {
                    if (this.userHistory.length < 5) return null;
                    
                    const recent = this.userHistory.slice(-5).map(e => e.emotion);
                    const positiveEmotions = ['joy', 'love', 'gratitude', 'excitement', 'hopeful'];
                    const negativeEmotions = ['sadness', 'anger', 'fear', 'anxiety'];
                    
                    const positiveCount = recent.filter(e => positiveEmotions.includes(e)).length;
                    const negativeCount = recent.filter(e => negativeEmotions.includes(e)).length;
                    
                    if (positiveCount > negativeCount + 1) return 'mejorando';
                    if (negativeCount > positiveCount + 1) return 'empeorando';
                    return 'estable';
                },
                
                getPersonalizedRecommendation(dominantEmotion, avgScore) {
                    const recommendations = {
                        'sadness': 'Considera hablar con un profesional de salud mental. La terapia puede ayudarte a procesar estos sentimientos.',
                        'anxiety': 'Prueba tÃ©cnicas de respiraciÃ³n profunda o meditaciÃ³n. El ejercicio regular tambiÃ©n puede reducir la ansiedad.',
                        'anger': 'Encuentra formas saludables de expresar tu frustraciÃ³n, como ejercicio o arte.',
                        'fear': 'Recuerda que has superado desafÃ­os antes. Eres mÃ¡s fuerte de lo que crees.',
                        'joy': 'Â¡QuÃ© maravilloso! Sigue cultivando estas emociones positivas.',
                        'love': 'El amor es una fuerza poderosa. Comparte estos sentimientos con quienes amas.',
                        'gratitude': 'La gratitud es una prÃ¡ctica transformadora. MantÃ©n este hÃ¡bito positivo.',
                        'hopeful': 'La esperanza es tu superpoder. ConfÃ­a en el proceso de la vida.'
                    };
                    
                    return recommendations[dominantEmotion] || 'ContinÃºa siendo consciente de tus emociones y busca apoyo cuando lo necesites.';
                },

                generateEmpathyResponse(emotion, text) {
                    const name = this.name || "Amigo/a";
                    text = text.toLowerCase();
                    
                    // DETECCIÃ“N DE CRISIS - RESPUESTAS URGENTES Y HUMANAS
                    const crisisKeywords = {
                        suicide: ['suicidio', 'suicidar', 'matarme', 'acabar con todo', 'no quiero vivir', 'terminar con mi vida', 'quitarse la vida'],
                        selfHarm: ['cortarme', 'lastimarme', 'herirme', 'daÃ±arme', 'autolesiÃ³n', 'daÃ±arme a mÃ­ mismo'],
                        severeDepression: ['no puedo mÃ¡s', 'no aguanto', 'estoy acabado', 'sin esperanza', 'no hay salida', 'todo estÃ¡ perdido'],
                        crisis: ['crisis', 'emergencia', 'ayuda urgente', 'no sÃ© quÃ© hacer', 'desesperado', 'pÃ¡nico total']
                    };
                    
                    // Detectar crisis de suicidio
                    if (crisisKeywords.suicide.some(keyword => text.includes(keyword))) {
                        return `${name}, mi corazÃ³n se detiene al leer tus palabras. Lo que estÃ¡s sintiendo es real y doloroso, pero tambiÃ©n temporal. Por favor, por favor, busca ayuda inmediatamente. Llama al 911 o a la LÃ­nea de la Vida (800 911 2000) AHORA MISMO. No estÃ¡s solo/a en esto. Tu vida tiene valor, aunque ahora no puedas verlo. Hay gente que te ama y profesionales que pueden ayudarte. Por favor, no hagas nada irreversible. Tu dolor es vÃ¡lido, pero hay formas de sanarlo. Te abrazo con todo mi corazÃ³n. ğŸ’”ğŸ¤—`;
                    }
                    
                    // Detectar autolesiÃ³n
                    if (crisisKeywords.selfHarm.some(keyword => text.includes(keyword))) {
                        return `${name}, entiendo que el dolor que sientes es insoportable y que buscas formas de aliviarlo. Pero lastimarte no es la respuesta. Por favor, busca ayuda profesional inmediatamente. Puedes llamar al 911 o contactar a un terapeuta. Tu cuerpo y tu mente merecen cuidado y amor, no dolor. Hay formas mÃ¡s seguras de procesar estos sentimientos. No estÃ¡s solo/a en esto. ğŸ’™ğŸ¤—`;
                    }
                    
                    // Detectar depresiÃ³n severa
                    if (crisisKeywords.severeDepression.some(keyword => text.includes(keyword))) {
                        return `${name}, puedo sentir la profundidad de tu dolor en cada palabra. Cuando todo parece oscuro y sin esperanza, es difÃ­cil ver la luz, pero existe. Por favor, considera hablar con un profesional de salud mental. La depresiÃ³n es una enfermedad real y tratable. No tienes que enfrentarla sola/o. Tu vida importa, tu dolor es vÃ¡lido, y hay ayuda disponible. Por favor, busca apoyo profesional hoy mismo. ğŸ’œ`;
                    }
                    
                    // Detectar crisis general
                    if (crisisKeywords.crisis.some(keyword => text.includes(keyword))) {
                        return `${name}, reconozco que estÃ¡s en una crisis y que te sientes abrumado/a. Es valiente de tu parte expresarlo. En momentos asÃ­, es crucial buscar apoyo inmediato. Por favor, contacta a alguien de confianza, un profesional de salud mental, o llama a una lÃ­nea de crisis. No tienes que enfrentar esto solo/a. Tu bienestar es prioritario. ğŸ¤—ğŸ’™`;
                    }
                    
                    // Detectar enfermedades graves (cÃ¡ncer, etc.)
                    const healthCrisis = ['cÃ¡ncer', 'tumor', 'quimioterapia', 'enfermedad terminal', 'diagnÃ³stico grave', 'operaciÃ³n mayor'];
                    if (healthCrisis.some(keyword => text.includes(keyword))) {
                        return `${name}, mi corazÃ³n se llena de compasiÃ³n al leer sobre la situaciÃ³n de salud que estÃ¡s enfrentando. Es normal sentir miedo, rabia, tristeza y una mezcla de emociones intensas. No tienes que ser fuerte todo el tiempo. PermÃ­tete sentir lo que sientes. Busca apoyo en grupos de apoyo, terapeutas especializados en oncologÃ­a, o consejeros espirituales. No estÃ¡s solo/a en este camino. Cada dÃ­a que luchas es un acto de valentÃ­a. Te acompaÃ±o con todo mi amor. ğŸ’™ğŸ•Šï¸`;
                    }
                    
                    // Detectar situaciones especÃ­ficas para respuestas mÃ¡s personalizadas
                    const isLoss = text.includes("muriÃ³") || text.includes("falleciÃ³") || text.includes("muerte") || text.includes("perdÃ­ a");
                    const isAnxiety = text.includes("ansiedad") || text.includes("preocupado") || text.includes("nervioso") || text.includes("estrÃ©s");
                    const isLonely = text.includes("solo") || text.includes("sola") || text.includes("soledad") || text.includes("aislado");
                    const isSelfDoubt = text.includes("inÃºtil") || text.includes("no sirvo") || text.includes("no valgo") || text.includes("fracaso");
                    const isRelationship = text.includes("pareja") || text.includes("novio") || text.includes("novia") || text.includes("relaciÃ³n");
                    const isWork = text.includes("trabajo") || text.includes("empleo") || text.includes("jefe") || text.includes("oficina");
                    
                    // Respuestas contextuales mÃ¡s inteligentes y humanas
                    if (isLoss) return `${name}, lamento profundamente tu pÃ©rdida. Perder a alguien que amamos es uno de los dolores mÃ¡s profundos que podemos experimentar. Es completamente normal sentir que el mundo se ha detenido. No hay un tiempo "correcto" para sanar. PermÃ­tete llorar, recordar, y honrar a esa persona especial. El amor que sientes por ella/Ã©l nunca desaparecerÃ¡, solo se transformarÃ¡. No estÃ¡s solo/a en este dolor. Te abrazo con todo mi corazÃ³n. ğŸ’œğŸ•Šï¸`;
                    
                    if (isAnxiety) return `${name}, puedo sentir cÃ³mo la ansiedad te estÃ¡ consumiendo. Es como tener una tormenta constante en tu mente, Â¿verdad? Respira conmigo ahora: inhala lentamente por la nariz (1,2,3,4), mantÃ©n el aire (1,2,3,4), exhala suavemente por la boca (1,2,3,4,5,6). Repite esto tres veces. Recuerda: no tienes que controlar todo. Date permiso de vivir un dÃ­a a la vez, un momento a la vez. Eres mÃ¡s fuerte de lo que crees, aunque ahora no lo sientas asÃ­. ğŸŒ¿ğŸ’™`;
                    
                    if (isLonely) return `${name}, la soledad puede sentirse como un peso que te aplasta el pecho. Pero quiero que sepas algo importante: no estÃ¡s realmente solo/a. Hay personas que te aman mÃ¡s de lo que imaginas. Usa este momento para reconectarte contigo mismo/a, para recordar quiÃ©n eres realmente. Y cuando estÃ©s listo/a, extiende la mano hacia alguien. Pedir compaÃ±Ã­a no te hace dÃ©bil, te hace humano. Eres valioso/a, importante, y mereces amor y conexiÃ³n. ğŸ’«ğŸ¤—`;
                    
                    if (isSelfDoubt) return `${name}, escucha mi voz con atenciÃ³n: tu valor no se mide por tus logros, tus errores, o lo que otros piensen de ti. Tu valor es intrÃ­nseco, es parte de tu esencia. Eres Ãºnico/a, irrepetible, y tienes algo especial que aportar al mundo que nadie mÃ¡s puede dar. Cuando la voz crÃ­tica en tu cabeza te ataque, recuerda: eres suficiente, tal como eres, en este momento exacto. Te amo y creo en ti. â¤ï¸âœ¨`;
                    
                    if (isRelationship) return `${name}, las relaciones del corazÃ³n pueden ser nuestro mayor gozo y tambiÃ©n nuestra mayor fuente de dolor. Es completamente normal sentir emociones intensas cuando amamos a alguien. Date tiempo para procesar lo que sientes. La comunicaciÃ³n honesta y compasiva es la base de cualquier relaciÃ³n sana. Recuerda que amar no significa perderte a ti mismo/a. Eres digno/a de amor y respeto. ğŸŒ¹ğŸ’•`;
                    
                    if (isWork) return `${name}, entiendo la presiÃ³n que puede generar el trabajo. Es fÃ¡cil que se convierta en nuestra identidad, pero recuerda: tÃº no eres tu trabajo. Tu valor como persona trasciende cualquier logro profesional. Es importante encontrar equilibrio entre dedicaciÃ³n y autocuidado. Si el trabajo te estÃ¡ consumiendo, tal vez es momento de reevaluar prioridades. Tu bienestar emocional es mÃ¡s importante que cualquier trabajo. ğŸ¢ğŸ’™`;
                    
                    // Usar historial para personalizar respuesta
                    if (this.userHistory.length > 0) {
                        const lastEmotion = this.userHistory[this.userHistory.length - 1]?.emotion;
                        if (lastEmotion === emotion && this.userHistory.length > 1) {
                            return `${name}, veo que has estado luchando con ${this.emotionMap[emotion]?.label.toLowerCase()} recientemente. Es increÃ­blemente valiente de tu parte seguir compartiendo tus sentimientos, incluso cuando es difÃ­cil. Cada vez que expresas lo que sientes, das un paso mÃ¡s hacia la sanaciÃ³n. No te rindas. Estoy aquÃ­ contigo en este viaje. ğŸ’ªğŸ¤—`;
                        }
                    }
                    
                    // Respuesta estÃ¡ndar personalizada
                    const phrases = this.empathyPhrases[emotion] || this.empathyPhrases['neutral'];
                    return phrases[Math.floor(Math.random() * phrases.length)].replace('{name}', name);
                },
                toggleMusic() {
                    const audio = this.$refs.bgMusic;
                    if (this.isPlaying) { 
                        audio.pause(); 
                    } else { 
                        if (!this.currentMusic) {
                            this.changeMusicByEmotion('neutral');
                        }
                        audio.volume = this.musicVolume;
                        audio.play().catch(e => console.log('Error reproduciendo mÃºsica:', e)); 
                    }
                    this.isPlaying = !this.isPlaying;
                },
                
                changeMusicByEmotion(emotion) {
                    const playlist = this.musicPlaylist[emotion] || this.musicPlaylist['neutral'];
                    if (playlist && playlist.length > 0) {
                        const randomTrack = playlist[Math.floor(Math.random() * playlist.length)];
                        this.currentMusic = randomTrack;
                        
                        // Si la mÃºsica estÃ¡ reproduciÃ©ndose, cambiar de inmediato
                        if (this.isPlaying) {
                            const audio = this.$refs.bgMusic;
                            audio.src = randomTrack;
                            audio.volume = this.musicVolume;
                            audio.play().catch(e => console.log('Error cambiando mÃºsica:', e));
                        }
                    }
                },
                
                updateVolume() {
                    const audio = this.$refs.bgMusic;
                    if (audio) {
                        audio.volume = this.musicVolume;
                    }
                },
                
                nextTrack() {
                    if (this.result && this.result.emotion) {
                        this.changeMusicByEmotion(this.result.emotion);
                    }
                },
                async saveAsImage() {
                    const element = document.getElementById('captureArea');
                    try {
                        const canvas = await html2canvas(element, { backgroundColor: null, scale: 2 });
                        const link = document.createElement('a');
                        link.download = `espacio-seguro-${this.name}.jpg`;
                        link.href = canvas.toDataURL('image/jpeg', 0.95);
                        link.click();
                    } catch (e) { console.error(e); alert('Hubo un error al guardar la imagen.'); }
                },
                reset() {
                    this.feeling = '';
                    this.submitted = false;
                    this.result = null;
                    this.$nextTick(() => { if (this.$refs.feelingInput) this.$refs.feelingInput.focus(); });
                },
                speakMessage(message) {
                    if (!('speechSynthesis' in window)) return;
                    const utterance = new SpeechSynthesisUtterance(message);
                    utterance.lang = 'es-ES';
                    window.speechSynthesis.cancel();
                    window.speechSynthesis.speak(utterance);
                },
                
                getSmartSuggestions() {
                    if (!this.result) return [];
                    
                    const emotion = this.result.emotion;
                    const suggestions = {
                        'sadness': [
                            'ğŸµ Escucha mÃºsica que te haga sentir acompaÃ±ado/a',
                            'ğŸ“– Lee algo inspirador o que te guste',
                            'ğŸŒ± Sal a caminar al aire libre, aunque sea por 10 minutos',
                            'ğŸ“ Llama a alguien en quien confÃ­es para hablar',
                            'ğŸ’§ Toma un baÃ±o relajante o una ducha caliente'
                        ],
                        'anxiety': [
                            'ğŸ« Practica la respiraciÃ³n 4-7-8: inhala 4, mantÃ©n 7, exhala 8',
                            'ğŸ§˜ Prueba meditaciÃ³n guiada de 5 minutos',
                            'ğŸƒâ€â™€ï¸ Haz ejercicio ligero para liberar endorfinas',
                            'ğŸ“ Escribe tus preocupaciones para organizar tus pensamientos',
                            'ğŸ¨ Colorea o dibuja para calmar tu mente'
                        ],
                        'anger': [
                            'ğŸ‘Š Golpea una almohada de forma segura',
                            'ğŸƒâ€â™‚ï¸ Sal a correr o haz ejercicio intenso',
                            'ğŸµ Escucha mÃºsica que te relaje',
                            'ğŸŒŠ Ve a un lugar con agua (playa, lago, rÃ­o)',
                            'ğŸ’¬ Habla con alguien de confianza sobre lo que sientes'
                        ],
                        'fear': [
                            'ğŸ“ Escribe lo que te asusta y por quÃ©',
                            'ğŸ«‚ Abraza a alguien cercano o abraza una almohada',
                            'ğŸ¬ Mira algo divertido que te distraiga',
                            'ğŸ  Crea un espacio seguro y cÃ³modo para ti',
                            'ğŸ’ª Recuerda momentos difÃ­ciles que ya superaste'
                        ],
                        'joy': [
                            'ğŸ‰ Comparte tu felicidad con alguien mÃ¡s',
                            'ğŸ“¸ Toma una foto para recordar este momento',
                            'ğŸµ Baila con tu mÃºsica favorita',
                            'ğŸŒŸ Haz algo bueno por otra persona',
                            'ğŸ“ Escribe en un diario de gratitud'
                        ],
                        'love': [
                            'ğŸ’Œ Expresa tu amor a quien amas',
                            'ğŸŒ¹ Haz algo especial para tu ser querido',
                            'ğŸ“¸ Crea recuerdos juntos',
                            'ğŸ’ Escribe una carta de amor',
                            'ğŸ¨ Crea algo hermoso que represente tu amor'
                        ],
                        'gratitude': [
                            'ğŸ“ Escribe 3 cosas por las que estÃ¡s agradecido hoy',
                            'ğŸ“ Llama a alguien para agradecerle',
                            'ğŸ Haz algo bueno por otra persona',
                            'ğŸŒ± Practica la gratitud hacia ti mismo/a',
                            'ğŸŒŸ Comparte tu gratitud en redes sociales'
                        ]
                    };
                    
                    return suggestions[emotion] || [
                        'ğŸŒ± Cuida de ti mismo/a hoy',
                        'ğŸ’§ Mantente hidratado/a',
                        'ğŸ˜´ AsegÃºrate de dormir bien',
                        'ğŸ Come algo nutritivo',
                        'ğŸ§˜ TÃ³mate 5 minutos para respirar'
                    ];
                },
                
                viewHistory() {
                    // Crear modal o nueva vista para mostrar historial detallado
                    const historyWindow = window.open('', '_blank', 'width=800,height=600');
                    const historyData = this.userHistory.map(entry => ({
                        fecha: new Date(entry.timestamp).toLocaleString(),
                        emociÃ³n: this.emotionMap[entry.emotion]?.label || entry.emotion,
                        puntuaciÃ³n: Math.round(entry.score * 100) + '%',
                        texto: entry.text.substring(0, 100) + (entry.text.length > 100 ? '...' : '')
                    }));
                    
                    const html = `
                        <html>
                            <head>
                                <title>Historial Emocional - ${this.name}</title>
                                <style>
                                    body { font-family: Arial, sans-serif; margin: 20px; }
                                    table { width: 100%; border-collapse: collapse; }
                                    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                                    th { background-color: #f2f2f2; }
                                    .positive { background-color: #d4edda; }
                                    .negative { background-color: #f8d7da; }
                                    .neutral { background-color: #fff3cd; }
                                </style>
                            </head>
                            <body>
                                <h1>ğŸ“Š Tu Historial Emocional</h1>
                                <p>Hola ${this.name}, aquÃ­ tienes un resumen de tus emociones registradas:</p>
                                <table>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>EmociÃ³n</th>
                                        <th>Intensidad</th>
                                        <th>Texto</th>
                                    </tr>
                                    ${historyData.map(entry => `
                                        <tr class="${this.emotionMap[entry.emociÃ³n.toLowerCase()]?.type || 'neutral'}">
                                            <td>${entry.fecha}</td>
                                            <td>${entry.emociÃ³n}</td>
                                            <td>${entry.puntuaciÃ³n}</td>
                                            <td>${entry.texto}</td>
                                        </tr>
                                    `).join('')}
                                </table>
                            </body>
                        </html>
                    `;
                    
                    historyWindow.document.write(html);
                    historyWindow.document.close();
                },
                
                clearHistory() {
                    if (confirm('Â¿EstÃ¡s seguro/a de que quieres eliminar todo tu historial emocional? Esta acciÃ³n no se puede deshacer.')) {
                        this.userHistory = [];
                        localStorage.removeItem('emotionHistory');
                        localStorage.removeItem('currentMood');
                        alert('Historial eliminado. Tus datos estÃ¡n seguros y privados.');
                    }
                },
                
                exportData() {
                    const data = {
                        name: this.name,
                        history: this.userHistory,
                        exportDate: new Date().toISOString(),
                        version: '2.0'
                    };
                    
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `historial-emocional-${this.name}-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }
            }
        }).mount('#app');
    </script>

</body>

</html>
