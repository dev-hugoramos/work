<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Espacio Seguro - Una aplicaci√≥n inteligente de apoyo emocional que te ayuda a entender y procesar tus sentimientos con IA avanzada">
    <meta name="keywords"
        content="salud mental, emociones, bienestar, apoyo emocional, terapia, IA, inteligencia artificial">
    <meta name="author" content="Hugo Ramos Espino">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Espacio Seguro - Apoyo Emocional Inteligente">
    <meta property="og:description"
        content="Una aplicaci√≥n inteligente que te ayuda a entender y procesar tus emociones con an√°lisis de IA avanzado">
    <meta property="og:type" content="website">
    <title>Espacio Seguro - Apoyo Emocional Inteligente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        .app-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 30%, #f093fb 70%, #f5576c 100%);
            position: relative;
        }

        .floating-circle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 20s infinite ease-in-out;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(-100px)
            }
        }

        .content-wrapper {
            position: relative;
            z-index: 10;
            padding: 2rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header-section {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px 20px 0 0;
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
        }

        .result-card {
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 20px;
        }

        .emotion-badge {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            font-weight: 600;
            margin: 10px 0;
        }

        .empathy-message {
            font-size: 1.3rem;
            line-height: 1.8;
            margin: 1.5rem 0;
        }

        .alert-help {
            background: rgba(255, 59, 48, 0.9);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .music-control {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .music-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            visibility: hidden;
        }

        .fade {
            transition: opacity 0.6s ease;
            opacity: 1;
        }

        .fade-leave-active {
            opacity: 0;
        }

        .insights-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .insights-header h5 {
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .insights-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
        }

        .insight-item {
            margin-bottom: 0.8rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .insight-item:last-child {
            margin-bottom: 0;
        }

        .emotion-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
        }

        .history-preview {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .emotion-timeline {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .emotion-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .emotion-dot:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        .smart-suggestions {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .suggestion-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            transition: transform 0.2s ease;
        }

        .suggestion-item:hover {
            transform: translateX(5px);
        }

        .suggestion-item:last-child {
            margin-bottom: 0;
        }

        .volume-control {
            margin-top: 10px;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* Mejoras para m√≥viles */
        @media (max-width: 768px) {
            .app-container {
                padding: 0;
            }

            .content-wrapper {
                padding: 1rem;
            }

            .header-section h1 {
                font-size: 2rem;
            }

            .card {
                margin: 0;
                border-radius: 15px;
            }

            .card-body {
                padding: 1.5rem !important;
            }

            .btn-lg {
                font-size: 1rem;
                padding: 0.75rem 1rem;
            }

            .music-control {
                bottom: 20px;
                right: 20px;
            }

            .music-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .empathy-message {
                font-size: 1.1rem;
                line-height: 1.6;
            }

            .insights-card {
                padding: 1rem;
            }

            .smart-suggestions {
                padding: 1rem;
            }

            .result-card {
                padding: 1.5rem;
            }

            .floating-circle {
                display: none;
            }

            .btn {
                margin-bottom: 0.5rem;
                width: 100%;
            }

            .btn+.btn {
                margin-left: 0;
            }
        }

        @media (max-width: 480px) {
            .header-section h1 {
                font-size: 1.8rem;
            }

            .empathy-message {
                font-size: 1rem;
            }

            .insights-card,
            .smart-suggestions {
                padding: 0.8rem;
            }

            .music-control {
                bottom: 15px;
                right: 15px;
            }

            .music-btn {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
        }

        /* Animaciones suaves */
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        }

        .btn {
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .suggestion-item {
            transition: all 0.3s ease;
        }

        .suggestion-item:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.3);
        }

        /* Mejoras de accesibilidad */
        .btn:focus,
        input:focus,
        textarea:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        /* Efectos de carga mejorados */
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3rem;
        }

        /* Mejoras visuales adicionales */
        .emotion-badge {
            font-size: 1.1rem;
            padding: 12px 24px;
        }

        .confidence-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
        }

        .confidence-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A, #FFD700);
        }

        .music-info {
            position: absolute;
            top: -30px;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            animation: fadeInOut 3s ease-in-out;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
            }

            20% {
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        /* Estilos del Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2rem 2rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-header h3 {
            color: white;
            margin: 0;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 2rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 2rem;
            color: white;
        }

        .empty-history {
            text-align: center;
            padding: 3rem;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-history h4 {
            margin-bottom: 1rem;
            color: white;
        }

        .empty-history p {
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
        }

        .history-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .summary-card h5 {
            margin-bottom: 1rem;
            color: white;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }

        .stat {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: bold;
            color: #FFD93D;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .history-timeline h5,
        .history-insights h5 {
            margin-bottom: 1rem;
            color: white;
        }

        .timeline-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .timeline-container::-webkit-scrollbar {
            width: 6px;
        }

        .timeline-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .timeline-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .timeline-item {
            display: flex;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .timeline-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 15px;
            top: 40px;
            bottom: -20px;
            width: 2px;
            background: rgba(255, 255, 255, 0.2);
        }

        .timeline-marker {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .timeline-content {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            backdrop-filter: blur(10px);
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .emotion-name {
            font-weight: 600;
            color: white;
        }

        .timeline-date {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .timeline-text {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .timeline-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .insight-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            backdrop-filter: blur(10px);
        }

        .insight-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .insight-content h6 {
            margin: 0 0 0.25rem 0;
            color: white;
            font-size: 0.9rem;
        }

        .insight-content p {
            margin: 0;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
        }

        .modal-footer {
            padding: 1rem 2rem 2rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .modal-footer .btn {
            min-width: 140px;
        }

        /* Responsive para m√≥viles */
        @media (max-width: 768px) {
            .modal-overlay {
                padding: 10px;
            }

            .modal-content {
                max-height: 95vh;
                border-radius: 15px;
            }

            .modal-header {
                padding: 1.5rem 1.5rem 1rem;
            }

            .modal-header h3 {
                font-size: 1.5rem;
            }

            .modal-body {
                padding: 1.5rem;
            }

            .summary-stats {
                grid-template-columns: repeat(3, 1fr);
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .timeline-container {
                max-height: 300px;
            }

            .timeline-content {
                padding: 0.8rem;
            }

            .timeline-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }

            .insights-grid {
                grid-template-columns: 1fr;
            }

            .modal-footer {
                padding: 1rem 1.5rem 1.5rem;
                flex-direction: column;
            }

            .modal-footer .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .modal-header h3 {
                font-size: 1.3rem;
            }

            .summary-stats {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .stat {
                padding: 0.8rem;
            }

            .timeline-item {
                margin-bottom: 1rem;
            }

            .timeline-content {
                padding: 0.7rem;
            }
        }

        /* Footer Mejorado */
        .app-footer {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #2c3e50 100%);
            color: white;
            padding: 3rem 2rem 1rem;
            margin-top: 4rem;
            position: relative;
            overflow: hidden;
        }

        .app-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-main {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 3rem;
            margin-bottom: 2rem;
        }

        .footer-info h4 {
            color: #3498db;
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .developer-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ecf0f1;
            margin-bottom: 0.25rem;
        }

        .developer-title {
            color: #bdc3c7;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .footer-description {
            color: #ecf0f1;
            line-height: 1.6;
            max-width: 500px;
        }

        .footer-links {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .support-section h5,
        .contact-section h5 {
            color: #3498db;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .support-section p,
        .contact-section p {
            color: #bdc3c7;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .kofi-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #FF5E5B 0%, #FF8A80 100%);
            color: white;
            text-decoration: none;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 94, 91, 0.3);
            position: relative;
            overflow: hidden;
        }

        .kofi-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .kofi-btn:hover::before {
            left: 100%;
        }

        .kofi-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 94, 91, 0.4);
        }

        .kofi-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .kofi-text {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .kofi-subtext {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .social-links {
            display: flex;
            gap: 1rem;
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .social-link:hover {
            background: rgba(52, 152, 219, 0.3);
            transform: translateY(-2px);
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .footer-stats {
            display: flex;
            gap: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #bdc3c7;
        }

        .footer-copyright {
            color: #95a5a6;
            font-size: 0.9rem;
        }

        /* Responsive Footer */
        @media (max-width: 768px) {
            .app-footer {
                padding: 2rem 1rem 1rem;
            }

            .footer-main {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .footer-bottom {
                flex-direction: column;
                text-align: center;
                gap: 1.5rem;
            }

            .footer-stats {
                justify-content: center;
                gap: 1.5rem;
            }

            .social-links {
                justify-content: center;
            }

            .kofi-btn {
                padding: 1.25rem 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .footer-stats {
                flex-direction: column;
                gap: 1rem;
            }

            .stat-item {
                padding: 0.5rem;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
            }
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="app-container">
            <div class="floating-circle" :style="{width:'200px',height:'200px',top:'10%',left:'5%'}"></div>
            <div class="floating-circle" :style="{width:'150px',height:'150px',top:'60%',right:'10%'}"></div>

            <div class="content-wrapper">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="header-section">
                                    <h1>üåü Mi Refugio üåü</h1>
                                    <p class="mb-0">Un lugar donde tus emociones importan</p>
                                </div>
                                <div class="card-body p-4">
                                    <!-- Nombre -->
                                    <div v-if="!nameSubmitted">
                                        <label class="form-label fw-bold" for="nameInput">¬øCu√°l es tu nombre?</label>
                                        <input v-model="name" type="text" class="form-control" id="nameInput"
                                            placeholder="Escribe tu nombre..." @keyup.enter="submitName"
                                            aria-describedby="nameHelp" autocomplete="name">
                                        <div id="nameHelp" class="form-text">Tu nombre nos ayuda a personalizar tu
                                            experiencia</div>
                                        <button @click="submitName" class="btn btn-primary w-100 mt-3"
                                            :disabled="!name.trim()" aria-label="Continuar con el nombre ingresado">‚ú®
                                            Continuar</button>
                                    </div>

                                    <!-- Sentimientos -->
                                    <div v-if="nameSubmitted && !submitted">
                                        <p class="text-muted">üëã Hola, <strong>{{ name }}</strong></p>
                                        <label class="form-label fw-bold" for="feelingInput">¬øC√≥mo te sientes
                                            hoy?</label>
                                        <textarea v-model="feeling" class="form-control" rows="4" id="feelingInput"
                                            placeholder="Comparte lo que sientes..." ref="feelingInput"
                                            aria-describedby="feelingHelp" autocomplete="off"></textarea>
                                        <div id="feelingHelp" class="form-text">Describe libremente tus emociones,
                                            pensamientos o experiencias</div>
                                        <button @click="analyzeEmotion" class="btn btn-primary w-100 mt-3"
                                            :disabled="!feeling || loading" aria-label="Analizar mis sentimientos">
                                            <span v-if="!loading">üí¨ Compartir mis sentimientos</span>
                                            <span v-else>Analizando...</span>
                                        </button>
                                    </div>

                                    <div v-if="loading" class="text-center py-4">
                                        <div class="spinner-border text-primary"></div>
                                        <p class="mt-2">Comprendiendo tus emociones...</p>
                                    </div>

                                    <!-- Resultado -->
                                    <div v-if="result && !loading">
                                        <div id="captureArea" class="result-card">
                                            <div class="text-center mb-3">
                                                <div class="emotion-badge">
                                                    <span class="emotion-indicator"
                                                        :style="{backgroundColor: emotionMap[result.emotion]?.color}"></span>
                                                    {{ emotionEmoji }} {{ emotionLabel }}
                                                    <span v-if="result.confidence" class="ms-2">
                                                        ({{ Math.round(result.confidence * 100) }}% confianza)
                                                    </span>
                                                </div>
                                                <div v-if="result.confidence" class="confidence-bar mt-2">
                                                    <div class="confidence-fill"
                                                        :style="{width: (result.confidence * 100) + '%'}"></div>
                                                </div>
                                            </div>
                                            <div class="empathy-message" v-if="result && !loading"
                                                v-bind:class="{ fade: fadeEffect }">
                                                {{ empathyMessage }}
                                            </div>
                                            <div class="text-center mt-4">
                                                <small>üíù Para: {{ name }}</small>
                                                <div v-if="quote" class="mt-2"><em>"{{ quote }}"</em></div>

                                                <!-- Vista previa del historial emocional -->
                                                <div v-if="userHistory.length > 1" class="history-preview">
                                                    <small><strong>üìä Tu viaje emocional reciente:</strong></small>
                                                    <div class="emotion-timeline">
                                                        <div v-for="(entry, index) in userHistory.slice(-7)"
                                                            :key="index" class="emotion-dot"
                                                            :style="{backgroundColor: emotionMap[entry.emotion]?.color}"
                                                            :title="`${emotionMap[entry.emotion]?.label} - ${new Date(entry.timestamp).toLocaleDateString()}`">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Insights Inteligentes -->
                                        <div v-if="aiInsights" class="insights-card mt-3">
                                            <div class="insights-header">
                                                <h5>üß† Insights sobre tu bienestar emocional</h5>
                                            </div>
                                            <div class="insights-content">
                                                <div class="insight-item">
                                                    <strong>Tendencia:</strong>
                                                    <span :class="{
                                                        'text-success': aiInsights.trend === 'positivo',
                                                        'text-warning': aiInsights.trend === 'neutral',
                                                        'text-danger': aiInsights.trend === 'negativo'
                                                    }">
                                                        {{ aiInsights.trend === 'positivo' ? 'üìà Mejorando' :
                                                        aiInsights.trend === 'negativo' ? 'üìâ Necesita atenci√≥n' : 'üìä
                                                        Estable' }}
                                                    </span>
                                                </div>
                                                <div v-if="aiInsights.pattern" class="insight-item">
                                                    <strong>Patr√≥n emocional:</strong>
                                                    <span :class="{
                                                        'text-success': aiInsights.pattern === 'mejorando',
                                                        'text-warning': aiInsights.pattern === 'estable',
                                                        'text-danger': aiInsights.pattern === 'empeorando'
                                                    }">
                                                        {{ aiInsights.pattern === 'mejorando' ? '‚ú® Progreso positivo' :
                                                        aiInsights.pattern === 'empeorando' ? '‚ö†Ô∏è Considera apoyo' : 'üîÑ
                                                        Estable' }}
                                                    </span>
                                                </div>
                                                <div class="insight-item">
                                                    <strong>Recomendaci√≥n personalizada:</strong>
                                                    <p class="mb-0">{{ aiInsights.recommendation }}</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div v-if="needsHelp" class="alert alert-help">
                                            <h5>ü§ó Hay gente aqu√≠ para ayudarte:</h5>
                                            <p>Si est√°s pasando por un momento dif√≠cil, no est√°s solo/a:</p>
                                            <ul>
                                                <li><strong>üö® Emergencias:</strong> 911</li>
                                                <li><strong>L√≠nea de la Vida (M√©xico):</strong> 800 911 2000</li>
                                                <li><strong>SAPTEL (Suicidio):</strong> 55 5259 8121</li>
                                                <li><strong>Crisis Text Line:</strong> Env√≠a HOME al 741741</li>
                                                <li><strong>L√≠nea de Ayuda Psicol√≥gica:</strong> 800 911 2000</li>
                                            </ul>
                                            <p class="mb-0"><strong>Recuerda:</strong> Tu vida tiene valor. Busca ayuda
                                                profesional. No tienes que enfrentar esto solo/a. üíô</p>
                                        </div>

                                        <!-- Sugerencias Inteligentes -->
                                        <div v-if="result" class="smart-suggestions">
                                            <h6>üí° Sugerencias personalizadas para ti</h6>
                                            <div class="suggestion-item" v-for="suggestion in getSmartSuggestions()"
                                                :key="suggestion">
                                                {{ suggestion }}
                                            </div>
                                        </div>

                                        <div class="text-center mt-4">
                                            <button @click="saveAsImage" class="btn btn-success btn-lg me-2">üì∏ Guardar
                                                frase</button>
                                            <button @click="reset" class="btn btn-outline-secondary btn-lg">üîÑ Nuevo
                                                sentimiento</button>
                                            <button v-if="userHistory.length > 0" @click="viewHistory"
                                                class="btn btn-info btn-lg ms-2">üìà Ver historial</button>
                                        </div>

                                        <!-- Opciones adicionales -->
                                        <div v-if="userHistory.length > 0" class="text-center mt-3">
                                            <small class="text-muted">Opciones de privacidad:</small><br>
                                            <button @click="exportData" class="btn btn-sm btn-outline-primary me-2">üìÅ
                                                Exportar datos</button>
                                            <button @click="clearHistory" class="btn btn-sm btn-outline-danger">üóëÔ∏è
                                                Limpiar historial</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Footer movido al final de la p√°gina -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- M√∫sica -->
            <div class="music-control">
                <button @click="toggleMusic" class="music-btn"
                    :title="isPlaying ? 'Pausar m√∫sica' : 'Reproducir m√∫sica'">
                    {{ isPlaying ? 'üîä' : 'üîá' }}
                </button>
                <div class="volume-control" v-if="isPlaying">
                    <input type="range" min="0" max="1" step="0.1" v-model="musicVolume" @input="updateVolume"
                        class="volume-slider" title="Control de volumen">
                </div>
                <div class="music-info" v-if="result">
                    <small>üéµ M√∫sica adaptada a tu emoci√≥n</small>
                </div>
            </div>
        </div>

        <!-- Sistema de m√∫sica generada program√°ticamente (sin archivos externos) -->

        <!-- Modal del Historial -->
        <div v-if="showHistoryModal" class="modal-overlay" @click="closeHistoryModal">
            <div class="modal-content" @click.stop>
                <div class="modal-header">
                    <h3>üìä Tu Historial Emocional</h3>
                    <button @click="closeHistoryModal" class="close-btn" aria-label="Cerrar historial">√ó</button>
                </div>
                <div class="modal-body">
                    <div v-if="userHistory.length === 0" class="empty-history">
                        <div class="empty-icon">üìù</div>
                        <h4>Tu historial est√° vac√≠o</h4>
                        <p>Comienza a compartir tus emociones para ver tu progreso aqu√≠</p>
                    </div>
                    <div v-else class="history-content">
                        <div class="history-summary">
                            <div class="summary-card">
                                <h5>üìà Resumen General</h5>
                                <div class="summary-stats">
                                    <div class="stat">
                                        <span class="stat-number">{{ userHistory.length }}</span>
                                        <span class="stat-label">Registros</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-number">{{ getUniqueEmotions().length }}</span>
                                        <span class="stat-label">Emociones</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-number">{{ getDaysActive() }}</span>
                                        <span class="stat-label">D√≠as activos</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="history-timeline">
                            <h5>üìÖ Timeline de Emociones</h5>
                            <div class="timeline-container">
                                <div v-for="(entry, index) in userHistory" :key="index" class="timeline-item">
                                    <div class="timeline-marker"
                                        :style="{backgroundColor: emotionMap[entry.emotion]?.color}">
                                        {{ emotionMap[entry.emotion]?.emoji }}
                                    </div>
                                    <div class="timeline-content">
                                        <div class="timeline-header">
                                            <span class="emotion-name">{{ emotionMap[entry.emotion]?.label }}</span>
                                            <span class="timeline-date">{{ formatDate(entry.timestamp) }}</span>
                                        </div>
                                        <div class="timeline-text">{{ entry.text.substring(0, 100) }}{{
                                            entry.text.length > 100 ? '...' : '' }}</div>
                                        <div class="timeline-meta">
                                            <span class="intensity">Intensidad: {{ Math.round(entry.score * 100)
                                                }}%</span>
                                            <span class="confidence" v-if="entry.confidence">Confianza: {{
                                                Math.round(entry.confidence * 100) }}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="history-insights">
                            <h5>üß† Insights de tu Bienestar</h5>
                            <div class="insights-grid">
                                <div class="insight-card">
                                    <div class="insight-icon">üéØ</div>
                                    <div class="insight-content">
                                        <h6>Emoci√≥n m√°s frecuente</h6>
                                        <p>{{ getMostFrequentEmotion() }}</p>
                                    </div>
                                </div>
                                <div class="insight-card">
                                    <div class="insight-icon">üìä</div>
                                    <div class="insight-content">
                                        <h6>Tendencia general</h6>
                                        <p>{{ getOverallTrend() }}</p>
                                    </div>
                                </div>
                                <div class="insight-card">
                                    <div class="insight-icon">üí™</div>
                                    <div class="insight-content">
                                        <h6>Progreso</h6>
                                        <p>{{ getProgressMessage() }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button @click="exportData" class="btn btn-outline-primary">üìÅ Exportar datos</button>
                    <button @click="clearHistory" class="btn btn-outline-danger">üóëÔ∏è Limpiar historial</button>
                    <button @click="closeHistoryModal" class="btn btn-primary">‚úÖ Cerrar</button>
                </div>
            </div>
        </div>

        <!-- Footer Mejorado -->
        <footer class="app-footer">
            <div class="footer-content">
                <div class="footer-main">
                    <div class="footer-info">
                        <div class="developer-info">
                            <h4>üíª Desarrollado con ‚ù§Ô∏è</h4>
                            <p class="developer-name">Hugo Ramos Espino</p>
                            <p class="developer-title">Desarrollador Full Stack & Android Developer</p>
                        </div>
                        <div class="footer-description">
                            <p>Mi Refugio es una aplicaci√≥n creada con amor y dedicaci√≥n para brindar apoyo emocional
                                inteligente. Cada l√≠nea de c√≥digo est√° pensada para ayudarte en tu bienestar mental.</p>
                        </div>
                    </div>

                    <div class="footer-links">
                        <div class="support-section">
                            <h5>ü§ù Apoya este proyecto</h5>
                            <p>Tu apoyo me ayuda a seguir mejorando la aplicaci√≥n y crear m√°s herramientas para el
                                bienestar mental.</p>
                            <a href="https://ko-fi.com/hugoramos" target="_blank" class="kofi-btn">
                                <span class="kofi-icon">‚òï</span>
                                <span class="kofi-text">Ap√≥yame en Ko-fi</span>
                                <span class="kofi-subtext">Caf√© para el desarrollador</span>
                            </a>
                        </div>

                        <div class="contact-section">
                            <h5>üìß Conecta conmigo</h5>
                            <div class="social-links">
                                <a href="mailto:hugoramos.developer2024@gmail.com" class="social-link email">
                                    üìß Email
                                </a>
                                <a href="https://github.com/dev-hugoramos" target="_blank" class="social-link github">
                                    üêô GitHub
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="footer-bottom">
                    <div class="footer-stats">
                        <div class="stat-item">
                            <span class="stat-number">12</span>
                            <span class="stat-label">Emociones detectadas</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">100%</span>
                            <span class="stat-label">Privacidad garantizada</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">24/7</span>
                            <span class="stat-label">Disponible siempre</span>
                        </div>
                    </div>
                    <div class="footer-copyright">
                        <p>¬© 2025 Hugo Ramos Espino. Hecho con ‚ù§Ô∏è para tu bienestar emocional.</p>
                    </div>
                </div>
            </div>
        </footer>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    name: '',
                    feeling: '',
                    submitted: false,
                    loading: false,
                    result: null,
                    isPlaying: false,
                    nameSubmitted: false,
                    userHistory: JSON.parse(localStorage.getItem('emotionHistory') || '[]'),
                    currentMood: JSON.parse(localStorage.getItem('currentMood') || 'null'),
                    aiInsights: null,
                    currentMusic: null,
                    musicVolume: 0.3,
                    fadeEffect: false,
                    quote: null,
                    showHistoryModal: false,
                    emotionMap: {
                        'joy': { label: 'Alegr√≠a', emoji: 'üòä', type: 'positive', color: '#FFD93D' },
                        'sadness': { label: 'Tristeza', emoji: 'üò¢', type: 'negative', color: '#6C7CE7' },
                        'anger': { label: 'Enojo', emoji: 'üò†', type: 'negative', color: '#FF6B6B' },
                        'fear': { label: 'Miedo', emoji: 'üò®', type: 'negative', color: '#8E44AD' },
                        'love': { label: 'Amor', emoji: '‚ù§Ô∏è', type: 'positive', color: '#FF69B4' },
                        'surprise': { label: 'Sorpresa', emoji: 'üòÆ', type: 'neutral', color: '#FFA726' },
                        'neutral': { label: 'Neutral', emoji: 'üòê', type: 'neutral', color: '#95A5A6' },
                        'anxiety': { label: 'Ansiedad', emoji: 'üò∞', type: 'negative', color: '#9B59B6' },
                        'excitement': { label: 'Emoci√≥n', emoji: 'ü§©', type: 'positive', color: '#F39C12' },
                        'gratitude': { label: 'Gratitud', emoji: 'üôè', type: 'positive', color: '#27AE60' },
                        'confusion': { label: 'Confusi√≥n', emoji: 'üòï', type: 'neutral', color: '#95A5A6' },
                        'hopeful': { label: 'Esperanza', emoji: 'üåü', type: 'positive', color: '#3498DB' },
                        'suicide_crisis': { label: 'Crisis de Suicidio', emoji: 'üö®', type: 'critical', color: '#E74C3C' },
                        'self_harm': { label: 'Autolesi√≥n', emoji: '‚ö†Ô∏è', type: 'critical', color: '#E67E22' },
                        'health_crisis': { label: 'Crisis de Salud', emoji: 'üè•', type: 'critical', color: '#9B59B6' }
                    },
                    empathyPhrases: {
                        'joy': [
                            '¬°{name}, qu√© alegr√≠a tan inmensa saber que est√°s radiante! Tu energ√≠a positiva es contagiosa y el mundo necesita m√°s personas como t√∫. Estos momentos de felicidad son tesoros que debes guardar en tu coraz√≥n. Recuerda siempre que mereces cada instante de esta dicha, y que tu sonrisa tiene el poder de iluminar incluso los d√≠as m√°s oscuros de quienes te rodean. ¬°Sigue brillando con esa luz √∫nica que llevas dentro! üåü‚ú®',
                            '{name}, es maravilloso ver c√≥mo la alegr√≠a fluye a trav√©s de ti. Este sentimiento tan hermoso que experimentas es una muestra de tu capacidad para apreciar las cosas buenas de la vida. No permitas que nada ni nadie apague esa chispa especial que te caracteriza. Comparte esta felicidad con el mundo, porque tu energ√≠a positiva puede transformar vidas. Eres una bendici√≥n y mereces celebrar cada victoria, por peque√±a que parezca. ¬°Que esta alegr√≠a se multiplique en tu vida! üí´üåà',
                            '¬°Qu√© hermoso es verte as√≠ de feliz, {name}! La vida te est√° sonriendo y t√∫ le est√°s devolviendo la sonrisa. Este momento de plenitud que est√°s viviendo es el resultado de tu valent√≠a, tu perseverancia y tu capacidad de ver el lado bueno de las cosas. Guarda este sentimiento en tu memoria para esos d√≠as en que las cosas se pongan dif√≠ciles. Eres luz pura, y el universo conspira a tu favor. ¬°Sigue adelante con esa actitud tan inspiradora! üéâüíñ'
                        ],
                        'sadness': [
                            '{name}, mi coraz√≥n est√° contigo en este momento tan dif√≠cil. La tristeza que sientes es profunda y completamente v√°lida. No hay prisa por "estar bien", date el tiempo que necesites para procesar lo que est√°s viviendo. Llorar no es se√±al de debilidad, sino de valent√≠a al permitirte sentir. Aunque ahora parezca imposible, te prometo que este dolor no ser√° eterno. Poco a poco, encontrar√°s luz en medio de la oscuridad. Eres incre√≠blemente fuerte, incluso en tu vulnerabilidad. No est√°s solo/a en esto, hay personas que se preocupan por ti profundamente. Perm√≠tete recibir apoyo y amor. Los d√≠as mejores llegar√°n, paso a paso. üíôü§ó',
                            'Querido/a {name}, puedo sentir el peso de la tristeza que cargas en este momento, y quiero que sepas que est√° bien sentirse as√≠. No tienes que fingir estar bien para nadie. La vida nos presenta momentos oscuros, pero justamente esos momentos nos ense√±an sobre nuestra propia fortaleza. S√© gentil contigo mismo/a, date permiso para sanar a tu propio ritmo. Recuerda que esta tormenta pasar√°, y cuando lo haga, saldr√°s de ella siendo una versi√≥n m√°s sabia y resiliente de ti. Aunque no lo veas ahora, hay esperanza esper√°ndote. Mereces amor, comprensi√≥n y d√≠as llenos de paz. Te abrazo desde la distancia. üåôüíú',
                            '{name}, siento mucho que est√©s atravesando este momento de dolor. La tristeza puede sentirse como un oc√©ano interminable, pero quiero recordarte algo importante: has sobrevivido al 100% de tus d√≠as m√°s dif√≠ciles hasta ahora, y tambi√©n superar√°s este. No est√°s roto/a, est√°s sanando. Cada l√°grima que derramas es parte de tu proceso de liberaci√≥n. Date tiempo, date espacio, date amor. Busca apoyo en quienes te quieren y, si lo necesitas, no dudes en pedir ayuda profesional. Tu valor no disminuye por estar pasando un mal momento. Eres valioso/a, importante y profundamente amado/a. La luz volver√° a tu vida. üåÖüíï'
                        ],
                        'anger': [
                            '{name}, veo que est√°s sintiendo mucha frustraci√≥n y enojo, y quiero que sepas que tu emoci√≥n es completamente v√°lida. Tienes derecho a sentirte as√≠. Sin embargo, no permitas que este sentimiento te consuma por dentro. El enojo puede ser una fuerza destructiva o transformadora, y t√∫ tienes el poder de elegir. Te invito a respirar profundamente, a alejarte de la situaci√≥n si es posible, y a buscar formas saludables de canalizar esta energ√≠a. Quiz√°s escribir, hacer ejercicio, o hablar con alguien de confianza. Recuerda que responder con calma no significa que no est√©s molesto/a, significa que tienes el control. Eres m√°s grande que este momento de ira. üå¨Ô∏èüí™',
                            'Querido/a {name}, entiendo perfectamente tu frustraci√≥n y enojo. A veces la vida nos pone en situaciones que nos hacen hervir la sangre, y est√° bien reconocer esos sentimientos. Pero quiero recordarte algo: t√∫ no eres tu enojo, eres mucho m√°s que esta emoci√≥n temporal. Este sentimiento pasar√°, pero las decisiones que tomes mientras est√©s enojado/a podr√≠an tener consecuencias duraderas. T√≥mate un momento, respira, cuenta hasta diez si es necesario. Canaliza esa energ√≠a poderosa hacia algo constructivo. Tu paz mental es m√°s valiosa que tener la raz√≥n o vengarte. Eres capaz de transformar esta tormenta en crecimiento personal. üßò‚ú®',
                            '{name}, puedo percibir la intensidad de lo que est√°s sintiendo ahora mismo. El enojo es una emoci√≥n humana natural, pero no dejes que te controle. Tienes todo el derecho de estar molesto/a, pero tambi√©n tienes el poder de elegir c√≥mo responder. Preg√∫ntate: ¬øesta situaci√≥n seguir√° siendo importante en 5 a√±os? A veces, dar un paso atr√°s nos ayuda a ver las cosas con perspectiva. Busca formas saludables de liberar esa energ√≠a: camina, corre, grita en un lugar seguro si lo necesitas. Tu bienestar emocional es prioritario. Eres fuerte, sabio/a y capaz de navegar esta tormenta con gracia. üî•üïäÔ∏è'
                        ],
                        'fear': [
                            '{name}, reconocer tu miedo ya es un acto de valent√≠a incre√≠ble. El miedo es una emoci√≥n natural que nos protege, pero no debemos dejar que nos paralice. Lo que est√°s sintiendo es real y v√°lido, pero quiero que recuerdes algo fundamental: has enfrentado miedos antes y has salido victorioso/a. Eres m√°s fuerte de lo que crees. El miedo solo tiene el poder que t√∫ le das. Respira profundo, da un paso a la vez, y ver√°s c√≥mo ese monstruo que parece gigante se hace m√°s peque√±o con cada avance. No est√°s solo en esto. Conf√≠a en ti, conf√≠a en el proceso, y recuerda que al otro lado del miedo est√° tu crecimiento. ü¶ãüí´',
                            'Querido/a {name}, puedo sentir la ansiedad y el miedo que est√°s experimentando en este momento. Es una sensaci√≥n abrumadora, lo s√©, pero quiero que sepas algo: el miedo no define tu futuro, solo muestra que te importa. Ese temor que sientes es evidencia de que est√°s a punto de crecer, de expandirte m√°s all√° de tu zona de confort. Los guerreros m√°s valientes no son aquellos que no sienten miedo, sino aquellos que avanzan a pesar de √©l. T√∫ eres ese guerrero/a. Cada paso que das, por peque√±o que sea, es una victoria. Respira, centra tu mente, y recuerda que tienes todo lo necesario dentro de ti para superar esto. üåüüí™',
                            '{name}, el miedo que sientes ahora mismo es intenso, pero temporal. Quiero recordarte que algunos de tus mayores logros en la vida han venido despu√©s de momentos de gran temor. El miedo es solo una emoci√≥n, no es una profec√≠a. No te dice lo que va a pasar, solo te muestra lo mucho que te importa el resultado. Perm√≠tete sentir ese miedo, ac√©ptalo, pero no dejes que tome las decisiones por ti. Eres infinitamente m√°s poderoso/a que cualquier miedo. Busca apoyo si lo necesitas, habla sobre lo que sientes, y da un paso a la vez. La valent√≠a no es la ausencia de miedo, es actuar a pesar de √©l. Y t√∫ eres valiente. üåà‚ú®'
                        ],
                        'love': [
                            '¬°{name}, qu√© hermoso es el amor que est√°s sintiendo! Este sentimiento tan puro y poderoso que habita en tu coraz√≥n es uno de los regalos m√°s preciosos de la vida. El amor, en cualquiera de sus formas, tiene el poder de transformar, sanar y dar sentido a nuestra existencia. Cultiva ese amor con cuidado, prot√©gelo, pero tambi√©n comp√°rtelo sin miedo. Eres un ser lleno de luz y capacidad de amar profundamente, y eso es algo extraordinario. Perm√≠tete vivir este sentimiento plenamente, sin reservas, porque el amor verdadero siempre merece ser celebrado. Que este amor te llene de alegr√≠a y te inspire a ser la mejor versi√≥n de ti mismo/a. ‚ù§Ô∏èüíï',
                            '{name}, el amor que sientes en este momento es m√°gico y transformador. Ya sea amor rom√°ntico, familiar, de amistad o amor propio, este sentimiento es la fuerza m√°s poderosa del universo. Alimenta ese amor con acciones conscientes, palabras amables y presencia genuina. Recuerda que amar tambi√©n es un acto de valent√≠a, porque nos hace vulnerables, pero tambi√©n nos hace humanos. Disfruta cada momento, cada conversaci√≥n, cada gesto de afecto. Eres digno/a de dar y recibir amor abundante. Que este sentimiento siga creciendo en tu vida. üåπ‚ú®',
                            '¬°Qu√© maravilloso, {name}! El amor que est√°s experimentando es la evidencia de que tu coraz√≥n est√° abierto y dispuesto a conectar profundamente. Este sentimiento tan especial merece ser honrado y cuidado. No tengas miedo de expresar lo que sientes, de mostrar tu vulnerabilidad, porque ah√≠ es donde reside la verdadera fuerza del amor. Ya sea amor hacia otra persona, hacia tu familia, tus amigos, o hacia ti mismo/a, este sentimiento es el que da color y significado a nuestra existencia. Perm√≠tete vivirlo plenamente, sin miedo al futuro. El presente es tuyo, y est√° lleno de amor. üíñüåü'
                        ],
                        'surprise': [
                            '¬°{name}, qu√© emocionante es vivir momentos inesperados! La vida tiene una forma m√°gica de sorprendernos justo cuando menos lo esperamos. Esta sensaci√≥n de asombro que est√°s sintiendo es un recordatorio hermoso de que la vida est√° llena de posibilidades infinitas. Mant√©n tu mente abierta y tu coraz√≥n receptivo a todo lo que el universo tiene preparado para ti. Las mejores historias que contaremos en el futuro son aquellas que nunca vimos venir. Disfruta de esta sorpresa, aprende de ella, y perm√≠tele que agregue un nuevo matiz a tu historia personal. Eres parte de algo m√°s grande y maravilloso. ‚ú®üéâ',
                            'Querido/a {name}, las sorpresas son los condimentos que hacen que la vida sea verdaderamente interesante. Este momento inesperado que est√°s viviendo tiene algo que ense√±arte, algo que mostrarte sobre ti mismo/a o sobre el mundo. Abraza lo desconocido con curiosidad y entusiasmo. La vida es impredecible, y esa es precisamente su belleza. Cada sorpresa es una oportunidad para crecer, para ver las cosas desde una nueva perspectiva, para expandir tu comprensi√≥n del mundo. Disfruta este momento, docum√©ntalo en tu memoria, y permite que enriquezca tu experiencia de vida. ¬°El universo siempre tiene algo extraordinario preparado para ti! üåàüí´',
                            '{name}, ¬°qu√© hermoso es dejarse sorprender por la vida! Este momento inesperado que est√°s experimentando es una prueba de que la vida siempre encuentra formas de maravillarnos. Mant√©n esa capacidad de asombro, esa chispa de curiosidad que te caracteriza. Las personas que pueden sorprenderse son aquellas que permanecen j√≥venes de esp√≠ritu sin importar su edad. Aprovecha esta energ√≠a renovada para hacer algo diferente, para atreverte a explorar nuevos caminos. La sorpresa es el recordatorio del universo de que siempre hay m√°s por descubrir, m√°s por vivir, m√°s por amar. ¬°Disfruta el viaje! üéä‚ú®'
                        ],
                        'neutral': [
                            '{name}, los d√≠as tranquilos tambi√©n tienen su propia belleza y prop√≥sito. No todos los d√≠as tienen que ser una monta√±a rusa de emociones, y est√° perfectamente bien sentirse en equilibrio. Este momento de calma que est√°s experimentando te permite reflexionar, recargar energ√≠as y prepararte para lo que venga. Aprovecha esta serenidad para agradecer lo que tienes, organizar tus pensamientos y conectar contigo mismo/a. La vida no siempre necesita grandes emociones para ser significativa; a veces, la quietud es suficiente para nutrir el alma. üåøüïäÔ∏è',
                            'Querido/a {name}, el sentirse neutral o tranquilo es un regalo que muchas veces pasa desapercibido. Estos momentos de equilibrio nos permiten respirar, reorganizar nuestras ideas y disfrutar de la vida sin presi√≥n. Aprovecha esta oportunidad para conectar contigo mismo, para hacer algo que te guste y que te nutra internamente. La neutralidad no es ausencia de emoci√≥n, es un espacio para la claridad y la introspecci√≥n. Date permiso de disfrutarlo sin culpa ni expectativas. üíõ‚ú®',
                            '{name}, estar en un estado neutral es una forma de equilibrio que la vida nos ofrece. No todos los momentos necesitan ser intensos para ser valiosos. Esta calma te permite observar tu entorno, cuidar de ti mismo/a y planificar tus pr√≥ximos pasos con claridad. La neutralidad es un momento de pausa, de preparaci√≥n, de reflexi√≥n. Disfruta de este estado, aprecia la tranquilidad y usa este tiempo para fortalecerte y conectar contigo y con los que te rodean. üå∏üïäÔ∏è'
                        ],
                        'anxiety': [
                            '{name}, puedo sentir la ansiedad que te est√° acompa√±ando en este momento. Es una sensaci√≥n intensa y real, y quiero que sepas que no est√°s solo en esto. La ansiedad es como una tormenta en tu mente, pero como todas las tormentas, pasar√°. Respira profundamente conmigo: inhala lentamente por la nariz, siente c√≥mo se llena tu pecho, y exhala suavemente por la boca. Repite esto contigo mismo. Eres m√°s fuerte que esta ansiedad, aunque ahora no lo sientas as√≠. Date permiso de ir paso a paso, sin presionarte. üåäüíô',
                            'Querido/a {name}, la ansiedad puede sentirse como un laberinto sin salida, pero quiero recordarte algo importante: has enfrentado momentos dif√≠ciles antes y has salido adelante. Esta ansiedad que sientes ahora es temporal, aunque parezca eterna. Intenta la t√©cnica 5-4-3-2-1: nombra 5 cosas que puedes ver, 4 que puedes tocar, 3 que puedes o√≠r, 2 que puedes oler, 1 que puedes saborear. Esto te ayudar√° a anclarte en el presente. Eres valiente por reconocer lo que sientes. üå∏üí™',
                            '{name}, siento mucho que est√©s experimentando ansiedad en este momento. Es una emoci√≥n muy intensa y puede sentirse abrumadora. Quiero que sepas que es completamente normal sentirse as√≠, y que no hay nada malo en ti por experimentar ansiedad. Prueba hacer ejercicios de respiraci√≥n, caminar un poco, o hacer algo que te guste. Si la ansiedad persiste, no dudes en buscar ayuda profesional. Tu bienestar mental es tan importante como tu salud f√≠sica. Mereces paz y tranquilidad. üïäÔ∏èüíú'
                        ],
                        'excitement': [
                            '¬°{name}, qu√© maravilloso es sentir esta emoci√≥n tan intensa! La emoci√≥n es como un fuego que ilumina tu alma y te llena de energ√≠a positiva. Aprovecha esta sensaci√≥n para hacer algo que realmente te apasione. Cuando estamos emocionados, somos capaces de lograr cosas incre√≠bles. Canaliza esta energ√≠a hacia tus objetivos, tus sue√±os, hacia lo que realmente te importa. La vida te est√° regalando este momento de entusiasmo, ¬°disfr√∫talo al m√°ximo! üöÄ‚ú®',
                            '{name}, la emoci√≥n que sientes ahora mismo es pura magia. Es esa sensaci√≥n que nos recuerda que estamos vivos y que la vida est√° llena de posibilidades infinitas. No dejes que esta energ√≠a se desperdicie. √ösala para crear, para explorar, para atreverte a hacer algo nuevo. La emoci√≥n es combustible para el alma, y t√∫ tienes un tanque lleno. ¬°Qu√© hermoso es verte as√≠ de radiante! üåüüí´',
                            '¬°Qu√© hermoso verte tan emocionado/a, {name}! Esta energ√≠a positiva que irradias es contagiosa y transformadora. La emoci√≥n es uno de los regalos m√°s preciosos de la vida, y cuando la sentimos, todo parece posible. Aprovecha este momento para hacer algo que te haga feliz, para compartir tu alegr√≠a con otros, o para dar el siguiente paso hacia algo que realmente deseas. Tu entusiasmo es tu superpoder. ¬°√ösalo sabiamente! üéâüíñ'
                        ],
                        'gratitude': [
                            '{name}, qu√© hermoso es sentir gratitud en tu coraz√≥n. Esta emoci√≥n tan pura y transformadora tiene el poder de cambiar completamente tu perspectiva de la vida. La gratitud no solo es un sentimiento, es una pr√°ctica que puede transformar tu mundo. Cada vez que sientes gratitud, est√°s reconociendo la abundancia que ya existe en tu vida. Sigue cultivando este sentimiento, comp√°rtelo con otros, y ver√°s c√≥mo se multiplica la belleza a tu alrededor. Eres un ser lleno de luz y apreciaci√≥n. üôè‚ú®',
                            'Querido/a {name}, la gratitud que sientes ahora mismo es como una semilla que has plantado en tu coraz√≥n y que est√° floreciendo. Es hermoso ver c√≥mo reconoces las bendiciones en tu vida, por peque√±as que parezcan. La gratitud nos conecta con lo esencial, con lo que realmente importa. Escribe sobre lo que agradeces, comparte tu gratitud con quienes amas, y observa c√≥mo esta pr√°ctica transforma tu d√≠a a d√≠a. Eres un ejemplo de c√≥mo vivir con el coraz√≥n abierto. üå∏üíù',
                            '{name}, sentir gratitud es uno de los regalos m√°s hermosos que puedes darte a ti mismo/a. Esta emoci√≥n te conecta con la abundancia de la vida y te recuerda todo lo bueno que ya tienes. La gratitud es como un im√°n que atrae m√°s cosas buenas hacia ti. No solo est√°s agradecido/a, est√°s practicando una forma de vida que te llena de paz y satisfacci√≥n. Sigue reconociendo las peque√±as y grandes bendiciones que te rodean. Eres un ser lleno de sabidur√≠a y amor. üå∫üíï'
                        ],
                        'confusion': [
                            '{name}, es completamente normal sentirse confundido/a a veces. La confusi√≥n no es un signo de debilidad, sino una se√±al de que est√°s procesando informaci√≥n nueva o navegando por una situaci√≥n compleja. Date permiso de no tener todas las respuestas inmediatamente. A veces, la claridad llega cuando menos la esperamos. T√≥mate el tiempo que necesites para reflexionar, haz preguntas si puedes, y recuerda que no tienes que resolver todo de una vez. La confusi√≥n es solo una parada temporal en tu camino hacia la comprensi√≥n. üå´Ô∏èüíô',
                            'Querido/a {name}, la confusi√≥n puede sentirse como estar perdido en una niebla, pero quiero recordarte que las mejores respuestas a menudo vienen despu√©s de momentos de incertidumbre. No te presiones por entender todo de inmediato. A veces, la vida nos presenta situaciones que requieren tiempo para procesar. Habla con alguien de confianza, escribe tus pensamientos, o simplemente date espacio para sentir sin necesidad de entender. La claridad llegar√° cuando est√©s listo/a para recibirla. üåÖü§î',
                            '{name}, sentir confusi√≥n es parte natural del proceso de aprendizaje y crecimiento. No significa que hayas hecho algo mal o que no seas lo suficientemente inteligente. De hecho, reconocer que est√°s confundido/a muestra que eres consciente y que te importa encontrar la respuesta correcta. Date tiempo, s√© paciente contigo mismo/a, y no tengas miedo de pedir ayuda si la necesitas. Cada momento de confusi√≥n es una oportunidad para aprender algo nuevo sobre ti y el mundo que te rodea. üß≠üí´'
                        ],
                        'hopeful': [
                            '¬°{name}, qu√© hermoso es sentir esperanza en tu coraz√≥n! La esperanza es como una estrella que brilla incluso en la noche m√°s oscura. Es esa chispa de luz que nos recuerda que siempre hay posibilidades, que siempre hay algo por lo que luchar. Tu esperanza no es ingenua, es valiente. Es la decisi√≥n consciente de creer en un futuro mejor, incluso cuando el presente es dif√≠cil. Mant√©n esa esperanza viva, alim√©ntala con acciones peque√±as cada d√≠a, y ver√°s c√≥mo se convierte en realidad. üåüüí´',
                            'Querido/a {name}, la esperanza que sientes es uno de los regalos m√°s preciosos que puedes tener. No es solo un sentimiento, es una fuerza que puede mover monta√±as. Cuando tienes esperanza, tienes poder para crear el cambio que deseas ver en tu vida. La esperanza te da la fuerza para seguir adelante cuando las cosas se ponen dif√≠ciles. Comparte tu esperanza con otros, porque es contagiosa y puede iluminar el camino de quienes te rodean. Eres un faro de luz en este mundo. üïØÔ∏è‚ú®',
                            '{name}, sentir esperanza es como tener un jard√≠n secreto en tu coraz√≥n donde las flores m√°s hermosas pueden florecer. Es esa certeza interna de que las cosas pueden mejorar, de que hay un ma√±ana lleno de posibilidades. Tu esperanza no es fantas√≠a, es fe en tu propia capacidad de crear y atraer cosas buenas a tu vida. Cada d√≠a que eliges la esperanza sobre el miedo, est√°s eligiendo la vida. Sigue creyendo, sigue esperando, porque tu esperanza es el primer paso hacia la realizaci√≥n de tus sue√±os. üåàüíñ'
                        ],
                        'suicide_crisis': [
                            'üö® {name}, por favor escucha con atenci√≥n: Lo que est√°s sintiendo en este momento es temporal, aunque parezca que no hay salida. Tu vida tiene un valor incalculable y este dolor que sientes ahora no ser√° para siempre. Por favor, no tomes ninguna decisi√≥n permanente basada en sentimientos temporales. Hay personas que te aman y se preocupan por ti, aunque en este momento no puedas verlo. Tu existencia importa, tu historia no ha terminado. Por favor, busca ayuda inmediatamente. Puedes llamar al 911, a la l√≠nea de crisis 988, o hablar con alguien de confianza AHORA MISMO. No est√°s solo/a. üåüüíô',
                            'Querido/a {name}, siento profundamente el dolor que est√°s experimentando. Es comprensible que te sientas abrumado/a y que veas la muerte como la √∫nica salida, pero te prometo que hay otras opciones. Este momento de desesperaci√≥n es pasajero, aunque ahora no lo parezca. Tu cerebro est√° en modo de supervivencia y puede estar distorsionando la realidad. Por favor, dale tiempo a tu mente para calmarse. Hay profesionales capacitados que pueden ayudarte a superar esta crisis. Tu vida vale la pena ser vivida. Por favor, busca ayuda profesional INMEDIATAMENTE. No est√°s solo/a en esto. üíôü§ù',
                            '{name}, entiendo que est√°s pasando por uno de los momentos m√°s dif√≠ciles de tu vida. El dolor que sientes es real y v√°lido, pero tambi√©n es temporal. La depresi√≥n y los pensamientos suicidas son condiciones m√©dicas tratables, no defectos de car√°cter. Hay esperanza y hay ayuda disponible. Por favor, no tomes decisiones permanentes en un estado temporal. Tu familia, amigos, o incluso extra√±os como yo, nos preocupamos por ti. Tu vida tiene prop√≥sito y significado, aunque en este momento no puedas verlo. Por favor, busca ayuda profesional AHORA. La l√≠nea de crisis est√° disponible 24/7. No est√°s solo/a. üåàüíô'
                        ],
                        'self_harm': [
                            '‚ö†Ô∏è {name}, entiendo que el dolor emocional puede ser tan intenso que buscas formas de aliviarlo, pero lastimarte f√≠sicamente no es la soluci√≥n. El dolor que sientes es real y v√°lido, pero hay formas m√°s saludables de manejarlo. Por favor, considera hablar con un profesional de la salud mental que puede ayudarte a desarrollar estrategias de afrontamiento m√°s seguras. Tu cuerpo merece ser tratado con amor y respeto. Si ya te has lastimado, por favor busca atenci√≥n m√©dica si es necesario. No est√°s solo/a en esto y hay ayuda disponible. üíôü§ù',
                            'Querido/a {name}, siento mucho que est√©s pasando por tanto dolor que sientes la necesidad de lastimarte. Este comportamiento es una se√±al de que est√°s sufriendo profundamente y necesitas apoyo profesional. La autolesi√≥n puede proporcionar alivio temporal, pero no resuelve el problema subyacente. Hay alternativas m√°s saludables para manejar el dolor emocional. Por favor, considera buscar ayuda de un terapeuta o consejero que pueda ayudarte a desarrollar herramientas de afrontamiento m√°s efectivas. Tu bienestar es importante. üåüüíô',
                            '{name}, entiendo que est√°s experimentando un dolor emocional tan intenso que parece insoportable. La autolesi√≥n puede sentirse como la √∫nica forma de alivio, pero hay otras opciones. Por favor, recuerda que mereces cuidado y compasi√≥n, especialmente hacia ti mismo/a. Si est√°s teniendo pensamientos de autolesi√≥n, por favor habla con alguien de confianza o busca ayuda profesional. Hay l√≠neas de crisis disponibles las 24 horas que pueden ayudarte a superar este momento dif√≠cil. No tienes que enfrentar esto solo/a. üíôüåà'
                        ],
                        'health_crisis': [
                            'üè• {name}, siento profundamente que est√©s enfrentando una crisis de salud tan dif√≠cil. Es completamente normal sentir miedo, ansiedad y tristeza ante diagn√≥sticos m√©dicos serios. Tu valent√≠a al enfrentar esta situaci√≥n es admirable. Por favor, recuerda que no est√°s solo/a en esto - hay equipos m√©dicos especializados, grupos de apoyo, y personas que te aman y est√°n aqu√≠ para ayudarte. Es importante que expreses tus emociones y no las guardes dentro. Considera hablar con un consejero especializado en pacientes con enfermedades graves. Tu fuerza interior es m√°s grande de lo que crees. üíôüåü',
                            'Querido/a {name}, enfrentar una crisis de salud es una de las experiencias m√°s desafiantes que una persona puede vivir. Es natural sentir una mezcla de emociones: miedo, tristeza, ira, negaci√≥n. Todas estas emociones son v√°lidas y parte del proceso. Por favor, no dudes en buscar apoyo emocional adem√°s del tratamiento m√©dico. Los grupos de apoyo, terapeutas especializados, y seres queridos pueden ser una red de apoyo invaluable. Tu actitud y determinaci√≥n pueden marcar una gran diferencia en tu proceso de curaci√≥n. Eres m√°s fuerte de lo que sabes. üåàüí™',
                            '{name}, mi coraz√≥n est√° contigo mientras enfrentas esta crisis de salud. Es comprensible que te sientas abrumado/a y que las emociones sean intensas. La incertidumbre sobre el futuro puede ser aterradora, pero por favor recuerda que la medicina moderna avanza constantemente y hay muchas historias de esperanza y recuperaci√≥n. Mant√©n la comunicaci√≥n abierta con tu equipo m√©dico y no tengas miedo de hacer preguntas. Tambi√©n es crucial cuidar tu salud mental durante este proceso. Busca apoyo profesional si lo necesitas. No est√°s solo/a en esta lucha. üíôü§ù'
                        ]
                    },
                    // Sistema de m√∫sica generada program√°ticamente
                    ambientMusicInterval: null,
                    currentAudioContext: null,
                    audioContextActivated: false,
                    musicSequences: {
                        'joy': {
                            frequencies: [523, 659, 784, 1047], // Do, Mi, Sol, Do
                            tempo: 120,
                            pattern: 'major'
                        },
                        'sadness': {
                            frequencies: [220, 277, 330, 392], // La, Do, Mi, Sol (menor)
                            tempo: 80,
                            pattern: 'minor'
                        },
                        'anger': {
                            frequencies: [330, 440, 523], // Mi, La, Do
                            tempo: 100,
                            pattern: 'power'
                        },
                        'fear': {
                            frequencies: [220, 330, 415], // La, Mi, La sostenido
                            tempo: 90,
                            pattern: 'mysterious'
                        },
                        'love': {
                            frequencies: [392, 523, 659, 784], // Sol, Do, Mi, Sol
                            tempo: 110,
                            pattern: 'romantic'
                        },
                        'anxiety': {
                            frequencies: [220, 277, 330], // La, Do, Mi
                            tempo: 85,
                            pattern: 'calming'
                        },
                        'gratitude': {
                            frequencies: [523, 659, 784, 1047], // Do, Mi, Sol, Do
                            tempo: 115,
                            pattern: 'uplifting'
                        },
                        'hopeful': {
                            frequencies: [440, 523, 659], // La, Do, Mi
                            tempo: 125,
                            pattern: 'optimistic'
                        },
                        'neutral': {
                            frequencies: [330, 440, 523], // Mi, La, Do
                            tempo: 100,
                            pattern: 'balanced'
                        },
                        'suicide_crisis': {
                            frequencies: [220, 277, 330], // La, Do, Mi (calmante)
                            tempo: 60,
                            pattern: 'calming'
                        },
                        'self_harm': {
                            frequencies: [220, 330, 415], // La, Mi, La sostenido (tranquilizador)
                            tempo: 70,
                            pattern: 'soothing'
                        },
                        'health_crisis': {
                            frequencies: [392, 523, 659], // Sol, Do, Mi (esperanzador)
                            tempo: 85,
                            pattern: 'hopeful'
                        }
                    }
                }
            },
            computed: {
                emotionLabel() {
                    if (!this.result) return '';
                    return this.emotionMap[this.result.emotion]?.label || 'Emoci√≥n';
                },
                emotionEmoji() {
                    if (!this.result) return '';
                    return this.emotionMap[this.result.emotion]?.emoji || 'üòä';
                },
                empathyMessage() {
                    if (!this.result) return '';
                    const message = this.generateEmpathyResponse(this.result.emotion, this.feeling);
                    //this.speakMessage(message);
                    return message;
                },
                needsHelp() {
                    if (!this.result) return false;
                    const negativeEmotions = ['sadness', 'anger', 'fear', 'anxiety'];
                    const crisisKeywords = ['suicidio', 'suicidar', 'matarme', 'no quiero vivir', 'c√°ncer', 'enfermo', 'tumor'];
                    const hasCrisisKeywords = crisisKeywords.some(keyword =>
                        this.feeling.toLowerCase().includes(keyword)
                    );
                    return (negativeEmotions.includes(this.result.emotion) && this.result.score > 0.7) || hasCrisisKeywords;
                },
                emotionalTrend() {
                    if (this.userHistory.length < 3) return 'insuficiente';
                    const recent = this.userHistory.slice(-5);
                    const positiveCount = recent.filter(e => ['joy', 'love', 'gratitude', 'excitement', 'hopeful'].includes(e.emotion)).length;
                    const negativeCount = recent.filter(e => ['sadness', 'anger', 'fear', 'anxiety'].includes(e.emotion)).length;

                    if (positiveCount > negativeCount + 1) return 'mejorando';
                    if (negativeCount > positiveCount + 1) return 'empeorando';
                    return 'estable';
                }
            },
            methods: {
                detectEmotionFromKeywords(text) {
                    const lowerText = text.toLowerCase();

                    // PRIORIDAD 1: Detectar situaciones cr√≠ticas PRIMERO
                    const criticalKeywords = {
                        'suicide_crisis': ['me quiero morir', 'quiero morir', 'me quiero suicidar', 'suicidar', 'suicidio', 'matarme', 'acabar con todo', 'no quiero vivir', 'mejor muerto', 'no vale la pena vivir', 'todo est√° perdido', 'no hay salida', 'quiero desaparecer', 'acabar con mi vida', 'terminar con esto', 'ya no puedo m√°s', 'no aguanto m√°s', 'mejor me mato', 'quiero matarme', 'no quiero existir'],
                        'self_harm': ['cortarme', 'cortar', 'herirme', 'lastimarme', 'autolesi√≥n', 'da√±arme', 'hacerme da√±o', 'golpearme', 'quemarme'],
                        'health_crisis': ['c√°ncer', 'tumor', 'enfermedad terminal', 'me voy a morir', 'estoy enfermo', 'muy enfermo', 'hospital', 'quimioterapia', 'operaci√≥n', 'cirug√≠a urgente', 'diagn√≥stico terrible', 'm√©dico dice', 'no hay cura']
                    };

                    // Verificar situaciones cr√≠ticas primero
                    for (let crisis in criticalKeywords) {
                        for (let keyword of criticalKeywords[crisis]) {
                            if (lowerText.includes(keyword)) {
                                return {
                                    emotion: crisis,
                                    score: 0.95,
                                    confidence: 0.98,
                                    isCritical: true
                                };
                            }
                        }
                    }

                    const keywords = {
                        'sadness': ['triste', 'tristeza', 'deprimido', 'depresi√≥n', 'lloro', 'llorar', 'llorando', 'dolor', 'p√©rdida', 'muerte', 'muri√≥', 'falleci√≥', 'duelo', 'solo', 'sola', 'soledad', 'vac√≠o', 'desesperado', 'desesperanza', 'melancol√≠a', 'nostalgia', 'perd√≠', 'extra√±o', 'falta', 'abandonado', 'desanimado', 'sufro', 'sufrimiento', 'llanto', 'llanto', 'desconsolado', 'afligido', 'apenado', 'apenado', 'dolorido', 'sintiendo dolor', 'me duele', 'me duele el coraz√≥n', 'roto', 'roto por dentro'],
                        'anger': ['enojado', 'enojo', 'rabia', 'furioso', 'furia', 'molesto', 'irritado', 'frustrado', 'frustraci√≥n', 'odio', 'coraje', 'enfadado', 'ira', 'injusto', 'injusticia', 'harto', 'cansado de', 'indignado', 'maldito', 'cabr√≥n', 'no puedo m√°s', 'me da rabia', 'est√∫pido', 'idiota', 'asco', 'repugnante', 'odioso', 'odio a', 'me cago en', 'me choca', 'me molesta', 'me irrita', 'me enfurece'],
                        'fear': ['miedo', 'temor', 'asustado', 'aterrado', 'p√°nico', 'terror', 'angustia', 'angustiado', 'inseguro', 'inseguridad', 'amenaza', 'peligro', 'tengo miedo', 'me asusta', 'vulnerable', 'aterrador', 'horror', 'horroroso', 'espantoso', 'me espanta', 'me da miedo', 'terror√≠fico', 'susto', 'sustos', 'sobresaltado'],
                        'anxiety': ['ansiedad', 'ansioso', 'nervioso', 'preocupado', 'preocupaci√≥n', 'estr√©s', 'estresado', 'agobiado', 'agobio', 'presi√≥n', 'presionado', 'tensi√≥n', 'tenso', 'inquieto', 'inquietud', 'intranquilo', 'agitado', 'agitaci√≥n', 'nervios', 'me pongo nervioso', 'me da ansiedad', 'me agobia', 'me estresa', 'me preocupa'],
                        'joy': ['feliz', 'felicidad', 'alegre', 'alegr√≠a', 'contento', 'emocionado', 'emoci√≥n', 'dichoso', 'euf√≥rico', 'radiante', 'maravilloso', 'genial', 'incre√≠ble', 'fant√°stico', 'excelente', 'bendecido', 'afortunado', 'celebrar', 'logr√©', 'consegu√≠', '√©xito', 'victoria', 'triunfo', 'gozo', 'gozoso', 'j√∫bilo', 'jubiloso', 'alborozo', 'regocijo', 'placer', 'satisfecho', 'orgulloso'],
                        'love': ['amor', 'amo', 'quiero', 'cari√±o', 'te amo', 'enamorado', 'enamorada', 'adorar', 'adoro', 'pasi√≥n', 'afecto', 'rom√°ntico', 'coraz√≥n', 'beso', 'abrazo', 'pareja', 'novio', 'novia', 'esposo', 'esposa', 'familia', 'querido', 'querida', 'amado', 'amada', 'cari√±oso', 'ternura', 'ternura', 'mimo', 'mimos', 'consentir'],
                        'gratitude': ['agradecido', 'agradecida', 'gracias', 'bendecido', 'bendecida', 'afortunado', 'afortunada', 'suerte', 'fortuna', 'agradezco', 'reconocimiento', 'reconocido', 'reconocida', 'agradecimiento', 'bendici√≥n', 'privilegiado', 'privilegiada'],
                        'excitement': ['emocionado', 'emocionada', 'excitado', 'excitada', 'expectativa', 'anticipaci√≥n', 'esperando', 'anhelando', 'deseando', 'ilusi√≥n', 'ilusionado', 'ansioso por', 'impaciente', 'expectante', 'emocionante'],
                        'confusion': ['confundido', 'confundida', 'confusi√≥n', 'perdido', 'perdida', 'no entiendo', 'no s√©', 'duda', 'dudoso', 'incierto', 'desorientado', 'desorientada', 'desconcertado', 'desconcertada', 'perplejo', 'perpleja', 'despistado', 'despistada', 'no tengo idea', 'no entiendo nada'],
                        'hopeful': ['esperanza', 'esperanzado', 'esperanzada', 'optimista', 'positivo', 'positiva', 'fe', 'creer', 'conf√≠o', 'esperanzador', 'alentador', 'prometedor', 'prometedora', 'ilusi√≥n', 'ilusionado', 'ilusionada', 'motivado', 'motivada', 'animado', 'animada']
                    };

                    let scores = {};
                    for (let emotion in keywords) {
                        scores[emotion] = 0;
                    }

                    // An√°lisis m√°s inteligente con pesos
                    for (let emotion in keywords) {
                        keywords[emotion].forEach(keyword => {
                            const count = (lowerText.match(new RegExp(keyword, 'g')) || []).length;
                            scores[emotion] += count;
                        });
                    }

                    // Detectar emociones complejas
                    const complexPatterns = {
                        'anxiety': /(?:muy|mucho|demasiado)\s+(?:ansioso|nervioso|preocupado)/,
                        'excitement': /(?:muy|mucho)\s+(?:emocionado|excitado)/,
                        'hopeful': /(?:tengo|siento)\s+(?:esperanza|fe)/
                    };

                    for (let emotion in complexPatterns) {
                        if (complexPatterns[emotion].test(lowerText)) {
                            scores[emotion] += 2;
                        }
                    }

                    // Analizar contexto emocional del historial
                    if (this.userHistory.length > 0) {
                        const recentEmotions = this.userHistory.slice(-3).map(entry => entry.emotion);
                        const emotionCounts = recentEmotions.reduce((acc, emotion) => {
                            acc[emotion] = (acc[emotion] || 0) + 1;
                            return acc;
                        }, {});

                        // Dar peso a emociones recientes
                        for (let emotion in emotionCounts) {
                            if (scores[emotion]) {
                                scores[emotion] += emotionCounts[emotion] * 0.5;
                            }
                        }
                    }

                    let maxScore = 0;
                    let detectedEmotion = 'neutral';
                    for (let emotion in scores) {
                        if (scores[emotion] > maxScore) {
                            maxScore = scores[emotion];
                            detectedEmotion = emotion;
                        }
                    }

                    return {
                        emotion: detectedEmotion,
                        score: maxScore > 0 ? Math.min(0.9, 0.3 + (maxScore * 0.1)) : 0.3,
                        confidence: maxScore > 0 ? Math.min(1, maxScore / 3) : 0.3
                    };
                },
                submitName() {
                    if (!this.name.trim()) { alert('Por favor ingresa tu nombre'); return; }
                    this.nameSubmitted = true;
                    this.$nextTick(() => { if (this.$refs.feelingInput) this.$refs.feelingInput.focus(); });
                },
                async analyzeEmotion() {
                    if (!this.feeling.trim()) { alert('Por favor comparte c√≥mo te sientes'); return; }
                    this.loading = true;
                    this.submitted = true;

                    // Activar contexto de audio en la primera interacci√≥n
                    this.activateAudioContext();

                    try {
                        const keywordResult = this.detectEmotionFromKeywords(this.feeling);
                        let finalResult = keywordResult;

                        // Usar an√°lisis local mejorado (sin dependencias externas)
                        // El an√°lisis local ya es muy preciso y no necesita API externa

                        this.result = finalResult;

                        // Guardar en historial
                        const historyEntry = {
                            timestamp: new Date().toISOString(),
                            emotion: finalResult.emotion,
                            score: finalResult.score,
                            text: this.feeling,
                            name: this.name
                        };

                        this.userHistory.push(historyEntry);
                        if (this.userHistory.length > 50) {
                            this.userHistory = this.userHistory.slice(-50); // Mantener solo los √∫ltimos 50
                        }

                        localStorage.setItem('emotionHistory', JSON.stringify(this.userHistory));
                        localStorage.setItem('currentMood', JSON.stringify(finalResult));

                        // Generar insights inteligentes
                        this.generateInsights();

                        // Cambiar m√∫sica seg√∫n la emoci√≥n
                        this.changeMusicByEmotion(finalResult.emotion);

                    } catch (e) {
                        console.error(e);
                        this.result = { emotion: 'neutral', score: 0.5, confidence: 0.3 };
                    }
                    finally { this.loading = false; }
                },
                generateInsights() {
                    if (this.userHistory.length < 3) return;

                    const recentEntries = this.userHistory.slice(-7); // √öltimos 7 d√≠as
                    const emotionCounts = {};
                    let totalScore = 0;

                    recentEntries.forEach(entry => {
                        emotionCounts[entry.emotion] = (emotionCounts[entry.emotion] || 0) + 1;
                        totalScore += entry.score;
                    });

                    const avgScore = totalScore / recentEntries.length;
                    const dominantEmotion = Object.keys(emotionCounts).reduce((a, b) =>
                        emotionCounts[a] > emotionCounts[b] ? a : b
                    );

                    const insights = {
                        trend: avgScore > 0.6 ? 'positivo' : avgScore < 0.4 ? 'negativo' : 'neutral',
                        dominantEmotion: dominantEmotion,
                        pattern: this.detectEmotionalPattern(),
                        recommendation: this.getPersonalizedRecommendation(dominantEmotion, avgScore)
                    };

                    this.aiInsights = insights;
                },

                detectEmotionalPattern() {
                    if (this.userHistory.length < 5) return null;

                    const recent = this.userHistory.slice(-5).map(e => e.emotion);
                    const positiveEmotions = ['joy', 'love', 'gratitude', 'excitement', 'hopeful'];
                    const negativeEmotions = ['sadness', 'anger', 'fear', 'anxiety'];

                    const positiveCount = recent.filter(e => positiveEmotions.includes(e)).length;
                    const negativeCount = recent.filter(e => negativeEmotions.includes(e)).length;

                    if (positiveCount > negativeCount + 1) return 'mejorando';
                    if (negativeCount > positiveCount + 1) return 'empeorando';
                    return 'estable';
                },

                getPersonalizedRecommendation(dominantEmotion, avgScore) {
                    const recommendations = {
                        'sadness': 'Considera hablar con un profesional de salud mental. La terapia puede ayudarte a procesar estos sentimientos.',
                        'anxiety': 'Prueba t√©cnicas de respiraci√≥n profunda o meditaci√≥n. El ejercicio regular tambi√©n puede reducir la ansiedad.',
                        'anger': 'Encuentra formas saludables de expresar tu frustraci√≥n, como ejercicio o arte.',
                        'fear': 'Recuerda que has superado desaf√≠os antes. Eres m√°s fuerte de lo que crees.',
                        'joy': '¬°Qu√© maravilloso! Sigue cultivando estas emociones positivas.',
                        'love': 'El amor es una fuerza poderosa. Comparte estos sentimientos con quienes amas.',
                        'gratitude': 'La gratitud es una pr√°ctica transformadora. Mant√©n este h√°bito positivo.',
                        'hopeful': 'La esperanza es tu superpoder. Conf√≠a en el proceso de la vida.'
                    };

                    return recommendations[dominantEmotion] || 'Contin√∫a siendo consciente de tus emociones y busca apoyo cuando lo necesites.';
                },

                generateEmpathyResponse(emotion, text) {
                    const name = this.name || "Amigo/a";
                    text = text.toLowerCase();

                    // DETECCI√ìN DE CRISIS - RESPUESTAS URGENTES Y HUMANAS
                    const crisisKeywords = {
                        suicide: ['suicidio', 'suicidar', 'matarme', 'acabar con todo', 'no quiero vivir', 'terminar con mi vida', 'quitarse la vida'],
                        selfHarm: ['cortarme', 'lastimarme', 'herirme', 'da√±arme', 'autolesi√≥n', 'da√±arme a m√≠ mismo'],
                        severeDepression: ['no puedo m√°s', 'no aguanto', 'estoy acabado', 'sin esperanza', 'no hay salida', 'todo est√° perdido'],
                        crisis: ['crisis', 'emergencia', 'ayuda urgente', 'no s√© qu√© hacer', 'desesperado', 'p√°nico total']
                    };

                    // Detectar crisis de suicidio
                    if (crisisKeywords.suicide.some(keyword => text.includes(keyword))) {
                        return `${name}, mi coraz√≥n se detiene al leer tus palabras. Lo que est√°s sintiendo es real y doloroso, pero tambi√©n temporal. Por favor, por favor, busca ayuda inmediatamente. Llama al 911 o a la L√≠nea de la Vida (800 911 2000) AHORA MISMO. No est√°s solo/a en esto. Tu vida tiene valor, aunque ahora no puedas verlo. Hay gente que te ama y profesionales que pueden ayudarte. Por favor, no hagas nada irreversible. Tu dolor es v√°lido, pero hay formas de sanarlo. Te abrazo con todo mi coraz√≥n. üíîü§ó`;
                    }

                    // Detectar autolesi√≥n
                    if (crisisKeywords.selfHarm.some(keyword => text.includes(keyword))) {
                        return `${name}, entiendo que el dolor que sientes es insoportable y que buscas formas de aliviarlo. Pero lastimarte no es la respuesta. Por favor, busca ayuda profesional inmediatamente. Puedes llamar al 911 o contactar a un terapeuta. Tu cuerpo y tu mente merecen cuidado y amor, no dolor. Hay formas m√°s seguras de procesar estos sentimientos. No est√°s solo/a en esto. üíôü§ó`;
                    }

                    // Detectar depresi√≥n severa
                    if (crisisKeywords.severeDepression.some(keyword => text.includes(keyword))) {
                        return `${name}, puedo sentir la profundidad de tu dolor en cada palabra. Cuando todo parece oscuro y sin esperanza, es dif√≠cil ver la luz, pero existe. Por favor, considera hablar con un profesional de salud mental. La depresi√≥n es una enfermedad real y tratable. No tienes que enfrentarla sola/o. Tu vida importa, tu dolor es v√°lido, y hay ayuda disponible. Por favor, busca apoyo profesional hoy mismo. üíú`;
                    }

                    // Detectar crisis general
                    if (crisisKeywords.crisis.some(keyword => text.includes(keyword))) {
                        return `${name}, reconozco que est√°s en una crisis y que te sientes abrumado/a. Es valiente de tu parte expresarlo. En momentos as√≠, es crucial buscar apoyo inmediato. Por favor, contacta a alguien de confianza, un profesional de salud mental, o llama a una l√≠nea de crisis. No tienes que enfrentar esto solo/a. Tu bienestar es prioritario. ü§óüíô`;
                    }

                    // Detectar enfermedades graves (c√°ncer, etc.)
                    const healthCrisis = ['c√°ncer', 'tumor', 'quimioterapia', 'enfermedad terminal', 'diagn√≥stico grave', 'operaci√≥n mayor'];
                    if (healthCrisis.some(keyword => text.includes(keyword))) {
                        return `${name}, mi coraz√≥n se llena de compasi√≥n al leer sobre la situaci√≥n de salud que est√°s enfrentando. Es normal sentir miedo, rabia, tristeza y una mezcla de emociones intensas. No tienes que ser fuerte todo el tiempo. Perm√≠tete sentir lo que sientes. Busca apoyo en grupos de apoyo, terapeutas especializados en oncolog√≠a, o consejeros espirituales. No est√°s solo/a en este camino. Cada d√≠a que luchas es un acto de valent√≠a. Te acompa√±o con todo mi amor. üíôüïäÔ∏è`;
                    }

                    // Detectar situaciones espec√≠ficas para respuestas m√°s personalizadas
                    const isLoss = text.includes("muri√≥") || text.includes("falleci√≥") || text.includes("muerte") || text.includes("perd√≠ a");
                    const isAnxiety = text.includes("ansiedad") || text.includes("preocupado") || text.includes("nervioso") || text.includes("estr√©s");
                    const isLonely = text.includes("solo") || text.includes("sola") || text.includes("soledad") || text.includes("aislado");
                    const isSelfDoubt = text.includes("in√∫til") || text.includes("no sirvo") || text.includes("no valgo") || text.includes("fracaso");
                    const isRelationship = text.includes("pareja") || text.includes("novio") || text.includes("novia") || text.includes("relaci√≥n");
                    const isWork = text.includes("trabajo") || text.includes("empleo") || text.includes("jefe") || text.includes("oficina");

                    // Respuestas contextuales m√°s inteligentes y humanas
                    if (isLoss) return `${name}, lamento profundamente tu p√©rdida. Perder a alguien que amamos es uno de los dolores m√°s profundos que podemos experimentar. Es completamente normal sentir que el mundo se ha detenido. No hay un tiempo "correcto" para sanar. Perm√≠tete llorar, recordar, y honrar a esa persona especial. El amor que sientes por ella/√©l nunca desaparecer√°, solo se transformar√°. No est√°s solo/a en este dolor. Te abrazo con todo mi coraz√≥n. üíúüïäÔ∏è`;

                    if (isAnxiety) return `${name}, puedo sentir c√≥mo la ansiedad te est√° consumiendo. Es como tener una tormenta constante en tu mente, ¬øverdad? Respira conmigo ahora: inhala lentamente por la nariz (1,2,3,4), mant√©n el aire (1,2,3,4), exhala suavemente por la boca (1,2,3,4,5,6). Repite esto tres veces. Recuerda: no tienes que controlar todo. Date permiso de vivir un d√≠a a la vez, un momento a la vez. Eres m√°s fuerte de lo que crees, aunque ahora no lo sientas as√≠. üåøüíô`;

                    if (isLonely) return `${name}, la soledad puede sentirse como un peso que te aplasta el pecho. Pero quiero que sepas algo importante: no est√°s realmente solo/a. Hay personas que te aman m√°s de lo que imaginas. Usa este momento para reconectarte contigo mismo/a, para recordar qui√©n eres realmente. Y cuando est√©s listo/a, extiende la mano hacia alguien. Pedir compa√±√≠a no te hace d√©bil, te hace humano. Eres valioso/a, importante, y mereces amor y conexi√≥n. üí´ü§ó`;

                    if (isSelfDoubt) return `${name}, escucha mi voz con atenci√≥n: tu valor no se mide por tus logros, tus errores, o lo que otros piensen de ti. Tu valor es intr√≠nseco, es parte de tu esencia. Eres √∫nico/a, irrepetible, y tienes algo especial que aportar al mundo que nadie m√°s puede dar. Cuando la voz cr√≠tica en tu cabeza te ataque, recuerda: eres suficiente, tal como eres, en este momento exacto. Te amo y creo en ti. ‚ù§Ô∏è‚ú®`;

                    if (isRelationship) return `${name}, las relaciones del coraz√≥n pueden ser nuestro mayor gozo y tambi√©n nuestra mayor fuente de dolor. Es completamente normal sentir emociones intensas cuando amamos a alguien. Date tiempo para procesar lo que sientes. La comunicaci√≥n honesta y compasiva es la base de cualquier relaci√≥n sana. Recuerda que amar no significa perderte a ti mismo/a. Eres digno/a de amor y respeto. üåπüíï`;

                    if (isWork) return `${name}, entiendo la presi√≥n que puede generar el trabajo. Es f√°cil que se convierta en nuestra identidad, pero recuerda: t√∫ no eres tu trabajo. Tu valor como persona trasciende cualquier logro profesional. Es importante encontrar equilibrio entre dedicaci√≥n y autocuidado. Si el trabajo te est√° consumiendo, tal vez es momento de reevaluar prioridades. Tu bienestar emocional es m√°s importante que cualquier trabajo. üè¢üíô`;

                    // Usar historial para personalizar respuesta
                    if (this.userHistory.length > 0) {
                        const lastEmotion = this.userHistory[this.userHistory.length - 1]?.emotion;
                        if (lastEmotion === emotion && this.userHistory.length > 1) {
                            return `${name}, veo que has estado luchando con ${this.emotionMap[emotion]?.label.toLowerCase()} recientemente. Es incre√≠blemente valiente de tu parte seguir compartiendo tus sentimientos, incluso cuando es dif√≠cil. Cada vez que expresas lo que sientes, das un paso m√°s hacia la sanaci√≥n. No te rindas. Estoy aqu√≠ contigo en este viaje. üí™ü§ó`;
                        }
                    }

                    // Respuesta est√°ndar personalizada
                    const phrases = this.empathyPhrases[emotion] || this.empathyPhrases['neutral'];
                    return phrases[Math.floor(Math.random() * phrases.length)].replace('{name}', name);
                },
                activateAudioContext() {
                    // Activar el contexto de audio para evitar restricciones de autoplay
                    if (!this.audioContextActivated) {
                        try {
                            if (!this.currentAudioContext || this.currentAudioContext.state === 'closed') {
                                this.currentAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                            }

                            if (this.currentAudioContext.state === 'suspended') {
                                this.currentAudioContext.resume();
                            }

                            this.audioContextActivated = true;
                            console.log('Audio context activado');
                        } catch (e) {
                            console.log('Audio context no disponible:', e);
                        }
                    }
                },

                toggleMusic() {
                    if (this.isPlaying) {
                        this.stopAllMusic();
                    } else {
                        this.activateAudioContext();
                        this.startMusicByEmotion(this.result?.emotion || 'neutral');
                    }
                    this.isPlaying = !this.isPlaying;
                },

                startMusicByEmotion(emotion) {
                    this.stopAllMusic();
                    const musicConfig = this.musicSequences[emotion] || this.musicSequences['neutral'];
                    this.generateMelody(musicConfig);
                },

                stopAllMusic() {
                    if (this.ambientMusicInterval) {
                        clearInterval(this.ambientMusicInterval);
                        this.ambientMusicInterval = null;
                    }
                    if (this.currentAudioContext) {
                        this.currentAudioContext.close();
                        this.currentAudioContext = null;
                    }
                },

                generateMelody(config) {
                    try {
                        // Crear nuevo contexto de audio si no existe o est√° cerrado
                        if (!this.currentAudioContext || this.currentAudioContext.state === 'closed') {
                            this.currentAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                        }

                        const audioContext = this.currentAudioContext;

                        // Resumir el contexto si est√° suspendido
                        if (audioContext.state === 'suspended') {
                            audioContext.resume();
                        }

                        const playNote = (frequency, duration, delay = 0) => {
                            setTimeout(() => {
                                if (!this.isPlaying || audioContext.state === 'closed') return;

                                try {
                                    const oscillator = audioContext.createOscillator();
                                    const gainNode = audioContext.createGain();

                                    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                                    oscillator.type = this.getWaveType(config.pattern);

                                    // Configurar envolvente de volumen m√°s suave
                                    const volume = this.musicVolume * 0.1; // Reducir volumen general
                                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                                    gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.05);
                                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);

                                    oscillator.connect(gainNode);
                                    gainNode.connect(audioContext.destination);

                                    oscillator.start(audioContext.currentTime);
                                    oscillator.stop(audioContext.currentTime + duration);
                                } catch (e) {
                                    console.log('Error reproduciendo nota:', e);
                                }
                            }, delay);
                        };

                        const playSequence = () => {
                            if (!this.isPlaying) return;

                            const beatDuration = 60000 / config.tempo; // duraci√≥n en ms por beat
                            const frequencies = config.frequencies;

                            // Crear melod√≠a basada en el patr√≥n
                            switch (config.pattern) {
                                case 'major':
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration * 0.8, i * beatDuration * 0.5);
                                        playNote(freq * 1.25, beatDuration * 0.4, i * beatDuration * 0.5 + beatDuration * 0.4);
                                    });
                                    break;
                                case 'minor':
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration * 1.2, i * beatDuration * 0.8);
                                        playNote(freq * 0.8, beatDuration * 0.6, i * beatDuration * 0.8 + beatDuration * 0.6);
                                    });
                                    break;
                                case 'romantic':
                                    playNote(frequencies[0], beatDuration * 1.5, 0);
                                    playNote(frequencies[1], beatDuration * 1.5, beatDuration * 0.5);
                                    playNote(frequencies[2], beatDuration * 1.5, beatDuration * 1.0);
                                    playNote(frequencies[3], beatDuration * 1.5, beatDuration * 1.5);
                                    break;
                                case 'calming':
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration * 2, i * beatDuration * 1.5);
                                    });
                                    break;
                                case 'uplifting':
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration * 0.6, i * beatDuration * 0.3);
                                        playNote(freq * 1.5, beatDuration * 0.6, i * beatDuration * 0.3 + beatDuration * 0.3);
                                    });
                                    break;
                                case 'soothing':
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration * 3, i * beatDuration * 2);
                                        playNote(freq * 0.8, beatDuration * 2, i * beatDuration * 2 + beatDuration * 1.5);
                                    });
                                    break;
                                case 'hopeful':
                                    playNote(frequencies[0], beatDuration * 2, 0);
                                    playNote(frequencies[1], beatDuration * 2, beatDuration * 1);
                                    playNote(frequencies[2], beatDuration * 2, beatDuration * 2);
                                    playNote(frequencies[1], beatDuration * 2, beatDuration * 3);
                                    break;
                                default:
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration, i * beatDuration * 0.6);
                                    });
                            }
                        };

                        // Reproducir secuencia inicial
                        playSequence();

                        // Repetir cada 8 segundos
                        this.ambientMusicInterval = setInterval(playSequence, 8000);

                    } catch (error) {
                        console.log('Error generando m√∫sica:', error);
                        this.isPlaying = false;
                    }
                },

                getWaveType(pattern) {
                    const waveTypes = {
                        'major': 'triangle',
                        'minor': 'sine',
                        'power': 'sawtooth',
                        'mysterious': 'triangle',
                        'romantic': 'sine',
                        'calming': 'sine',
                        'uplifting': 'triangle',
                        'optimistic': 'triangle',
                        'balanced': 'sine',
                        'soothing': 'sine',
                        'hopeful': 'triangle'
                    };
                    return waveTypes[pattern] || 'sine';
                },

                changeMusicByEmotion(emotion) {
                    if (this.isPlaying) {
                        this.startMusicByEmotion(emotion);
                    }
                },

                updateVolume() {
                    // El volumen se maneja directamente en generateMelody
                    // No necesitamos el audio tag externo
                },

                nextTrack() {
                    if (this.result && this.result.emotion) {
                        this.changeMusicByEmotion(this.result.emotion);
                    }
                },
                async saveAsImage() {
                    const element = document.getElementById('captureArea');
                    try {
                        const canvas = await html2canvas(element, { backgroundColor: null, scale: 2 });
                        const link = document.createElement('a');
                        link.download = `espacio-seguro-${this.name}.jpg`;
                        link.href = canvas.toDataURL('image/jpeg', 0.95);
                        link.click();
                    } catch (e) { console.error(e); alert('Hubo un error al guardar la imagen.'); }
                },
                reset() {
                    this.feeling = '';
                    this.submitted = false;
                    this.result = null;
                    this.$nextTick(() => { if (this.$refs.feelingInput) this.$refs.feelingInput.focus(); });
                },
                speakMessage(message) {
                    if (!('speechSynthesis' in window)) return;
                    const utterance = new SpeechSynthesisUtterance(message);
                    utterance.lang = 'es-ES';
                    window.speechSynthesis.cancel();
                    window.speechSynthesis.speak(utterance);
                },

                getSmartSuggestions() {
                    if (!this.result) return [];

                    const emotion = this.result.emotion;
                    const suggestions = {
                        'sadness': [
                            'üéµ Escucha m√∫sica que te haga sentir acompa√±ado/a',
                            'üìñ Lee algo inspirador o que te guste',
                            'üå± Sal a caminar al aire libre, aunque sea por 10 minutos',
                            'üìû Llama a alguien en quien conf√≠es para hablar',
                            'üíß Toma un ba√±o relajante o una ducha caliente'
                        ],
                        'anxiety': [
                            'ü´Å Practica la respiraci√≥n 4-7-8: inhala 4, mant√©n 7, exhala 8',
                            'üßò Prueba meditaci√≥n guiada de 5 minutos',
                            'üèÉ‚Äç‚ôÄÔ∏è Haz ejercicio ligero para liberar endorfinas',
                            'üìù Escribe tus preocupaciones para organizar tus pensamientos',
                            'üé® Colorea o dibuja para calmar tu mente'
                        ],
                        'anger': [
                            'üëä Golpea una almohada de forma segura',
                            'üèÉ‚Äç‚ôÇÔ∏è Sal a correr o haz ejercicio intenso',
                            'üéµ Escucha m√∫sica que te relaje',
                            'üåä Ve a un lugar con agua (playa, lago, r√≠o)',
                            'üí¨ Habla con alguien de confianza sobre lo que sientes'
                        ],
                        'fear': [
                            'üìù Escribe lo que te asusta y por qu√©',
                            'ü´Ç Abraza a alguien cercano o abraza una almohada',
                            'üé¨ Mira algo divertido que te distraiga',
                            'üè† Crea un espacio seguro y c√≥modo para ti',
                            'üí™ Recuerda momentos dif√≠ciles que ya superaste'
                        ],
                        'joy': [
                            'üéâ Comparte tu felicidad con alguien m√°s',
                            'üì∏ Toma una foto para recordar este momento',
                            'üéµ Baila con tu m√∫sica favorita',
                            'üåü Haz algo bueno por otra persona',
                            'üìù Escribe en un diario de gratitud'
                        ],
                        'love': [
                            'üíå Expresa tu amor a quien amas',
                            'üåπ Haz algo especial para tu ser querido',
                            'üì∏ Crea recuerdos juntos',
                            'üíù Escribe una carta de amor',
                            'üé® Crea algo hermoso que represente tu amor'
                        ],
                        'gratitude': [
                            'üìù Escribe 3 cosas por las que est√°s agradecido hoy',
                            'üìû Llama a alguien para agradecerle',
                            'üéÅ Haz algo bueno por otra persona',
                            'üå± Practica la gratitud hacia ti mismo/a',
                            'üåü Comparte tu gratitud en redes sociales'
                        ]
                    };

                    return suggestions[emotion] || [
                        'üå± Cuida de ti mismo/a hoy',
                        'üíß Mantente hidratado/a',
                        'üò¥ Aseg√∫rate de dormir bien',
                        'üçé Come algo nutritivo',
                        'üßò T√≥mate 5 minutos para respirar'
                    ];
                },

                viewHistory() {
                    this.showHistoryModal = true;
                },

                closeHistoryModal() {
                    this.showHistoryModal = false;
                },

                clearHistory() {
                    if (confirm('¬øEst√°s seguro/a de que quieres eliminar todo tu historial emocional? Esta acci√≥n no se puede deshacer.')) {
                        this.userHistory = [];
                        localStorage.removeItem('emotionHistory');
                        localStorage.removeItem('currentMood');
                        alert('Historial eliminado. Tus datos est√°n seguros y privados.');
                    }
                },

                exportData() {
                    const data = {
                        name: this.name,
                        history: this.userHistory,
                        exportDate: new Date().toISOString(),
                        version: '2.0'
                    };

                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `historial-emocional-${this.name}-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },

                formatDate(timestamp) {
                    const date = new Date(timestamp);
                    return date.toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },

                getUniqueEmotions() {
                    const emotions = [...new Set(this.userHistory.map(entry => entry.emotion))];
                    return emotions;
                },

                getDaysActive() {
                    const dates = [...new Set(this.userHistory.map(entry =>
                        new Date(entry.timestamp).toDateString()
                    ))];
                    return dates.length;
                },

                getMostFrequentEmotion() {
                    if (this.userHistory.length === 0) return 'No hay datos';

                    const emotionCounts = {};
                    this.userHistory.forEach(entry => {
                        emotionCounts[entry.emotion] = (emotionCounts[entry.emotion] || 0) + 1;
                    });

                    const mostFrequent = Object.keys(emotionCounts).reduce((a, b) =>
                        emotionCounts[a] > emotionCounts[b] ? a : b
                    );

                    return `${this.emotionMap[mostFrequent]?.emoji} ${this.emotionMap[mostFrequent]?.label}`;
                },

                getOverallTrend() {
                    if (this.userHistory.length < 3) return 'Necesitas m√°s datos';

                    const recent = this.userHistory.slice(-5);
                    const positiveCount = recent.filter(e =>
                        ['joy', 'love', 'gratitude', 'excitement', 'hopeful'].includes(e.emotion)
                    ).length;
                    const negativeCount = recent.filter(e =>
                        ['sadness', 'anger', 'fear', 'anxiety'].includes(e.emotion)
                    ).length;

                    if (positiveCount > negativeCount + 1) return 'üìà Mejorando';
                    if (negativeCount > positiveCount + 1) return 'üìâ Necesita atenci√≥n';
                    return 'üìä Estable';
                },

                getProgressMessage() {
                    if (this.userHistory.length < 2) return 'Comienza tu viaje';

                    const firstEntry = this.userHistory[0];
                    const lastEntry = this.userHistory[this.userHistory.length - 1];

                    const firstScore = firstEntry.score;
                    const lastScore = lastEntry.score;

                    if (lastScore > firstScore + 0.2) return 'üéâ ¬°Excelente progreso!';
                    if (lastScore < firstScore - 0.2) return 'üí™ Sigue trabajando en ti';
                    return 'üåü Mant√©n la constancia';
                }
            }
        }).mount('#app');

        // === ENHANCEMENT: Ampliaci√≥n emocional y emp√°tica ===

        if (typeof emotionMap !== "undefined") {
            Object.assign(emotionMap, {
                serenity: { label: "Serenidad", emoji: "üåø", color: "#76D7C4", type: "positive" },
                gratitude: { label: "Gratitud", emoji: "üôè", color: "#27AE60", type: "positive" },
                pride: { label: "Orgullo", emoji: "üí™", color: "#FFB86B", type: "positive" },
                compassion: { label: "Compasi√≥n", emoji: "ü§ù", color: "#F7DC6F", type: "positive" },
                tenderness: { label: "Ternura", emoji: "ü´∂", color: "#FAD7A0", type: "positive" },
                curiosity: { label: "Curiosidad", emoji: "üßê", color: "#7FB3D5", type: "neutral" },
                boredom: { label: "Aburrimiento", emoji: "üòê", color: "#BDC3C7", type: "neutral" },
                guilt: { label: "Culpa", emoji: "üòì", color: "#CD6155", type: "negative" },
                shame: { label: "Verg√ºenza", emoji: "üò≥", color: "#A569BD", type: "negative" },
                envy: { label: "Envidia", emoji: "üòí", color: "#82E0AA", type: "negative" },
                jealousy: { label: "Celos", emoji: "üßø", color: "#58D68D", type: "negative" },
                relief: { label: "Alivio", emoji: "üòå", color: "#7BD389", type: "positive" },
                nostalgia: { label: "Nostalgia", emoji: "üï∞Ô∏è", color: "#E7C9FF", type: "neutral" },
                fatigue: { label: "Cansancio", emoji: "üò¥", color: "#AAB7B8", type: "negative" },
                overwhelm: { label: "Abrumado/a", emoji: "üòµ", color: "#85C1E9", type: "negative" },
                loneliness: { label: "Soledad", emoji: "üòî", color: "#95A5A6", type: "negative" },
                hope: { label: "Esperanza", emoji: "üåü", color: "#3498DB", type: "positive" },
                vulnerability: { label: "Vulnerabilidad", emoji: "ü´Ç", color: "#BB8FCE", type: "neutral" },
                trust: { label: "Confianza", emoji: "ü§ù", color: "#5DADE2", type: "positive" }
            });
        }

        if (typeof empathyPhrases !== "undefined") {
            Object.assign(empathyPhrases, {
                serenity: [
                    "Qu√© bonito que sientas serenidad, {{name}}. Ese equilibrio interior es un tesoro.",
                    "Disfruta esta calma, {{name}}. Te mereces cada segundo de tranquilidad.",
                    "Sentir paz interior es una se√±al de que est√°s conectando contigo mismo."
                ],
                gratitude: [
                    "La gratitud abre puertas, {{name}}. Gracias por compartir ese sentir.",
                    "Agradecer lo que tenemos cambia la forma en que miramos el mundo.",
                    "Me alegra que reconozcas la belleza en las cosas simples, {{name}}."
                ],
                pride: [
                    "Puedes sentirte muy orgulloso/a, {{name}}. Has recorrido un camino importante.",
                    "Ese logro merece ser celebrado, {{name}}. Aplaude tu esfuerzo.",
                    "El orgullo propio es una semilla de autoestima. Cu√≠dala con amor."
                ],
                compassion: [
                    "Qu√© bonito verte conectar desde la compasi√≥n, {{name}}.",
                    "Tu capacidad de empat√≠a refleja una gran fortaleza emocional.",
                    "Ser compasivo no es debilidad, es valent√≠a del coraz√≥n."
                ],
                curiosity: [
                    "Tu curiosidad te lleva lejos, {{name}}. Nunca dejes de explorar.",
                    "Preguntarte cosas nuevas demuestra tu mente abierta.",
                    "Qu√© bonito tener hambre de aprender, {{name}}."
                ],
                nostalgia: [
                    "La nostalgia tiene algo dulce, {{name}}. Es se√±al de amor por lo vivido.",
                    "Recordar el pasado con ternura es una forma de agradecer lo que fue.",
                    "Tus recuerdos siguen siendo parte de ti, {{name}}."
                ],
                guilt: [
                    "La culpa puede ser dura, {{name}}, pero tambi√©n puede guiarte al perd√≥n.",
                    "Perd√≥nate como perdonar√≠as a alguien que amas.",
                    "Todos cometemos errores; lo importante es lo que aprendes de ellos."
                ],
                loneliness: [
                    "Gracias por compartir tu soledad, {{name}}. No est√°s solo/a en esto.",
                    "A veces, reconocer la soledad es el primer paso para volver a conectar.",
                    "Tu deseo de compa√±√≠a es una se√±al hermosa de humanidad."
                ],
                relief: [
                    "Qu√© alivio sentir eso, {{name}}. Deja que tu cuerpo descanse y agradezca.",
                    "Por fin un respiro, {{name}}. Te lo ganaste.",
                    "Disfruta esta ligereza, tu mente tambi√©n necesita espacios as√≠."
                ],
                fatigue: [
                    "Descansa, {{name}}. Estar cansado no te hace d√©bil, te hace humano.",
                    "Escucha a tu cuerpo, {{name}}. A veces solo necesita pausa.",
                    "No puedes con todo a la vez, y est√° bien. Mereces parar."
                ],
                hope: [
                    "La esperanza es una chispa, {{name}}. No dejes que se apague.",
                    "Tu mirada hacia adelante inspira. Sigue confiando.",
                    "Incluso en la noche m√°s oscura, hay una estrella esper√°ndote."
                ]
            });
        }

        if (typeof detectEmotionFromKeywords === "function") {
            const originalDetector = detectEmotionFromKeywords;
            detectEmotionFromKeywords = function (text) {
                text = text.toLowerCase();
                const extendedKeywords = {
                    gratitude: ["gracias", "agradecido", "bendecido", "valorar", "afortunado"],
                    serenity: ["calma", "serenidad", "paz", "tranquilidad"],
                    curiosity: ["curioso", "interesado", "descubrir", "explorar"],
                    nostalgia: ["recuerdo", "extra√±o", "a√±oro", "pasado", "melancol√≠a"],
                    pride: ["orgullo", "logro", "capaz", "satisfecho"],
                    guilt: ["culpa", "arrepentido", "me equivoqu√©", "fall√©"],
                    fatigue: ["cansado", "agotado", "sin fuerzas", "dormir"],
                    loneliness: ["solo", "sola", "aislado", "sin compa√±√≠a"],
                    compassion: ["compasi√≥n", "empat√≠a", "comprensi√≥n", "ayuda"],
                    relief: ["alivio", "descanso", "tranquilo", "por fin"],
                    hope: ["esperanza", "optimismo", "conf√≠o", "creer", "adelante"]
                };
                for (const [emotion, words] of Object.entries(extendedKeywords)) {
                    if (words.some(w => text.includes(w))) return emotion;
                }
                return originalDetector(text);
            };
        }

        console.log("‚ú® script.js enriquecido con m√°s emociones y frases humanas ‚ú®");
    </script>

</body>

</html>
