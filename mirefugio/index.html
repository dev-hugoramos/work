<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Espacio Seguro - Una aplicación inteligente de apoyo emocional que te ayuda a entender y procesar tus sentimientos con IA avanzada">
    <meta name="keywords"
        content="salud mental, emociones, bienestar, apoyo emocional, terapia, IA, inteligencia artificial">
    <meta name="author" content="Hugo Ramos Espino">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Espacio Seguro - Apoyo Emocional Inteligente">
    <meta property="og:description"
        content="Una aplicación inteligente que te ayuda a entender y procesar tus emociones con análisis de IA avanzado">
    <meta property="og:type" content="website">
    <title>Espacio Seguro - Apoyo Emocional Inteligente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        .app-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 30%, #f093fb 70%, #f5576c 100%);
            position: relative;
        }

        .floating-circle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 20s infinite ease-in-out;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(-100px)
            }
        }

        .content-wrapper {
            position: relative;
            z-index: 10;
            padding: 2rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header-section {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px 20px 0 0;
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
        }

        .result-card {
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 20px;
        }

        .emotion-badge {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            font-weight: 600;
            margin: 10px 0;
        }

        .empathy-message {
            font-size: 1.3rem;
            line-height: 1.8;
            margin: 1.5rem 0;
        }

        .alert-help {
            background: rgba(255, 59, 48, 0.9);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .music-control {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .music-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            visibility: hidden;
        }

        .fade {
            transition: opacity 0.6s ease;
            opacity: 1;
        }

        .fade-leave-active {
            opacity: 0;
        }

        .insights-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .insights-header h5 {
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .insights-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
        }

        .insight-item {
            margin-bottom: 0.8rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .insight-item:last-child {
            margin-bottom: 0;
        }

        .emotion-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
        }

        .history-preview {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .emotion-timeline {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .emotion-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .emotion-dot:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        .smart-suggestions {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .suggestion-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            transition: transform 0.2s ease;
        }

        .suggestion-item:hover {
            transform: translateX(5px);
        }

        .suggestion-item:last-child {
            margin-bottom: 0;
        }

        .volume-control {
            margin-top: 10px;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* Mejoras para móviles */
        @media (max-width: 768px) {
            .app-container {
                padding: 0;
            }

            .content-wrapper {
                padding: 1rem;
            }

            .header-section h1 {
                font-size: 2rem;
            }

            .card {
                margin: 0;
                border-radius: 15px;
            }

            .card-body {
                padding: 1.5rem !important;
            }

            .btn-lg {
                font-size: 1rem;
                padding: 0.75rem 1rem;
            }

            .music-control {
                bottom: 20px;
                right: 20px;
            }

            .music-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .empathy-message {
                font-size: 1.1rem;
                line-height: 1.6;
            }

            .insights-card {
                padding: 1rem;
            }

            .smart-suggestions {
                padding: 1rem;
            }

            .result-card {
                padding: 1.5rem;
            }

            .floating-circle {
                display: none;
            }

            .btn {
                margin-bottom: 0.5rem;
                width: 100%;
            }

            .btn+.btn {
                margin-left: 0;
            }
        }

        @media (max-width: 480px) {
            .header-section h1 {
                font-size: 1.8rem;
            }

            .empathy-message {
                font-size: 1rem;
            }

            .insights-card,
            .smart-suggestions {
                padding: 0.8rem;
            }

            .music-control {
                bottom: 15px;
                right: 15px;
            }

            .music-btn {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
        }

        /* Animaciones suaves */
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        }

        .btn {
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .suggestion-item {
            transition: all 0.3s ease;
        }

        .suggestion-item:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.3);
        }

        /* Mejoras de accesibilidad */
        .btn:focus,
        input:focus,
        textarea:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        /* Efectos de carga mejorados */
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3rem;
        }

        /* Mejoras visuales adicionales */
        .emotion-badge {
            font-size: 1.1rem;
            padding: 12px 24px;
        }

        .confidence-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
        }

        .confidence-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A, #FFD700);
        }

        .music-info {
            position: absolute;
            top: -30px;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            animation: fadeInOut 3s ease-in-out;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
            }

            20% {
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        /* Estilos del Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2rem 2rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-header h3 {
            color: white;
            margin: 0;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 2rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 2rem;
            color: white;
        }

        .empty-history {
            text-align: center;
            padding: 3rem;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-history h4 {
            margin-bottom: 1rem;
            color: white;
        }

        .empty-history p {
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
        }

        .history-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .summary-card h5 {
            margin-bottom: 1rem;
            color: white;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }

        .stat {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: bold;
            color: #FFD93D;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .history-timeline h5,
        .history-insights h5 {
            margin-bottom: 1rem;
            color: white;
        }

        .timeline-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .timeline-container::-webkit-scrollbar {
            width: 6px;
        }

        .timeline-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .timeline-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .timeline-item {
            display: flex;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .timeline-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 15px;
            top: 40px;
            bottom: -20px;
            width: 2px;
            background: rgba(255, 255, 255, 0.2);
        }

        .timeline-marker {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .timeline-content {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            backdrop-filter: blur(10px);
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .emotion-name {
            font-weight: 600;
            color: white;
        }

        .timeline-date {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .timeline-text {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .timeline-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .insight-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            backdrop-filter: blur(10px);
        }

        .insight-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .insight-content h6 {
            margin: 0 0 0.25rem 0;
            color: white;
            font-size: 0.9rem;
        }

        .insight-content p {
            margin: 0;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
        }

        .modal-footer {
            padding: 1rem 2rem 2rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .modal-footer .btn {
            min-width: 140px;
        }

        /* Responsive para móviles */
        @media (max-width: 768px) {
            .modal-overlay {
                padding: 10px;
            }

            .modal-content {
                max-height: 95vh;
                border-radius: 15px;
            }

            .modal-header {
                padding: 1.5rem 1.5rem 1rem;
            }

            .modal-header h3 {
                font-size: 1.5rem;
            }

            .modal-body {
                padding: 1.5rem;
            }

            .summary-stats {
                grid-template-columns: repeat(3, 1fr);
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .timeline-container {
                max-height: 300px;
            }

            .timeline-content {
                padding: 0.8rem;
            }

            .timeline-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }

            .insights-grid {
                grid-template-columns: 1fr;
            }

            .modal-footer {
                padding: 1rem 1.5rem 1.5rem;
                flex-direction: column;
            }

            .modal-footer .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .modal-header h3 {
                font-size: 1.3rem;
            }

            .summary-stats {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .stat {
                padding: 0.8rem;
            }

            .timeline-item {
                margin-bottom: 1rem;
            }

            .timeline-content {
                padding: 0.7rem;
            }
        }

        /* Footer Mejorado */
        .app-footer {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #2c3e50 100%);
            color: white;
            padding: 3rem 2rem 1rem;
            margin-top: 4rem;
            position: relative;
            overflow: hidden;
        }

        .app-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-main {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 3rem;
            margin-bottom: 2rem;
        }

        .footer-info h4 {
            color: #3498db;
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .developer-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ecf0f1;
            margin-bottom: 0.25rem;
        }

        .developer-title {
            color: #bdc3c7;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .footer-description {
            color: #ecf0f1;
            line-height: 1.6;
            max-width: 500px;
        }

        .footer-links {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .support-section h5,
        .contact-section h5 {
            color: #3498db;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .support-section p,
        .contact-section p {
            color: #bdc3c7;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .kofi-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #FF5E5B 0%, #FF8A80 100%);
            color: white;
            text-decoration: none;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 94, 91, 0.3);
            position: relative;
            overflow: hidden;
        }

        .kofi-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .kofi-btn:hover::before {
            left: 100%;
        }

        .kofi-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 94, 91, 0.4);
        }

        .kofi-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .kofi-text {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .kofi-subtext {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .social-links {
            display: flex;
            gap: 1rem;
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .social-link:hover {
            background: rgba(52, 152, 219, 0.3);
            transform: translateY(-2px);
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .footer-stats {
            display: flex;
            gap: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #bdc3c7;
        }

        .footer-copyright {
            color: #95a5a6;
            font-size: 0.9rem;
        }

        /* Responsive Footer */
        @media (max-width: 768px) {
            .app-footer {
                padding: 2rem 1rem 1rem;
            }

            .footer-main {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .footer-bottom {
                flex-direction: column;
                text-align: center;
                gap: 1.5rem;
            }

            .footer-stats {
                justify-content: center;
                gap: 1.5rem;
            }

            .social-links {
                justify-content: center;
            }

            .kofi-btn {
                padding: 1.25rem 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .footer-stats {
                flex-direction: column;
                gap: 1rem;
            }

            .stat-item {
                padding: 0.5rem;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
            }
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="app-container">
            <div class="floating-circle" :style="{width:'200px',height:'200px',top:'10%',left:'5%'}"></div>
            <div class="floating-circle" :style="{width:'150px',height:'150px',top:'60%',right:'10%'}"></div>

            <div class="content-wrapper">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="header-section">
                                    <h1>🌟 Mi Refugio 🌟</h1>
                                    <p class="mb-0">Un lugar donde tus emociones importan</p>
                                </div>
                                <div class="card-body p-4">
                                    <!-- Nombre -->
                                    <div v-if="!nameSubmitted">
                                        <label class="form-label fw-bold" for="nameInput">¿Cuál es tu nombre?</label>
                                        <input v-model="name" type="text" class="form-control" id="nameInput"
                                            placeholder="Escribe tu nombre..." @keyup.enter="submitName"
                                            aria-describedby="nameHelp" autocomplete="name">
                                        <div id="nameHelp" class="form-text">Tu nombre nos ayuda a personalizar tu
                                            experiencia</div>
                                        <button @click="submitName" class="btn btn-primary w-100 mt-3"
                                            :disabled="!name.trim()" aria-label="Continuar con el nombre ingresado">✨
                                            Continuar</button>
                                    </div>

                                    <!-- Sentimientos -->
                                    <div v-if="nameSubmitted && !submitted">
                                        <p class="text-muted">👋 Hola, <strong>{{ name }}</strong></p>
                                        <label class="form-label fw-bold" for="feelingInput">¿Cómo te sientes
                                            hoy?</label>
                                        <textarea v-model="feeling" class="form-control" rows="4" id="feelingInput"
                                            placeholder="Comparte lo que sientes..." ref="feelingInput"
                                            aria-describedby="feelingHelp" autocomplete="off"></textarea>
                                        <div id="feelingHelp" class="form-text">Describe libremente tus emociones,
                                            pensamientos o experiencias</div>
                                        <button @click="analyzeEmotion" class="btn btn-primary w-100 mt-3"
                                            :disabled="!feeling || loading" aria-label="Analizar mis sentimientos">
                                            <span v-if="!loading">💬 Compartir mis sentimientos</span>
                                            <span v-else>Analizando...</span>
                                        </button>
                                    </div>

                                    <div v-if="loading" class="text-center py-4">
                                        <div class="spinner-border text-primary"></div>
                                        <p class="mt-2">Comprendiendo tus emociones...</p>
                                    </div>

                                    <!-- Resultado -->
                                    <div v-if="result && !loading">
                                        <div id="captureArea" class="result-card">
                                            <div class="text-center mb-3">
                                                <div class="emotion-badge">
                                                    <span class="emotion-indicator"
                                                        :style="{backgroundColor: emotionMap[result.emotion]?.color}"></span>
                                                    {{ emotionEmoji }} {{ emotionLabel }}
                                                    <span v-if="result.confidence" class="ms-2">
                                                        ({{ Math.round(result.confidence * 100) }}% confianza)
                                                    </span>
                                                </div>
                                                <div v-if="result.confidence" class="confidence-bar mt-2">
                                                    <div class="confidence-fill"
                                                        :style="{width: (result.confidence * 100) + '%'}"></div>
                                                </div>
                                            </div>
                                            <div class="empathy-message" v-if="result && !loading"
                                                v-bind:class="{ fade: fadeEffect }">
                                                {{ empathyMessage }}
                                            </div>
                                            <div class="text-center mt-4">
                                                <small>💝 Para: {{ name }}</small>
                                                <div v-if="quote" class="mt-2"><em>"{{ quote }}"</em></div>

                                                <!-- Vista previa del historial emocional -->
                                                <div v-if="userHistory.length > 1" class="history-preview">
                                                    <small><strong>📊 Tu viaje emocional reciente:</strong></small>
                                                    <div class="emotion-timeline">
                                                        <div v-for="(entry, index) in userHistory.slice(-7)"
                                                            :key="index" class="emotion-dot"
                                                            :style="{backgroundColor: emotionMap[entry.emotion]?.color}"
                                                            :title="`${emotionMap[entry.emotion]?.label} - ${new Date(entry.timestamp).toLocaleDateString()}`">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Insights Inteligentes -->
                                        <div v-if="aiInsights" class="insights-card mt-3">
                                            <div class="insights-header">
                                                <h5>🧠 Insights sobre tu bienestar emocional</h5>
                                            </div>
                                            <div class="insights-content">
                                                <div class="insight-item">
                                                    <strong>Tendencia:</strong>
                                                    <span :class="{
                                                        'text-success': aiInsights.trend === 'positivo',
                                                        'text-warning': aiInsights.trend === 'neutral',
                                                        'text-danger': aiInsights.trend === 'negativo'
                                                    }">
                                                        {{ aiInsights.trend === 'positivo' ? '📈 Mejorando' :
                                                        aiInsights.trend === 'negativo' ? '📉 Necesita atención' : '📊
                                                        Estable' }}
                                                    </span>
                                                </div>
                                                <div v-if="aiInsights.pattern" class="insight-item">
                                                    <strong>Patrón emocional:</strong>
                                                    <span :class="{
                                                        'text-success': aiInsights.pattern === 'mejorando',
                                                        'text-warning': aiInsights.pattern === 'estable',
                                                        'text-danger': aiInsights.pattern === 'empeorando'
                                                    }">
                                                        {{ aiInsights.pattern === 'mejorando' ? '✨ Progreso positivo' :
                                                        aiInsights.pattern === 'empeorando' ? '⚠️ Considera apoyo' : '🔄
                                                        Estable' }}
                                                    </span>
                                                </div>
                                                <div class="insight-item">
                                                    <strong>Recomendación personalizada:</strong>
                                                    <p class="mb-0">{{ aiInsights.recommendation }}</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div v-if="needsHelp" class="alert alert-help">
                                            <h5>🤗 Hay gente aquí para ayudarte:</h5>
                                            <p>Si estás pasando por un momento difícil, no estás solo/a:</p>
                                            <ul>
                                                <li><strong>🚨 Emergencias:</strong> 911</li>
                                                <li><strong>Línea de la Vida (México):</strong> 800 911 2000</li>
                                                <li><strong>SAPTEL (Suicidio):</strong> 55 5259 8121</li>
                                                <li><strong>Crisis Text Line:</strong> Envía HOME al 741741</li>
                                                <li><strong>Línea de Ayuda Psicológica:</strong> 800 911 2000</li>
                                            </ul>
                                            <p class="mb-0"><strong>Recuerda:</strong> Tu vida tiene valor. Busca ayuda
                                                profesional. No tienes que enfrentar esto solo/a. 💙</p>
                                        </div>

                                        <!-- Sugerencias Inteligentes -->
                                        <div v-if="result" class="smart-suggestions">
                                            <h6>💡 Sugerencias personalizadas para ti</h6>
                                            <div class="suggestion-item" v-for="suggestion in getSmartSuggestions()"
                                                :key="suggestion">
                                                {{ suggestion }}
                                            </div>
                                        </div>

                                        <div class="text-center mt-4">
                                            <button @click="saveAsImage" class="btn btn-success btn-lg me-2">📸 Guardar
                                                frase</button>
                                            <button @click="reset" class="btn btn-outline-secondary btn-lg">🔄 Nuevo
                                                sentimiento</button>
                                            <button v-if="userHistory.length > 0" @click="viewHistory"
                                                class="btn btn-info btn-lg ms-2">📈 Ver historial</button>
                                        </div>

                                        <!-- Opciones adicionales -->
                                        <div v-if="userHistory.length > 0" class="text-center mt-3">
                                            <small class="text-muted">Opciones de privacidad:</small><br>
                                            <button @click="exportData" class="btn btn-sm btn-outline-primary me-2">📁
                                                Exportar datos</button>
                                            <button @click="clearHistory" class="btn btn-sm btn-outline-danger">🗑️
                                                Limpiar historial</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Footer movido al final de la página -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Música -->
            <div class="music-control">
                <button @click="toggleMusic" class="music-btn"
                    :title="isPlaying ? 'Pausar música' : 'Reproducir música'">
                    {{ isPlaying ? '🔊' : '🔇' }}
                </button>
                <div class="volume-control" v-if="isPlaying">
                    <input type="range" min="0" max="1" step="0.1" v-model="musicVolume" @input="updateVolume"
                        class="volume-slider" title="Control de volumen">
                </div>
                <div class="music-info" v-if="result">
                    <small>🎵 Música adaptada a tu emoción</small>
                </div>
            </div>
        </div>

        <!-- Sistema de música generada programáticamente (sin archivos externos) -->

        <!-- Modal del Historial -->
        <div v-if="showHistoryModal" class="modal-overlay" @click="closeHistoryModal">
            <div class="modal-content" @click.stop>
                <div class="modal-header">
                    <h3>📊 Tu Historial Emocional</h3>
                    <button @click="closeHistoryModal" class="close-btn" aria-label="Cerrar historial">×</button>
                </div>
                <div class="modal-body">
                    <div v-if="userHistory.length === 0" class="empty-history">
                        <div class="empty-icon">📝</div>
                        <h4>Tu historial está vacío</h4>
                        <p>Comienza a compartir tus emociones para ver tu progreso aquí</p>
                    </div>
                    <div v-else class="history-content">
                        <div class="history-summary">
                            <div class="summary-card">
                                <h5>📈 Resumen General</h5>
                                <div class="summary-stats">
                                    <div class="stat">
                                        <span class="stat-number">{{ userHistory.length }}</span>
                                        <span class="stat-label">Registros</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-number">{{ getUniqueEmotions().length }}</span>
                                        <span class="stat-label">Emociones</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-number">{{ getDaysActive() }}</span>
                                        <span class="stat-label">Días activos</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="history-timeline">
                            <h5>📅 Timeline de Emociones</h5>
                            <div class="timeline-container">
                                <div v-for="(entry, index) in userHistory" :key="index" class="timeline-item">
                                    <div class="timeline-marker"
                                        :style="{backgroundColor: emotionMap[entry.emotion]?.color}">
                                        {{ emotionMap[entry.emotion]?.emoji }}
                                    </div>
                                    <div class="timeline-content">
                                        <div class="timeline-header">
                                            <span class="emotion-name">{{ emotionMap[entry.emotion]?.label }}</span>
                                            <span class="timeline-date">{{ formatDate(entry.timestamp) }}</span>
                                        </div>
                                        <div class="timeline-text">{{ entry.text.substring(0, 100) }}{{
                                            entry.text.length > 100 ? '...' : '' }}</div>
                                        <div class="timeline-meta">
                                            <span class="intensity">Intensidad: {{ Math.round(entry.score * 100)
                                                }}%</span>
                                            <span class="confidence" v-if="entry.confidence">Confianza: {{
                                                Math.round(entry.confidence * 100) }}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="history-insights">
                            <h5>🧠 Insights de tu Bienestar</h5>
                            <div class="insights-grid">
                                <div class="insight-card">
                                    <div class="insight-icon">🎯</div>
                                    <div class="insight-content">
                                        <h6>Emoción más frecuente</h6>
                                        <p>{{ getMostFrequentEmotion() }}</p>
                                    </div>
                                </div>
                                <div class="insight-card">
                                    <div class="insight-icon">📊</div>
                                    <div class="insight-content">
                                        <h6>Tendencia general</h6>
                                        <p>{{ getOverallTrend() }}</p>
                                    </div>
                                </div>
                                <div class="insight-card">
                                    <div class="insight-icon">💪</div>
                                    <div class="insight-content">
                                        <h6>Progreso</h6>
                                        <p>{{ getProgressMessage() }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button @click="exportData" class="btn btn-outline-primary">📁 Exportar datos</button>
                    <button @click="clearHistory" class="btn btn-outline-danger">🗑️ Limpiar historial</button>
                    <button @click="closeHistoryModal" class="btn btn-primary">✅ Cerrar</button>
                </div>
            </div>
        </div>

        <!-- Footer Mejorado -->
        <footer class="app-footer">
            <div class="footer-content">
                <div class="footer-main">
                    <div class="footer-info">
                        <div class="developer-info">
                            <h4>💻 Desarrollado con ❤️</h4>
                            <p class="developer-name">Hugo Ramos Espino</p>
                            <p class="developer-title">Desarrollador Full Stack & Android Developer</p>
                        </div>
                        <div class="footer-description">
                            <p>Mi Refugio es una aplicación creada con amor y dedicación para brindar apoyo emocional
                                inteligente. Cada línea de código está pensada para ayudarte en tu bienestar mental.</p>
                        </div>
                    </div>

                    <div class="footer-links">
                        <div class="support-section">
                            <h5>🤝 Apoya este proyecto</h5>
                            <p>Tu apoyo me ayuda a seguir mejorando la aplicación y crear más herramientas para el
                                bienestar mental.</p>
                            <a href="https://ko-fi.com/hugoramos" target="_blank" class="kofi-btn">
                                <span class="kofi-icon">☕</span>
                                <span class="kofi-text">Apóyame en Ko-fi</span>
                                <span class="kofi-subtext">Café para el desarrollador</span>
                            </a>
                        </div>

                        <div class="contact-section">
                            <h5>📧 Conecta conmigo</h5>
                            <div class="social-links">
                                <a href="mailto:hugoramos.developer2024@gmail.com" class="social-link email">
                                    📧 Email
                                </a>
                                <a href="https://github.com/dev-hugoramos" target="_blank" class="social-link github">
                                    🐙 GitHub
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="footer-bottom">
                    <div class="footer-stats">
                        <div class="stat-item">
                            <span class="stat-number">12</span>
                            <span class="stat-label">Emociones detectadas</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">100%</span>
                            <span class="stat-label">Privacidad garantizada</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">24/7</span>
                            <span class="stat-label">Disponible siempre</span>
                        </div>
                    </div>
                    <div class="footer-copyright">
                        <p>© 2025 Hugo Ramos Espino. Hecho con ❤️ para tu bienestar emocional.</p>
                    </div>
                </div>
            </div>
        </footer>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    name: '',
                    feeling: '',
                    submitted: false,
                    loading: false,
                    result: null,
                    isPlaying: false,
                    nameSubmitted: false,
                    userHistory: JSON.parse(localStorage.getItem('emotionHistory') || '[]'),
                    currentMood: JSON.parse(localStorage.getItem('currentMood') || 'null'),
                    aiInsights: null,
                    currentMusic: null,
                    musicVolume: 0.3,
                    fadeEffect: false,
                    quote: null,
                    showHistoryModal: false,
                    emotionMap: {
                        'joy': { label: 'Alegría', emoji: '😊', type: 'positive', color: '#FFD93D' },
                        'sadness': { label: 'Tristeza', emoji: '😢', type: 'negative', color: '#6C7CE7' },
                        'anger': { label: 'Enojo', emoji: '😠', type: 'negative', color: '#FF6B6B' },
                        'fear': { label: 'Miedo', emoji: '😨', type: 'negative', color: '#8E44AD' },
                        'love': { label: 'Amor', emoji: '❤️', type: 'positive', color: '#FF69B4' },
                        'surprise': { label: 'Sorpresa', emoji: '😮', type: 'neutral', color: '#FFA726' },
                        'neutral': { label: 'Neutral', emoji: '😐', type: 'neutral', color: '#95A5A6' },
                        'anxiety': { label: 'Ansiedad', emoji: '😰', type: 'negative', color: '#9B59B6' },
                        'excitement': { label: 'Emoción', emoji: '🤩', type: 'positive', color: '#F39C12' },
                        'gratitude': { label: 'Gratitud', emoji: '🙏', type: 'positive', color: '#27AE60' },
                        'confusion': { label: 'Confusión', emoji: '😕', type: 'neutral', color: '#95A5A6' },
                        'hopeful': { label: 'Esperanza', emoji: '🌟', type: 'positive', color: '#3498DB' },
                        'suicide_crisis': { label: 'Crisis de Suicidio', emoji: '🚨', type: 'critical', color: '#E74C3C' },
                        'self_harm': { label: 'Autolesión', emoji: '⚠️', type: 'critical', color: '#E67E22' },
                        'health_crisis': { label: 'Crisis de Salud', emoji: '🏥', type: 'critical', color: '#9B59B6' }
                    },
                    empathyPhrases: {
                        'joy': [
                            '¡{name}, qué alegría tan inmensa saber que estás radiante! Tu energía positiva es contagiosa y el mundo necesita más personas como tú. Estos momentos de felicidad son tesoros que debes guardar en tu corazón. Recuerda siempre que mereces cada instante de esta dicha, y que tu sonrisa tiene el poder de iluminar incluso los días más oscuros de quienes te rodean. ¡Sigue brillando con esa luz única que llevas dentro! 🌟✨',
                            '{name}, es maravilloso ver cómo la alegría fluye a través de ti. Este sentimiento tan hermoso que experimentas es una muestra de tu capacidad para apreciar las cosas buenas de la vida. No permitas que nada ni nadie apague esa chispa especial que te caracteriza. Comparte esta felicidad con el mundo, porque tu energía positiva puede transformar vidas. Eres una bendición y mereces celebrar cada victoria, por pequeña que parezca. ¡Que esta alegría se multiplique en tu vida! 💫🌈',
                            '¡Qué hermoso es verte así de feliz, {name}! La vida te está sonriendo y tú le estás devolviendo la sonrisa. Este momento de plenitud que estás viviendo es el resultado de tu valentía, tu perseverancia y tu capacidad de ver el lado bueno de las cosas. Guarda este sentimiento en tu memoria para esos días en que las cosas se pongan difíciles. Eres luz pura, y el universo conspira a tu favor. ¡Sigue adelante con esa actitud tan inspiradora! 🎉💖'
                        ],
                        'sadness': [
                            '{name}, mi corazón está contigo en este momento tan difícil. La tristeza que sientes es profunda y completamente válida. No hay prisa por "estar bien", date el tiempo que necesites para procesar lo que estás viviendo. Llorar no es señal de debilidad, sino de valentía al permitirte sentir. Aunque ahora parezca imposible, te prometo que este dolor no será eterno. Poco a poco, encontrarás luz en medio de la oscuridad. Eres increíblemente fuerte, incluso en tu vulnerabilidad. No estás solo/a en esto, hay personas que se preocupan por ti profundamente. Permítete recibir apoyo y amor. Los días mejores llegarán, paso a paso. 💙🤗',
                            'Querido/a {name}, puedo sentir el peso de la tristeza que cargas en este momento, y quiero que sepas que está bien sentirse así. No tienes que fingir estar bien para nadie. La vida nos presenta momentos oscuros, pero justamente esos momentos nos enseñan sobre nuestra propia fortaleza. Sé gentil contigo mismo/a, date permiso para sanar a tu propio ritmo. Recuerda que esta tormenta pasará, y cuando lo haga, saldrás de ella siendo una versión más sabia y resiliente de ti. Aunque no lo veas ahora, hay esperanza esperándote. Mereces amor, comprensión y días llenos de paz. Te abrazo desde la distancia. 🌙💜',
                            '{name}, siento mucho que estés atravesando este momento de dolor. La tristeza puede sentirse como un océano interminable, pero quiero recordarte algo importante: has sobrevivido al 100% de tus días más difíciles hasta ahora, y también superarás este. No estás roto/a, estás sanando. Cada lágrima que derramas es parte de tu proceso de liberación. Date tiempo, date espacio, date amor. Busca apoyo en quienes te quieren y, si lo necesitas, no dudes en pedir ayuda profesional. Tu valor no disminuye por estar pasando un mal momento. Eres valioso/a, importante y profundamente amado/a. La luz volverá a tu vida. 🌅💕'
                        ],
                        'anger': [
                            '{name}, veo que estás sintiendo mucha frustración y enojo, y quiero que sepas que tu emoción es completamente válida. Tienes derecho a sentirte así. Sin embargo, no permitas que este sentimiento te consuma por dentro. El enojo puede ser una fuerza destructiva o transformadora, y tú tienes el poder de elegir. Te invito a respirar profundamente, a alejarte de la situación si es posible, y a buscar formas saludables de canalizar esta energía. Quizás escribir, hacer ejercicio, o hablar con alguien de confianza. Recuerda que responder con calma no significa que no estés molesto/a, significa que tienes el control. Eres más grande que este momento de ira. 🌬️💪',
                            'Querido/a {name}, entiendo perfectamente tu frustración y enojo. A veces la vida nos pone en situaciones que nos hacen hervir la sangre, y está bien reconocer esos sentimientos. Pero quiero recordarte algo: tú no eres tu enojo, eres mucho más que esta emoción temporal. Este sentimiento pasará, pero las decisiones que tomes mientras estés enojado/a podrían tener consecuencias duraderas. Tómate un momento, respira, cuenta hasta diez si es necesario. Canaliza esa energía poderosa hacia algo constructivo. Tu paz mental es más valiosa que tener la razón o vengarte. Eres capaz de transformar esta tormenta en crecimiento personal. 🧘✨',
                            '{name}, puedo percibir la intensidad de lo que estás sintiendo ahora mismo. El enojo es una emoción humana natural, pero no dejes que te controle. Tienes todo el derecho de estar molesto/a, pero también tienes el poder de elegir cómo responder. Pregúntate: ¿esta situación seguirá siendo importante en 5 años? A veces, dar un paso atrás nos ayuda a ver las cosas con perspectiva. Busca formas saludables de liberar esa energía: camina, corre, grita en un lugar seguro si lo necesitas. Tu bienestar emocional es prioritario. Eres fuerte, sabio/a y capaz de navegar esta tormenta con gracia. 🔥🕊️'
                        ],
                        'fear': [
                            '{name}, reconocer tu miedo ya es un acto de valentía increíble. El miedo es una emoción natural que nos protege, pero no debemos dejar que nos paralice. Lo que estás sintiendo es real y válido, pero quiero que recuerdes algo fundamental: has enfrentado miedos antes y has salido victorioso/a. Eres más fuerte de lo que crees. El miedo solo tiene el poder que tú le das. Respira profundo, da un paso a la vez, y verás cómo ese monstruo que parece gigante se hace más pequeño con cada avance. No estás solo en esto. Confía en ti, confía en el proceso, y recuerda que al otro lado del miedo está tu crecimiento. 🦋💫',
                            'Querido/a {name}, puedo sentir la ansiedad y el miedo que estás experimentando en este momento. Es una sensación abrumadora, lo sé, pero quiero que sepas algo: el miedo no define tu futuro, solo muestra que te importa. Ese temor que sientes es evidencia de que estás a punto de crecer, de expandirte más allá de tu zona de confort. Los guerreros más valientes no son aquellos que no sienten miedo, sino aquellos que avanzan a pesar de él. Tú eres ese guerrero/a. Cada paso que das, por pequeño que sea, es una victoria. Respira, centra tu mente, y recuerda que tienes todo lo necesario dentro de ti para superar esto. 🌟💪',
                            '{name}, el miedo que sientes ahora mismo es intenso, pero temporal. Quiero recordarte que algunos de tus mayores logros en la vida han venido después de momentos de gran temor. El miedo es solo una emoción, no es una profecía. No te dice lo que va a pasar, solo te muestra lo mucho que te importa el resultado. Permítete sentir ese miedo, acéptalo, pero no dejes que tome las decisiones por ti. Eres infinitamente más poderoso/a que cualquier miedo. Busca apoyo si lo necesitas, habla sobre lo que sientes, y da un paso a la vez. La valentía no es la ausencia de miedo, es actuar a pesar de él. Y tú eres valiente. 🌈✨'
                        ],
                        'love': [
                            '¡{name}, qué hermoso es el amor que estás sintiendo! Este sentimiento tan puro y poderoso que habita en tu corazón es uno de los regalos más preciosos de la vida. El amor, en cualquiera de sus formas, tiene el poder de transformar, sanar y dar sentido a nuestra existencia. Cultiva ese amor con cuidado, protégelo, pero también compártelo sin miedo. Eres un ser lleno de luz y capacidad de amar profundamente, y eso es algo extraordinario. Permítete vivir este sentimiento plenamente, sin reservas, porque el amor verdadero siempre merece ser celebrado. Que este amor te llene de alegría y te inspire a ser la mejor versión de ti mismo/a. ❤️💕',
                            '{name}, el amor que sientes en este momento es mágico y transformador. Ya sea amor romántico, familiar, de amistad o amor propio, este sentimiento es la fuerza más poderosa del universo. Alimenta ese amor con acciones conscientes, palabras amables y presencia genuina. Recuerda que amar también es un acto de valentía, porque nos hace vulnerables, pero también nos hace humanos. Disfruta cada momento, cada conversación, cada gesto de afecto. Eres digno/a de dar y recibir amor abundante. Que este sentimiento siga creciendo en tu vida. 🌹✨',
                            '¡Qué maravilloso, {name}! El amor que estás experimentando es la evidencia de que tu corazón está abierto y dispuesto a conectar profundamente. Este sentimiento tan especial merece ser honrado y cuidado. No tengas miedo de expresar lo que sientes, de mostrar tu vulnerabilidad, porque ahí es donde reside la verdadera fuerza del amor. Ya sea amor hacia otra persona, hacia tu familia, tus amigos, o hacia ti mismo/a, este sentimiento es el que da color y significado a nuestra existencia. Permítete vivirlo plenamente, sin miedo al futuro. El presente es tuyo, y está lleno de amor. 💖🌟'
                        ],
                        'surprise': [
                            '¡{name}, qué emocionante es vivir momentos inesperados! La vida tiene una forma mágica de sorprendernos justo cuando menos lo esperamos. Esta sensación de asombro que estás sintiendo es un recordatorio hermoso de que la vida está llena de posibilidades infinitas. Mantén tu mente abierta y tu corazón receptivo a todo lo que el universo tiene preparado para ti. Las mejores historias que contaremos en el futuro son aquellas que nunca vimos venir. Disfruta de esta sorpresa, aprende de ella, y permítele que agregue un nuevo matiz a tu historia personal. Eres parte de algo más grande y maravilloso. ✨🎉',
                            'Querido/a {name}, las sorpresas son los condimentos que hacen que la vida sea verdaderamente interesante. Este momento inesperado que estás viviendo tiene algo que enseñarte, algo que mostrarte sobre ti mismo/a o sobre el mundo. Abraza lo desconocido con curiosidad y entusiasmo. La vida es impredecible, y esa es precisamente su belleza. Cada sorpresa es una oportunidad para crecer, para ver las cosas desde una nueva perspectiva, para expandir tu comprensión del mundo. Disfruta este momento, documéntalo en tu memoria, y permite que enriquezca tu experiencia de vida. ¡El universo siempre tiene algo extraordinario preparado para ti! 🌈💫',
                            '{name}, ¡qué hermoso es dejarse sorprender por la vida! Este momento inesperado que estás experimentando es una prueba de que la vida siempre encuentra formas de maravillarnos. Mantén esa capacidad de asombro, esa chispa de curiosidad que te caracteriza. Las personas que pueden sorprenderse son aquellas que permanecen jóvenes de espíritu sin importar su edad. Aprovecha esta energía renovada para hacer algo diferente, para atreverte a explorar nuevos caminos. La sorpresa es el recordatorio del universo de que siempre hay más por descubrir, más por vivir, más por amar. ¡Disfruta el viaje! 🎊✨'
                        ],
                        'neutral': [
                            '{name}, los días tranquilos también tienen su propia belleza y propósito. No todos los días tienen que ser una montaña rusa de emociones, y está perfectamente bien sentirse en equilibrio. Este momento de calma que estás experimentando te permite reflexionar, recargar energías y prepararte para lo que venga. Aprovecha esta serenidad para agradecer lo que tienes, organizar tus pensamientos y conectar contigo mismo/a. La vida no siempre necesita grandes emociones para ser significativa; a veces, la quietud es suficiente para nutrir el alma. 🌿🕊️',
                            'Querido/a {name}, el sentirse neutral o tranquilo es un regalo que muchas veces pasa desapercibido. Estos momentos de equilibrio nos permiten respirar, reorganizar nuestras ideas y disfrutar de la vida sin presión. Aprovecha esta oportunidad para conectar contigo mismo, para hacer algo que te guste y que te nutra internamente. La neutralidad no es ausencia de emoción, es un espacio para la claridad y la introspección. Date permiso de disfrutarlo sin culpa ni expectativas. 💛✨',
                            '{name}, estar en un estado neutral es una forma de equilibrio que la vida nos ofrece. No todos los momentos necesitan ser intensos para ser valiosos. Esta calma te permite observar tu entorno, cuidar de ti mismo/a y planificar tus próximos pasos con claridad. La neutralidad es un momento de pausa, de preparación, de reflexión. Disfruta de este estado, aprecia la tranquilidad y usa este tiempo para fortalecerte y conectar contigo y con los que te rodean. 🌸🕊️'
                        ],
                        'anxiety': [
                            '{name}, puedo sentir la ansiedad que te está acompañando en este momento. Es una sensación intensa y real, y quiero que sepas que no estás solo en esto. La ansiedad es como una tormenta en tu mente, pero como todas las tormentas, pasará. Respira profundamente conmigo: inhala lentamente por la nariz, siente cómo se llena tu pecho, y exhala suavemente por la boca. Repite esto contigo mismo. Eres más fuerte que esta ansiedad, aunque ahora no lo sientas así. Date permiso de ir paso a paso, sin presionarte. 🌊💙',
                            'Querido/a {name}, la ansiedad puede sentirse como un laberinto sin salida, pero quiero recordarte algo importante: has enfrentado momentos difíciles antes y has salido adelante. Esta ansiedad que sientes ahora es temporal, aunque parezca eterna. Intenta la técnica 5-4-3-2-1: nombra 5 cosas que puedes ver, 4 que puedes tocar, 3 que puedes oír, 2 que puedes oler, 1 que puedes saborear. Esto te ayudará a anclarte en el presente. Eres valiente por reconocer lo que sientes. 🌸💪',
                            '{name}, siento mucho que estés experimentando ansiedad en este momento. Es una emoción muy intensa y puede sentirse abrumadora. Quiero que sepas que es completamente normal sentirse así, y que no hay nada malo en ti por experimentar ansiedad. Prueba hacer ejercicios de respiración, caminar un poco, o hacer algo que te guste. Si la ansiedad persiste, no dudes en buscar ayuda profesional. Tu bienestar mental es tan importante como tu salud física. Mereces paz y tranquilidad. 🕊️💜'
                        ],
                        'excitement': [
                            '¡{name}, qué maravilloso es sentir esta emoción tan intensa! La emoción es como un fuego que ilumina tu alma y te llena de energía positiva. Aprovecha esta sensación para hacer algo que realmente te apasione. Cuando estamos emocionados, somos capaces de lograr cosas increíbles. Canaliza esta energía hacia tus objetivos, tus sueños, hacia lo que realmente te importa. La vida te está regalando este momento de entusiasmo, ¡disfrútalo al máximo! 🚀✨',
                            '{name}, la emoción que sientes ahora mismo es pura magia. Es esa sensación que nos recuerda que estamos vivos y que la vida está llena de posibilidades infinitas. No dejes que esta energía se desperdicie. Úsala para crear, para explorar, para atreverte a hacer algo nuevo. La emoción es combustible para el alma, y tú tienes un tanque lleno. ¡Qué hermoso es verte así de radiante! 🌟💫',
                            '¡Qué hermoso verte tan emocionado/a, {name}! Esta energía positiva que irradias es contagiosa y transformadora. La emoción es uno de los regalos más preciosos de la vida, y cuando la sentimos, todo parece posible. Aprovecha este momento para hacer algo que te haga feliz, para compartir tu alegría con otros, o para dar el siguiente paso hacia algo que realmente deseas. Tu entusiasmo es tu superpoder. ¡Úsalo sabiamente! 🎉💖'
                        ],
                        'gratitude': [
                            '{name}, qué hermoso es sentir gratitud en tu corazón. Esta emoción tan pura y transformadora tiene el poder de cambiar completamente tu perspectiva de la vida. La gratitud no solo es un sentimiento, es una práctica que puede transformar tu mundo. Cada vez que sientes gratitud, estás reconociendo la abundancia que ya existe en tu vida. Sigue cultivando este sentimiento, compártelo con otros, y verás cómo se multiplica la belleza a tu alrededor. Eres un ser lleno de luz y apreciación. 🙏✨',
                            'Querido/a {name}, la gratitud que sientes ahora mismo es como una semilla que has plantado en tu corazón y que está floreciendo. Es hermoso ver cómo reconoces las bendiciones en tu vida, por pequeñas que parezcan. La gratitud nos conecta con lo esencial, con lo que realmente importa. Escribe sobre lo que agradeces, comparte tu gratitud con quienes amas, y observa cómo esta práctica transforma tu día a día. Eres un ejemplo de cómo vivir con el corazón abierto. 🌸💝',
                            '{name}, sentir gratitud es uno de los regalos más hermosos que puedes darte a ti mismo/a. Esta emoción te conecta con la abundancia de la vida y te recuerda todo lo bueno que ya tienes. La gratitud es como un imán que atrae más cosas buenas hacia ti. No solo estás agradecido/a, estás practicando una forma de vida que te llena de paz y satisfacción. Sigue reconociendo las pequeñas y grandes bendiciones que te rodean. Eres un ser lleno de sabiduría y amor. 🌺💕'
                        ],
                        'confusion': [
                            '{name}, es completamente normal sentirse confundido/a a veces. La confusión no es un signo de debilidad, sino una señal de que estás procesando información nueva o navegando por una situación compleja. Date permiso de no tener todas las respuestas inmediatamente. A veces, la claridad llega cuando menos la esperamos. Tómate el tiempo que necesites para reflexionar, haz preguntas si puedes, y recuerda que no tienes que resolver todo de una vez. La confusión es solo una parada temporal en tu camino hacia la comprensión. 🌫️💙',
                            'Querido/a {name}, la confusión puede sentirse como estar perdido en una niebla, pero quiero recordarte que las mejores respuestas a menudo vienen después de momentos de incertidumbre. No te presiones por entender todo de inmediato. A veces, la vida nos presenta situaciones que requieren tiempo para procesar. Habla con alguien de confianza, escribe tus pensamientos, o simplemente date espacio para sentir sin necesidad de entender. La claridad llegará cuando estés listo/a para recibirla. 🌅🤔',
                            '{name}, sentir confusión es parte natural del proceso de aprendizaje y crecimiento. No significa que hayas hecho algo mal o que no seas lo suficientemente inteligente. De hecho, reconocer que estás confundido/a muestra que eres consciente y que te importa encontrar la respuesta correcta. Date tiempo, sé paciente contigo mismo/a, y no tengas miedo de pedir ayuda si la necesitas. Cada momento de confusión es una oportunidad para aprender algo nuevo sobre ti y el mundo que te rodea. 🧭💫'
                        ],
                        'hopeful': [
                            '¡{name}, qué hermoso es sentir esperanza en tu corazón! La esperanza es como una estrella que brilla incluso en la noche más oscura. Es esa chispa de luz que nos recuerda que siempre hay posibilidades, que siempre hay algo por lo que luchar. Tu esperanza no es ingenua, es valiente. Es la decisión consciente de creer en un futuro mejor, incluso cuando el presente es difícil. Mantén esa esperanza viva, aliméntala con acciones pequeñas cada día, y verás cómo se convierte en realidad. 🌟💫',
                            'Querido/a {name}, la esperanza que sientes es uno de los regalos más preciosos que puedes tener. No es solo un sentimiento, es una fuerza que puede mover montañas. Cuando tienes esperanza, tienes poder para crear el cambio que deseas ver en tu vida. La esperanza te da la fuerza para seguir adelante cuando las cosas se ponen difíciles. Comparte tu esperanza con otros, porque es contagiosa y puede iluminar el camino de quienes te rodean. Eres un faro de luz en este mundo. 🕯️✨',
                            '{name}, sentir esperanza es como tener un jardín secreto en tu corazón donde las flores más hermosas pueden florecer. Es esa certeza interna de que las cosas pueden mejorar, de que hay un mañana lleno de posibilidades. Tu esperanza no es fantasía, es fe en tu propia capacidad de crear y atraer cosas buenas a tu vida. Cada día que eliges la esperanza sobre el miedo, estás eligiendo la vida. Sigue creyendo, sigue esperando, porque tu esperanza es el primer paso hacia la realización de tus sueños. 🌈💖'
                        ],
                        'suicide_crisis': [
                            '🚨 {name}, por favor escucha con atención: Lo que estás sintiendo en este momento es temporal, aunque parezca que no hay salida. Tu vida tiene un valor incalculable y este dolor que sientes ahora no será para siempre. Por favor, no tomes ninguna decisión permanente basada en sentimientos temporales. Hay personas que te aman y se preocupan por ti, aunque en este momento no puedas verlo. Tu existencia importa, tu historia no ha terminado. Por favor, busca ayuda inmediatamente. Puedes llamar al 911, a la línea de crisis 988, o hablar con alguien de confianza AHORA MISMO. No estás solo/a. 🌟💙',
                            'Querido/a {name}, siento profundamente el dolor que estás experimentando. Es comprensible que te sientas abrumado/a y que veas la muerte como la única salida, pero te prometo que hay otras opciones. Este momento de desesperación es pasajero, aunque ahora no lo parezca. Tu cerebro está en modo de supervivencia y puede estar distorsionando la realidad. Por favor, dale tiempo a tu mente para calmarse. Hay profesionales capacitados que pueden ayudarte a superar esta crisis. Tu vida vale la pena ser vivida. Por favor, busca ayuda profesional INMEDIATAMENTE. No estás solo/a en esto. 💙🤝',
                            '{name}, entiendo que estás pasando por uno de los momentos más difíciles de tu vida. El dolor que sientes es real y válido, pero también es temporal. La depresión y los pensamientos suicidas son condiciones médicas tratables, no defectos de carácter. Hay esperanza y hay ayuda disponible. Por favor, no tomes decisiones permanentes en un estado temporal. Tu familia, amigos, o incluso extraños como yo, nos preocupamos por ti. Tu vida tiene propósito y significado, aunque en este momento no puedas verlo. Por favor, busca ayuda profesional AHORA. La línea de crisis está disponible 24/7. No estás solo/a. 🌈💙'
                        ],
                        'self_harm': [
                            '⚠️ {name}, entiendo que el dolor emocional puede ser tan intenso que buscas formas de aliviarlo, pero lastimarte físicamente no es la solución. El dolor que sientes es real y válido, pero hay formas más saludables de manejarlo. Por favor, considera hablar con un profesional de la salud mental que puede ayudarte a desarrollar estrategias de afrontamiento más seguras. Tu cuerpo merece ser tratado con amor y respeto. Si ya te has lastimado, por favor busca atención médica si es necesario. No estás solo/a en esto y hay ayuda disponible. 💙🤝',
                            'Querido/a {name}, siento mucho que estés pasando por tanto dolor que sientes la necesidad de lastimarte. Este comportamiento es una señal de que estás sufriendo profundamente y necesitas apoyo profesional. La autolesión puede proporcionar alivio temporal, pero no resuelve el problema subyacente. Hay alternativas más saludables para manejar el dolor emocional. Por favor, considera buscar ayuda de un terapeuta o consejero que pueda ayudarte a desarrollar herramientas de afrontamiento más efectivas. Tu bienestar es importante. 🌟💙',
                            '{name}, entiendo que estás experimentando un dolor emocional tan intenso que parece insoportable. La autolesión puede sentirse como la única forma de alivio, pero hay otras opciones. Por favor, recuerda que mereces cuidado y compasión, especialmente hacia ti mismo/a. Si estás teniendo pensamientos de autolesión, por favor habla con alguien de confianza o busca ayuda profesional. Hay líneas de crisis disponibles las 24 horas que pueden ayudarte a superar este momento difícil. No tienes que enfrentar esto solo/a. 💙🌈'
                        ],
                        'health_crisis': [
                            '🏥 {name}, siento profundamente que estés enfrentando una crisis de salud tan difícil. Es completamente normal sentir miedo, ansiedad y tristeza ante diagnósticos médicos serios. Tu valentía al enfrentar esta situación es admirable. Por favor, recuerda que no estás solo/a en esto - hay equipos médicos especializados, grupos de apoyo, y personas que te aman y están aquí para ayudarte. Es importante que expreses tus emociones y no las guardes dentro. Considera hablar con un consejero especializado en pacientes con enfermedades graves. Tu fuerza interior es más grande de lo que crees. 💙🌟',
                            'Querido/a {name}, enfrentar una crisis de salud es una de las experiencias más desafiantes que una persona puede vivir. Es natural sentir una mezcla de emociones: miedo, tristeza, ira, negación. Todas estas emociones son válidas y parte del proceso. Por favor, no dudes en buscar apoyo emocional además del tratamiento médico. Los grupos de apoyo, terapeutas especializados, y seres queridos pueden ser una red de apoyo invaluable. Tu actitud y determinación pueden marcar una gran diferencia en tu proceso de curación. Eres más fuerte de lo que sabes. 🌈💪',
                            '{name}, mi corazón está contigo mientras enfrentas esta crisis de salud. Es comprensible que te sientas abrumado/a y que las emociones sean intensas. La incertidumbre sobre el futuro puede ser aterradora, pero por favor recuerda que la medicina moderna avanza constantemente y hay muchas historias de esperanza y recuperación. Mantén la comunicación abierta con tu equipo médico y no tengas miedo de hacer preguntas. También es crucial cuidar tu salud mental durante este proceso. Busca apoyo profesional si lo necesitas. No estás solo/a en esta lucha. 💙🤝'
                        ]
                    },
                    // Sistema de música generada programáticamente
                    ambientMusicInterval: null,
                    currentAudioContext: null,
                    audioContextActivated: false,
                    musicSequences: {
                        'joy': {
                            frequencies: [523, 659, 784, 1047], // Do, Mi, Sol, Do
                            tempo: 120,
                            pattern: 'major'
                        },
                        'sadness': {
                            frequencies: [220, 277, 330, 392], // La, Do, Mi, Sol (menor)
                            tempo: 80,
                            pattern: 'minor'
                        },
                        'anger': {
                            frequencies: [330, 440, 523], // Mi, La, Do
                            tempo: 100,
                            pattern: 'power'
                        },
                        'fear': {
                            frequencies: [220, 330, 415], // La, Mi, La sostenido
                            tempo: 90,
                            pattern: 'mysterious'
                        },
                        'love': {
                            frequencies: [392, 523, 659, 784], // Sol, Do, Mi, Sol
                            tempo: 110,
                            pattern: 'romantic'
                        },
                        'anxiety': {
                            frequencies: [220, 277, 330], // La, Do, Mi
                            tempo: 85,
                            pattern: 'calming'
                        },
                        'gratitude': {
                            frequencies: [523, 659, 784, 1047], // Do, Mi, Sol, Do
                            tempo: 115,
                            pattern: 'uplifting'
                        },
                        'hopeful': {
                            frequencies: [440, 523, 659], // La, Do, Mi
                            tempo: 125,
                            pattern: 'optimistic'
                        },
                        'neutral': {
                            frequencies: [330, 440, 523], // Mi, La, Do
                            tempo: 100,
                            pattern: 'balanced'
                        },
                        'suicide_crisis': {
                            frequencies: [220, 277, 330], // La, Do, Mi (calmante)
                            tempo: 60,
                            pattern: 'calming'
                        },
                        'self_harm': {
                            frequencies: [220, 330, 415], // La, Mi, La sostenido (tranquilizador)
                            tempo: 70,
                            pattern: 'soothing'
                        },
                        'health_crisis': {
                            frequencies: [392, 523, 659], // Sol, Do, Mi (esperanzador)
                            tempo: 85,
                            pattern: 'hopeful'
                        }
                    }
                }
            },
            computed: {
                emotionLabel() {
                    if (!this.result) return '';
                    return this.emotionMap[this.result.emotion]?.label || 'Emoción';
                },
                emotionEmoji() {
                    if (!this.result) return '';
                    return this.emotionMap[this.result.emotion]?.emoji || '😊';
                },
                empathyMessage() {
                    if (!this.result) return '';
                    const message = this.generateEmpathyResponse(this.result.emotion, this.feeling);
                    //this.speakMessage(message);
                    return message;
                },
                needsHelp() {
                    if (!this.result) return false;
                    const negativeEmotions = ['sadness', 'anger', 'fear', 'anxiety'];
                    const crisisKeywords = ['suicidio', 'suicidar', 'matarme', 'no quiero vivir', 'cáncer', 'enfermo', 'tumor'];
                    const hasCrisisKeywords = crisisKeywords.some(keyword =>
                        this.feeling.toLowerCase().includes(keyword)
                    );
                    return (negativeEmotions.includes(this.result.emotion) && this.result.score > 0.7) || hasCrisisKeywords;
                },
                emotionalTrend() {
                    if (this.userHistory.length < 3) return 'insuficiente';
                    const recent = this.userHistory.slice(-5);
                    const positiveCount = recent.filter(e => ['joy', 'love', 'gratitude', 'excitement', 'hopeful'].includes(e.emotion)).length;
                    const negativeCount = recent.filter(e => ['sadness', 'anger', 'fear', 'anxiety'].includes(e.emotion)).length;

                    if (positiveCount > negativeCount + 1) return 'mejorando';
                    if (negativeCount > positiveCount + 1) return 'empeorando';
                    return 'estable';
                }
            },
            methods: {
                detectEmotionFromKeywords(text) {
                    const lowerText = text.toLowerCase();

                    // PRIORIDAD 1: Detectar situaciones críticas PRIMERO
                    const criticalKeywords = {
                        'suicide_crisis': ['me quiero morir', 'quiero morir', 'me quiero suicidar', 'suicidar', 'suicidio', 'matarme', 'acabar con todo', 'no quiero vivir', 'mejor muerto', 'no vale la pena vivir', 'todo está perdido', 'no hay salida', 'quiero desaparecer', 'acabar con mi vida', 'terminar con esto', 'ya no puedo más', 'no aguanto más', 'mejor me mato', 'quiero matarme', 'no quiero existir'],
                        'self_harm': ['cortarme', 'cortar', 'herirme', 'lastimarme', 'autolesión', 'dañarme', 'hacerme daño', 'golpearme', 'quemarme'],
                        'health_crisis': ['cáncer', 'tumor', 'enfermedad terminal', 'me voy a morir', 'estoy enfermo', 'muy enfermo', 'hospital', 'quimioterapia', 'operación', 'cirugía urgente', 'diagnóstico terrible', 'médico dice', 'no hay cura']
                    };

                    // Verificar situaciones críticas primero
                    for (let crisis in criticalKeywords) {
                        for (let keyword of criticalKeywords[crisis]) {
                            if (lowerText.includes(keyword)) {
                                return {
                                    emotion: crisis,
                                    score: 0.95,
                                    confidence: 0.98,
                                    isCritical: true
                                };
                            }
                        }
                    }

                    const keywords = {
                        'sadness': ['triste', 'tristeza', 'deprimido', 'depresión', 'lloro', 'llorar', 'llorando', 'dolor', 'pérdida', 'muerte', 'murió', 'falleció', 'duelo', 'solo', 'sola', 'soledad', 'vacío', 'desesperado', 'desesperanza', 'melancolía', 'nostalgia', 'perdí', 'extraño', 'falta', 'abandonado', 'desanimado', 'sufro', 'sufrimiento', 'llanto', 'llanto', 'desconsolado', 'afligido', 'apenado', 'apenado', 'dolorido', 'sintiendo dolor', 'me duele', 'me duele el corazón', 'roto', 'roto por dentro'],
                        'anger': ['enojado', 'enojo', 'rabia', 'furioso', 'furia', 'molesto', 'irritado', 'frustrado', 'frustración', 'odio', 'coraje', 'enfadado', 'ira', 'injusto', 'injusticia', 'harto', 'cansado de', 'indignado', 'maldito', 'cabrón', 'no puedo más', 'me da rabia', 'estúpido', 'idiota', 'asco', 'repugnante', 'odioso', 'odio a', 'me cago en', 'me choca', 'me molesta', 'me irrita', 'me enfurece'],
                        'fear': ['miedo', 'temor', 'asustado', 'aterrado', 'pánico', 'terror', 'angustia', 'angustiado', 'inseguro', 'inseguridad', 'amenaza', 'peligro', 'tengo miedo', 'me asusta', 'vulnerable', 'aterrador', 'horror', 'horroroso', 'espantoso', 'me espanta', 'me da miedo', 'terrorífico', 'susto', 'sustos', 'sobresaltado'],
                        'anxiety': ['ansiedad', 'ansioso', 'nervioso', 'preocupado', 'preocupación', 'estrés', 'estresado', 'agobiado', 'agobio', 'presión', 'presionado', 'tensión', 'tenso', 'inquieto', 'inquietud', 'intranquilo', 'agitado', 'agitación', 'nervios', 'me pongo nervioso', 'me da ansiedad', 'me agobia', 'me estresa', 'me preocupa'],
                        'joy': ['feliz', 'felicidad', 'alegre', 'alegría', 'contento', 'emocionado', 'emoción', 'dichoso', 'eufórico', 'radiante', 'maravilloso', 'genial', 'increíble', 'fantástico', 'excelente', 'bendecido', 'afortunado', 'celebrar', 'logré', 'conseguí', 'éxito', 'victoria', 'triunfo', 'gozo', 'gozoso', 'júbilo', 'jubiloso', 'alborozo', 'regocijo', 'placer', 'satisfecho', 'orgulloso'],
                        'love': ['amor', 'amo', 'quiero', 'cariño', 'te amo', 'enamorado', 'enamorada', 'adorar', 'adoro', 'pasión', 'afecto', 'romántico', 'corazón', 'beso', 'abrazo', 'pareja', 'novio', 'novia', 'esposo', 'esposa', 'familia', 'querido', 'querida', 'amado', 'amada', 'cariñoso', 'ternura', 'ternura', 'mimo', 'mimos', 'consentir'],
                        'gratitude': ['agradecido', 'agradecida', 'gracias', 'bendecido', 'bendecida', 'afortunado', 'afortunada', 'suerte', 'fortuna', 'agradezco', 'reconocimiento', 'reconocido', 'reconocida', 'agradecimiento', 'bendición', 'privilegiado', 'privilegiada'],
                        'excitement': ['emocionado', 'emocionada', 'excitado', 'excitada', 'expectativa', 'anticipación', 'esperando', 'anhelando', 'deseando', 'ilusión', 'ilusionado', 'ansioso por', 'impaciente', 'expectante', 'emocionante'],
                        'confusion': ['confundido', 'confundida', 'confusión', 'perdido', 'perdida', 'no entiendo', 'no sé', 'duda', 'dudoso', 'incierto', 'desorientado', 'desorientada', 'desconcertado', 'desconcertada', 'perplejo', 'perpleja', 'despistado', 'despistada', 'no tengo idea', 'no entiendo nada'],
                        'hopeful': ['esperanza', 'esperanzado', 'esperanzada', 'optimista', 'positivo', 'positiva', 'fe', 'creer', 'confío', 'esperanzador', 'alentador', 'prometedor', 'prometedora', 'ilusión', 'ilusionado', 'ilusionada', 'motivado', 'motivada', 'animado', 'animada']
                    };

                    let scores = {};
                    for (let emotion in keywords) {
                        scores[emotion] = 0;
                    }

                    // Análisis más inteligente con pesos
                    for (let emotion in keywords) {
                        keywords[emotion].forEach(keyword => {
                            const count = (lowerText.match(new RegExp(keyword, 'g')) || []).length;
                            scores[emotion] += count;
                        });
                    }

                    // Detectar emociones complejas
                    const complexPatterns = {
                        'anxiety': /(?:muy|mucho|demasiado)\s+(?:ansioso|nervioso|preocupado)/,
                        'excitement': /(?:muy|mucho)\s+(?:emocionado|excitado)/,
                        'hopeful': /(?:tengo|siento)\s+(?:esperanza|fe)/
                    };

                    for (let emotion in complexPatterns) {
                        if (complexPatterns[emotion].test(lowerText)) {
                            scores[emotion] += 2;
                        }
                    }

                    // Analizar contexto emocional del historial
                    if (this.userHistory.length > 0) {
                        const recentEmotions = this.userHistory.slice(-3).map(entry => entry.emotion);
                        const emotionCounts = recentEmotions.reduce((acc, emotion) => {
                            acc[emotion] = (acc[emotion] || 0) + 1;
                            return acc;
                        }, {});

                        // Dar peso a emociones recientes
                        for (let emotion in emotionCounts) {
                            if (scores[emotion]) {
                                scores[emotion] += emotionCounts[emotion] * 0.5;
                            }
                        }
                    }

                    let maxScore = 0;
                    let detectedEmotion = 'neutral';
                    for (let emotion in scores) {
                        if (scores[emotion] > maxScore) {
                            maxScore = scores[emotion];
                            detectedEmotion = emotion;
                        }
                    }

                    return {
                        emotion: detectedEmotion,
                        score: maxScore > 0 ? Math.min(0.9, 0.3 + (maxScore * 0.1)) : 0.3,
                        confidence: maxScore > 0 ? Math.min(1, maxScore / 3) : 0.3
                    };
                },
                submitName() {
                    if (!this.name.trim()) { alert('Por favor ingresa tu nombre'); return; }
                    this.nameSubmitted = true;
                    this.$nextTick(() => { if (this.$refs.feelingInput) this.$refs.feelingInput.focus(); });
                },
                async analyzeEmotion() {
                    if (!this.feeling.trim()) { alert('Por favor comparte cómo te sientes'); return; }
                    this.loading = true;
                    this.submitted = true;

                    // Activar contexto de audio en la primera interacción
                    this.activateAudioContext();

                    try {
                        const keywordResult = this.detectEmotionFromKeywords(this.feeling);
                        let finalResult = keywordResult;

                        // Usar análisis local mejorado (sin dependencias externas)
                        // El análisis local ya es muy preciso y no necesita API externa

                        this.result = finalResult;

                        // Guardar en historial
                        const historyEntry = {
                            timestamp: new Date().toISOString(),
                            emotion: finalResult.emotion,
                            score: finalResult.score,
                            text: this.feeling,
                            name: this.name
                        };

                        this.userHistory.push(historyEntry);
                        if (this.userHistory.length > 50) {
                            this.userHistory = this.userHistory.slice(-50); // Mantener solo los últimos 50
                        }

                        localStorage.setItem('emotionHistory', JSON.stringify(this.userHistory));
                        localStorage.setItem('currentMood', JSON.stringify(finalResult));

                        // Generar insights inteligentes
                        this.generateInsights();

                        // Cambiar música según la emoción
                        this.changeMusicByEmotion(finalResult.emotion);

                    } catch (e) {
                        console.error(e);
                        this.result = { emotion: 'neutral', score: 0.5, confidence: 0.3 };
                    }
                    finally { this.loading = false; }
                },
                generateInsights() {
                    if (this.userHistory.length < 3) return;

                    const recentEntries = this.userHistory.slice(-7); // Últimos 7 días
                    const emotionCounts = {};
                    let totalScore = 0;

                    recentEntries.forEach(entry => {
                        emotionCounts[entry.emotion] = (emotionCounts[entry.emotion] || 0) + 1;
                        totalScore += entry.score;
                    });

                    const avgScore = totalScore / recentEntries.length;
                    const dominantEmotion = Object.keys(emotionCounts).reduce((a, b) =>
                        emotionCounts[a] > emotionCounts[b] ? a : b
                    );

                    const insights = {
                        trend: avgScore > 0.6 ? 'positivo' : avgScore < 0.4 ? 'negativo' : 'neutral',
                        dominantEmotion: dominantEmotion,
                        pattern: this.detectEmotionalPattern(),
                        recommendation: this.getPersonalizedRecommendation(dominantEmotion, avgScore)
                    };

                    this.aiInsights = insights;
                },

                detectEmotionalPattern() {
                    if (this.userHistory.length < 5) return null;

                    const recent = this.userHistory.slice(-5).map(e => e.emotion);
                    const positiveEmotions = ['joy', 'love', 'gratitude', 'excitement', 'hopeful'];
                    const negativeEmotions = ['sadness', 'anger', 'fear', 'anxiety'];

                    const positiveCount = recent.filter(e => positiveEmotions.includes(e)).length;
                    const negativeCount = recent.filter(e => negativeEmotions.includes(e)).length;

                    if (positiveCount > negativeCount + 1) return 'mejorando';
                    if (negativeCount > positiveCount + 1) return 'empeorando';
                    return 'estable';
                },

                getPersonalizedRecommendation(dominantEmotion, avgScore) {
                    const recommendations = {
                        'sadness': 'Considera hablar con un profesional de salud mental. La terapia puede ayudarte a procesar estos sentimientos.',
                        'anxiety': 'Prueba técnicas de respiración profunda o meditación. El ejercicio regular también puede reducir la ansiedad.',
                        'anger': 'Encuentra formas saludables de expresar tu frustración, como ejercicio o arte.',
                        'fear': 'Recuerda que has superado desafíos antes. Eres más fuerte de lo que crees.',
                        'joy': '¡Qué maravilloso! Sigue cultivando estas emociones positivas.',
                        'love': 'El amor es una fuerza poderosa. Comparte estos sentimientos con quienes amas.',
                        'gratitude': 'La gratitud es una práctica transformadora. Mantén este hábito positivo.',
                        'hopeful': 'La esperanza es tu superpoder. Confía en el proceso de la vida.'
                    };

                    return recommendations[dominantEmotion] || 'Continúa siendo consciente de tus emociones y busca apoyo cuando lo necesites.';
                },

                generateEmpathyResponse(emotion, text) {
                    const name = this.name || "Amigo/a";
                    text = text.toLowerCase();

                    // DETECCIÓN DE CRISIS - RESPUESTAS URGENTES Y HUMANAS
                    const crisisKeywords = {
                        suicide: ['suicidio', 'suicidar', 'matarme', 'acabar con todo', 'no quiero vivir', 'terminar con mi vida', 'quitarse la vida'],
                        selfHarm: ['cortarme', 'lastimarme', 'herirme', 'dañarme', 'autolesión', 'dañarme a mí mismo'],
                        severeDepression: ['no puedo más', 'no aguanto', 'estoy acabado', 'sin esperanza', 'no hay salida', 'todo está perdido'],
                        crisis: ['crisis', 'emergencia', 'ayuda urgente', 'no sé qué hacer', 'desesperado', 'pánico total']
                    };

                    // Detectar crisis de suicidio
                    if (crisisKeywords.suicide.some(keyword => text.includes(keyword))) {
                        return `${name}, mi corazón se detiene al leer tus palabras. Lo que estás sintiendo es real y doloroso, pero también temporal. Por favor, por favor, busca ayuda inmediatamente. Llama al 911 o a la Línea de la Vida (800 911 2000) AHORA MISMO. No estás solo/a en esto. Tu vida tiene valor, aunque ahora no puedas verlo. Hay gente que te ama y profesionales que pueden ayudarte. Por favor, no hagas nada irreversible. Tu dolor es válido, pero hay formas de sanarlo. Te abrazo con todo mi corazón. 💔🤗`;
                    }

                    // Detectar autolesión
                    if (crisisKeywords.selfHarm.some(keyword => text.includes(keyword))) {
                        return `${name}, entiendo que el dolor que sientes es insoportable y que buscas formas de aliviarlo. Pero lastimarte no es la respuesta. Por favor, busca ayuda profesional inmediatamente. Puedes llamar al 911 o contactar a un terapeuta. Tu cuerpo y tu mente merecen cuidado y amor, no dolor. Hay formas más seguras de procesar estos sentimientos. No estás solo/a en esto. 💙🤗`;
                    }

                    // Detectar depresión severa
                    if (crisisKeywords.severeDepression.some(keyword => text.includes(keyword))) {
                        return `${name}, puedo sentir la profundidad de tu dolor en cada palabra. Cuando todo parece oscuro y sin esperanza, es difícil ver la luz, pero existe. Por favor, considera hablar con un profesional de salud mental. La depresión es una enfermedad real y tratable. No tienes que enfrentarla sola/o. Tu vida importa, tu dolor es válido, y hay ayuda disponible. Por favor, busca apoyo profesional hoy mismo. 💜`;
                    }

                    // Detectar crisis general
                    if (crisisKeywords.crisis.some(keyword => text.includes(keyword))) {
                        return `${name}, reconozco que estás en una crisis y que te sientes abrumado/a. Es valiente de tu parte expresarlo. En momentos así, es crucial buscar apoyo inmediato. Por favor, contacta a alguien de confianza, un profesional de salud mental, o llama a una línea de crisis. No tienes que enfrentar esto solo/a. Tu bienestar es prioritario. 🤗💙`;
                    }

                    // Detectar enfermedades graves (cáncer, etc.)
                    const healthCrisis = ['cáncer', 'tumor', 'quimioterapia', 'enfermedad terminal', 'diagnóstico grave', 'operación mayor'];
                    if (healthCrisis.some(keyword => text.includes(keyword))) {
                        return `${name}, mi corazón se llena de compasión al leer sobre la situación de salud que estás enfrentando. Es normal sentir miedo, rabia, tristeza y una mezcla de emociones intensas. No tienes que ser fuerte todo el tiempo. Permítete sentir lo que sientes. Busca apoyo en grupos de apoyo, terapeutas especializados en oncología, o consejeros espirituales. No estás solo/a en este camino. Cada día que luchas es un acto de valentía. Te acompaño con todo mi amor. 💙🕊️`;
                    }

                    // Detectar situaciones específicas para respuestas más personalizadas
                    const isLoss = text.includes("murió") || text.includes("falleció") || text.includes("muerte") || text.includes("perdí a");
                    const isAnxiety = text.includes("ansiedad") || text.includes("preocupado") || text.includes("nervioso") || text.includes("estrés");
                    const isLonely = text.includes("solo") || text.includes("sola") || text.includes("soledad") || text.includes("aislado");
                    const isSelfDoubt = text.includes("inútil") || text.includes("no sirvo") || text.includes("no valgo") || text.includes("fracaso");
                    const isRelationship = text.includes("pareja") || text.includes("novio") || text.includes("novia") || text.includes("relación");
                    const isWork = text.includes("trabajo") || text.includes("empleo") || text.includes("jefe") || text.includes("oficina");

                    // Respuestas contextuales más inteligentes y humanas
                    if (isLoss) return `${name}, lamento profundamente tu pérdida. Perder a alguien que amamos es uno de los dolores más profundos que podemos experimentar. Es completamente normal sentir que el mundo se ha detenido. No hay un tiempo "correcto" para sanar. Permítete llorar, recordar, y honrar a esa persona especial. El amor que sientes por ella/él nunca desaparecerá, solo se transformará. No estás solo/a en este dolor. Te abrazo con todo mi corazón. 💜🕊️`;

                    if (isAnxiety) return `${name}, puedo sentir cómo la ansiedad te está consumiendo. Es como tener una tormenta constante en tu mente, ¿verdad? Respira conmigo ahora: inhala lentamente por la nariz (1,2,3,4), mantén el aire (1,2,3,4), exhala suavemente por la boca (1,2,3,4,5,6). Repite esto tres veces. Recuerda: no tienes que controlar todo. Date permiso de vivir un día a la vez, un momento a la vez. Eres más fuerte de lo que crees, aunque ahora no lo sientas así. 🌿💙`;

                    if (isLonely) return `${name}, la soledad puede sentirse como un peso que te aplasta el pecho. Pero quiero que sepas algo importante: no estás realmente solo/a. Hay personas que te aman más de lo que imaginas. Usa este momento para reconectarte contigo mismo/a, para recordar quién eres realmente. Y cuando estés listo/a, extiende la mano hacia alguien. Pedir compañía no te hace débil, te hace humano. Eres valioso/a, importante, y mereces amor y conexión. 💫🤗`;

                    if (isSelfDoubt) return `${name}, escucha mi voz con atención: tu valor no se mide por tus logros, tus errores, o lo que otros piensen de ti. Tu valor es intrínseco, es parte de tu esencia. Eres único/a, irrepetible, y tienes algo especial que aportar al mundo que nadie más puede dar. Cuando la voz crítica en tu cabeza te ataque, recuerda: eres suficiente, tal como eres, en este momento exacto. Te amo y creo en ti. ❤️✨`;

                    if (isRelationship) return `${name}, las relaciones del corazón pueden ser nuestro mayor gozo y también nuestra mayor fuente de dolor. Es completamente normal sentir emociones intensas cuando amamos a alguien. Date tiempo para procesar lo que sientes. La comunicación honesta y compasiva es la base de cualquier relación sana. Recuerda que amar no significa perderte a ti mismo/a. Eres digno/a de amor y respeto. 🌹💕`;

                    if (isWork) return `${name}, entiendo la presión que puede generar el trabajo. Es fácil que se convierta en nuestra identidad, pero recuerda: tú no eres tu trabajo. Tu valor como persona trasciende cualquier logro profesional. Es importante encontrar equilibrio entre dedicación y autocuidado. Si el trabajo te está consumiendo, tal vez es momento de reevaluar prioridades. Tu bienestar emocional es más importante que cualquier trabajo. 🏢💙`;

                    // Usar historial para personalizar respuesta
                    if (this.userHistory.length > 0) {
                        const lastEmotion = this.userHistory[this.userHistory.length - 1]?.emotion;
                        if (lastEmotion === emotion && this.userHistory.length > 1) {
                            return `${name}, veo que has estado luchando con ${this.emotionMap[emotion]?.label.toLowerCase()} recientemente. Es increíblemente valiente de tu parte seguir compartiendo tus sentimientos, incluso cuando es difícil. Cada vez que expresas lo que sientes, das un paso más hacia la sanación. No te rindas. Estoy aquí contigo en este viaje. 💪🤗`;
                        }
                    }

                    // Respuesta estándar personalizada
                    const phrases = this.empathyPhrases[emotion] || this.empathyPhrases['neutral'];
                    return phrases[Math.floor(Math.random() * phrases.length)].replace('{name}', name);
                },
                activateAudioContext() {
                    // Activar el contexto de audio para evitar restricciones de autoplay
                    if (!this.audioContextActivated) {
                        try {
                            if (!this.currentAudioContext || this.currentAudioContext.state === 'closed') {
                                this.currentAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                            }

                            if (this.currentAudioContext.state === 'suspended') {
                                this.currentAudioContext.resume();
                            }

                            this.audioContextActivated = true;
                            console.log('Audio context activado');
                        } catch (e) {
                            console.log('Audio context no disponible:', e);
                        }
                    }
                },

                toggleMusic() {
                    if (this.isPlaying) {
                        this.stopAllMusic();
                    } else {
                        this.activateAudioContext();
                        this.startMusicByEmotion(this.result?.emotion || 'neutral');
                    }
                    this.isPlaying = !this.isPlaying;
                },

                startMusicByEmotion(emotion) {
                    this.stopAllMusic();
                    const musicConfig = this.musicSequences[emotion] || this.musicSequences['neutral'];
                    this.generateMelody(musicConfig);
                },

                stopAllMusic() {
                    if (this.ambientMusicInterval) {
                        clearInterval(this.ambientMusicInterval);
                        this.ambientMusicInterval = null;
                    }
                    if (this.currentAudioContext) {
                        this.currentAudioContext.close();
                        this.currentAudioContext = null;
                    }
                },

                generateMelody(config) {
                    try {
                        // Crear nuevo contexto de audio si no existe o está cerrado
                        if (!this.currentAudioContext || this.currentAudioContext.state === 'closed') {
                            this.currentAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                        }

                        const audioContext = this.currentAudioContext;

                        // Resumir el contexto si está suspendido
                        if (audioContext.state === 'suspended') {
                            audioContext.resume();
                        }

                        const playNote = (frequency, duration, delay = 0) => {
                            setTimeout(() => {
                                if (!this.isPlaying || audioContext.state === 'closed') return;

                                try {
                                    const oscillator = audioContext.createOscillator();
                                    const gainNode = audioContext.createGain();

                                    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                                    oscillator.type = this.getWaveType(config.pattern);

                                    // Configurar envolvente de volumen más suave
                                    const volume = this.musicVolume * 0.1; // Reducir volumen general
                                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                                    gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.05);
                                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);

                                    oscillator.connect(gainNode);
                                    gainNode.connect(audioContext.destination);

                                    oscillator.start(audioContext.currentTime);
                                    oscillator.stop(audioContext.currentTime + duration);
                                } catch (e) {
                                    console.log('Error reproduciendo nota:', e);
                                }
                            }, delay);
                        };

                        const playSequence = () => {
                            if (!this.isPlaying) return;

                            const beatDuration = 60000 / config.tempo; // duración en ms por beat
                            const frequencies = config.frequencies;

                            // Crear melodía basada en el patrón
                            switch (config.pattern) {
                                case 'major':
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration * 0.8, i * beatDuration * 0.5);
                                        playNote(freq * 1.25, beatDuration * 0.4, i * beatDuration * 0.5 + beatDuration * 0.4);
                                    });
                                    break;
                                case 'minor':
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration * 1.2, i * beatDuration * 0.8);
                                        playNote(freq * 0.8, beatDuration * 0.6, i * beatDuration * 0.8 + beatDuration * 0.6);
                                    });
                                    break;
                                case 'romantic':
                                    playNote(frequencies[0], beatDuration * 1.5, 0);
                                    playNote(frequencies[1], beatDuration * 1.5, beatDuration * 0.5);
                                    playNote(frequencies[2], beatDuration * 1.5, beatDuration * 1.0);
                                    playNote(frequencies[3], beatDuration * 1.5, beatDuration * 1.5);
                                    break;
                                case 'calming':
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration * 2, i * beatDuration * 1.5);
                                    });
                                    break;
                                case 'uplifting':
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration * 0.6, i * beatDuration * 0.3);
                                        playNote(freq * 1.5, beatDuration * 0.6, i * beatDuration * 0.3 + beatDuration * 0.3);
                                    });
                                    break;
                                case 'soothing':
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration * 3, i * beatDuration * 2);
                                        playNote(freq * 0.8, beatDuration * 2, i * beatDuration * 2 + beatDuration * 1.5);
                                    });
                                    break;
                                case 'hopeful':
                                    playNote(frequencies[0], beatDuration * 2, 0);
                                    playNote(frequencies[1], beatDuration * 2, beatDuration * 1);
                                    playNote(frequencies[2], beatDuration * 2, beatDuration * 2);
                                    playNote(frequencies[1], beatDuration * 2, beatDuration * 3);
                                    break;
                                default:
                                    frequencies.forEach((freq, i) => {
                                        playNote(freq, beatDuration, i * beatDuration * 0.6);
                                    });
                            }
                        };

                        // Reproducir secuencia inicial
                        playSequence();

                        // Repetir cada 8 segundos
                        this.ambientMusicInterval = setInterval(playSequence, 8000);

                    } catch (error) {
                        console.log('Error generando música:', error);
                        this.isPlaying = false;
                    }
                },

                getWaveType(pattern) {
                    const waveTypes = {
                        'major': 'triangle',
                        'minor': 'sine',
                        'power': 'sawtooth',
                        'mysterious': 'triangle',
                        'romantic': 'sine',
                        'calming': 'sine',
                        'uplifting': 'triangle',
                        'optimistic': 'triangle',
                        'balanced': 'sine',
                        'soothing': 'sine',
                        'hopeful': 'triangle'
                    };
                    return waveTypes[pattern] || 'sine';
                },

                changeMusicByEmotion(emotion) {
                    if (this.isPlaying) {
                        this.startMusicByEmotion(emotion);
                    }
                },

                updateVolume() {
                    // El volumen se maneja directamente en generateMelody
                    // No necesitamos el audio tag externo
                },

                nextTrack() {
                    if (this.result && this.result.emotion) {
                        this.changeMusicByEmotion(this.result.emotion);
                    }
                },
                async saveAsImage() {
                    const element = document.getElementById('captureArea');
                    try {
                        const canvas = await html2canvas(element, { backgroundColor: null, scale: 2 });
                        const link = document.createElement('a');
                        link.download = `espacio-seguro-${this.name}.jpg`;
                        link.href = canvas.toDataURL('image/jpeg', 0.95);
                        link.click();
                    } catch (e) { console.error(e); alert('Hubo un error al guardar la imagen.'); }
                },
                reset() {
                    this.feeling = '';
                    this.submitted = false;
                    this.result = null;
                    this.$nextTick(() => { if (this.$refs.feelingInput) this.$refs.feelingInput.focus(); });
                },
                speakMessage(message) {
                    if (!('speechSynthesis' in window)) return;
                    const utterance = new SpeechSynthesisUtterance(message);
                    utterance.lang = 'es-ES';
                    window.speechSynthesis.cancel();
                    window.speechSynthesis.speak(utterance);
                },

                getSmartSuggestions() {
                    if (!this.result) return [];

                    const emotion = this.result.emotion;
                    const suggestions = {
                        'sadness': [
                            '🎵 Escucha música que te haga sentir acompañado/a',
                            '📖 Lee algo inspirador o que te guste',
                            '🌱 Sal a caminar al aire libre, aunque sea por 10 minutos',
                            '📞 Llama a alguien en quien confíes para hablar',
                            '💧 Toma un baño relajante o una ducha caliente'
                        ],
                        'anxiety': [
                            '🫁 Practica la respiración 4-7-8: inhala 4, mantén 7, exhala 8',
                            '🧘 Prueba meditación guiada de 5 minutos',
                            '🏃‍♀️ Haz ejercicio ligero para liberar endorfinas',
                            '📝 Escribe tus preocupaciones para organizar tus pensamientos',
                            '🎨 Colorea o dibuja para calmar tu mente'
                        ],
                        'anger': [
                            '👊 Golpea una almohada de forma segura',
                            '🏃‍♂️ Sal a correr o haz ejercicio intenso',
                            '🎵 Escucha música que te relaje',
                            '🌊 Ve a un lugar con agua (playa, lago, río)',
                            '💬 Habla con alguien de confianza sobre lo que sientes'
                        ],
                        'fear': [
                            '📝 Escribe lo que te asusta y por qué',
                            '🫂 Abraza a alguien cercano o abraza una almohada',
                            '🎬 Mira algo divertido que te distraiga',
                            '🏠 Crea un espacio seguro y cómodo para ti',
                            '💪 Recuerda momentos difíciles que ya superaste'
                        ],
                        'joy': [
                            '🎉 Comparte tu felicidad con alguien más',
                            '📸 Toma una foto para recordar este momento',
                            '🎵 Baila con tu música favorita',
                            '🌟 Haz algo bueno por otra persona',
                            '📝 Escribe en un diario de gratitud'
                        ],
                        'love': [
                            '💌 Expresa tu amor a quien amas',
                            '🌹 Haz algo especial para tu ser querido',
                            '📸 Crea recuerdos juntos',
                            '💝 Escribe una carta de amor',
                            '🎨 Crea algo hermoso que represente tu amor'
                        ],
                        'gratitude': [
                            '📝 Escribe 3 cosas por las que estás agradecido hoy',
                            '📞 Llama a alguien para agradecerle',
                            '🎁 Haz algo bueno por otra persona',
                            '🌱 Practica la gratitud hacia ti mismo/a',
                            '🌟 Comparte tu gratitud en redes sociales'
                        ]
                    };

                    return suggestions[emotion] || [
                        '🌱 Cuida de ti mismo/a hoy',
                        '💧 Mantente hidratado/a',
                        '😴 Asegúrate de dormir bien',
                        '🍎 Come algo nutritivo',
                        '🧘 Tómate 5 minutos para respirar'
                    ];
                },

                viewHistory() {
                    this.showHistoryModal = true;
                },

                closeHistoryModal() {
                    this.showHistoryModal = false;
                },

                clearHistory() {
                    if (confirm('¿Estás seguro/a de que quieres eliminar todo tu historial emocional? Esta acción no se puede deshacer.')) {
                        this.userHistory = [];
                        localStorage.removeItem('emotionHistory');
                        localStorage.removeItem('currentMood');
                        alert('Historial eliminado. Tus datos están seguros y privados.');
                    }
                },

                exportData() {
                    const data = {
                        name: this.name,
                        history: this.userHistory,
                        exportDate: new Date().toISOString(),
                        version: '2.0'
                    };

                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `historial-emocional-${this.name}-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },

                formatDate(timestamp) {
                    const date = new Date(timestamp);
                    return date.toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },

                getUniqueEmotions() {
                    const emotions = [...new Set(this.userHistory.map(entry => entry.emotion))];
                    return emotions;
                },

                getDaysActive() {
                    const dates = [...new Set(this.userHistory.map(entry =>
                        new Date(entry.timestamp).toDateString()
                    ))];
                    return dates.length;
                },

                getMostFrequentEmotion() {
                    if (this.userHistory.length === 0) return 'No hay datos';

                    const emotionCounts = {};
                    this.userHistory.forEach(entry => {
                        emotionCounts[entry.emotion] = (emotionCounts[entry.emotion] || 0) + 1;
                    });

                    const mostFrequent = Object.keys(emotionCounts).reduce((a, b) =>
                        emotionCounts[a] > emotionCounts[b] ? a : b
                    );

                    return `${this.emotionMap[mostFrequent]?.emoji} ${this.emotionMap[mostFrequent]?.label}`;
                },

                getOverallTrend() {
                    if (this.userHistory.length < 3) return 'Necesitas más datos';

                    const recent = this.userHistory.slice(-5);
                    const positiveCount = recent.filter(e =>
                        ['joy', 'love', 'gratitude', 'excitement', 'hopeful'].includes(e.emotion)
                    ).length;
                    const negativeCount = recent.filter(e =>
                        ['sadness', 'anger', 'fear', 'anxiety'].includes(e.emotion)
                    ).length;

                    if (positiveCount > negativeCount + 1) return '📈 Mejorando';
                    if (negativeCount > positiveCount + 1) return '📉 Necesita atención';
                    return '📊 Estable';
                },

                getProgressMessage() {
                    if (this.userHistory.length < 2) return 'Comienza tu viaje';

                    const firstEntry = this.userHistory[0];
                    const lastEntry = this.userHistory[this.userHistory.length - 1];

                    const firstScore = firstEntry.score;
                    const lastScore = lastEntry.score;

                    if (lastScore > firstScore + 0.2) return '🎉 ¡Excelente progreso!';
                    if (lastScore < firstScore - 0.2) return '💪 Sigue trabajando en ti';
                    return '🌟 Mantén la constancia';
                }
            }
        }).mount('#app');

        // === ENHANCEMENT: Ampliación emocional y empática ===

        if (typeof emotionMap !== "undefined") {
            Object.assign(emotionMap, {
                serenity: { label: "Serenidad", emoji: "🌿", color: "#76D7C4", type: "positive" },
                gratitude: { label: "Gratitud", emoji: "🙏", color: "#27AE60", type: "positive" },
                pride: { label: "Orgullo", emoji: "💪", color: "#FFB86B", type: "positive" },
                compassion: { label: "Compasión", emoji: "🤝", color: "#F7DC6F", type: "positive" },
                tenderness: { label: "Ternura", emoji: "🫶", color: "#FAD7A0", type: "positive" },
                curiosity: { label: "Curiosidad", emoji: "🧐", color: "#7FB3D5", type: "neutral" },
                boredom: { label: "Aburrimiento", emoji: "😐", color: "#BDC3C7", type: "neutral" },
                guilt: { label: "Culpa", emoji: "😓", color: "#CD6155", type: "negative" },
                shame: { label: "Vergüenza", emoji: "😳", color: "#A569BD", type: "negative" },
                envy: { label: "Envidia", emoji: "😒", color: "#82E0AA", type: "negative" },
                jealousy: { label: "Celos", emoji: "🧿", color: "#58D68D", type: "negative" },
                relief: { label: "Alivio", emoji: "😌", color: "#7BD389", type: "positive" },
                nostalgia: { label: "Nostalgia", emoji: "🕰️", color: "#E7C9FF", type: "neutral" },
                fatigue: { label: "Cansancio", emoji: "😴", color: "#AAB7B8", type: "negative" },
                overwhelm: { label: "Abrumado/a", emoji: "😵", color: "#85C1E9", type: "negative" },
                loneliness: { label: "Soledad", emoji: "😔", color: "#95A5A6", type: "negative" },
                hope: { label: "Esperanza", emoji: "🌟", color: "#3498DB", type: "positive" },
                vulnerability: { label: "Vulnerabilidad", emoji: "🫂", color: "#BB8FCE", type: "neutral" },
                trust: { label: "Confianza", emoji: "🤝", color: "#5DADE2", type: "positive" }
            });
        }

        if (typeof empathyPhrases !== "undefined") {
            Object.assign(empathyPhrases, {
                serenity: [
                    "Qué bonito que sientas serenidad, {{name}}. Ese equilibrio interior es un tesoro.",
                    "Disfruta esta calma, {{name}}. Te mereces cada segundo de tranquilidad.",
                    "Sentir paz interior es una señal de que estás conectando contigo mismo."
                ],
                gratitude: [
                    "La gratitud abre puertas, {{name}}. Gracias por compartir ese sentir.",
                    "Agradecer lo que tenemos cambia la forma en que miramos el mundo.",
                    "Me alegra que reconozcas la belleza en las cosas simples, {{name}}."
                ],
                pride: [
                    "Puedes sentirte muy orgulloso/a, {{name}}. Has recorrido un camino importante.",
                    "Ese logro merece ser celebrado, {{name}}. Aplaude tu esfuerzo.",
                    "El orgullo propio es una semilla de autoestima. Cuídala con amor."
                ],
                compassion: [
                    "Qué bonito verte conectar desde la compasión, {{name}}.",
                    "Tu capacidad de empatía refleja una gran fortaleza emocional.",
                    "Ser compasivo no es debilidad, es valentía del corazón."
                ],
                curiosity: [
                    "Tu curiosidad te lleva lejos, {{name}}. Nunca dejes de explorar.",
                    "Preguntarte cosas nuevas demuestra tu mente abierta.",
                    "Qué bonito tener hambre de aprender, {{name}}."
                ],
                nostalgia: [
                    "La nostalgia tiene algo dulce, {{name}}. Es señal de amor por lo vivido.",
                    "Recordar el pasado con ternura es una forma de agradecer lo que fue.",
                    "Tus recuerdos siguen siendo parte de ti, {{name}}."
                ],
                guilt: [
                    "La culpa puede ser dura, {{name}}, pero también puede guiarte al perdón.",
                    "Perdónate como perdonarías a alguien que amas.",
                    "Todos cometemos errores; lo importante es lo que aprendes de ellos."
                ],
                loneliness: [
                    "Gracias por compartir tu soledad, {{name}}. No estás solo/a en esto.",
                    "A veces, reconocer la soledad es el primer paso para volver a conectar.",
                    "Tu deseo de compañía es una señal hermosa de humanidad."
                ],
                relief: [
                    "Qué alivio sentir eso, {{name}}. Deja que tu cuerpo descanse y agradezca.",
                    "Por fin un respiro, {{name}}. Te lo ganaste.",
                    "Disfruta esta ligereza, tu mente también necesita espacios así."
                ],
                fatigue: [
                    "Descansa, {{name}}. Estar cansado no te hace débil, te hace humano.",
                    "Escucha a tu cuerpo, {{name}}. A veces solo necesita pausa.",
                    "No puedes con todo a la vez, y está bien. Mereces parar."
                ],
                hope: [
                    "La esperanza es una chispa, {{name}}. No dejes que se apague.",
                    "Tu mirada hacia adelante inspira. Sigue confiando.",
                    "Incluso en la noche más oscura, hay una estrella esperándote."
                ]
            });
        }

        if (typeof detectEmotionFromKeywords === "function") {
            const originalDetector = detectEmotionFromKeywords;
            detectEmotionFromKeywords = function (text) {
                text = text.toLowerCase();
                const extendedKeywords = {
                    gratitude: ["gracias", "agradecido", "bendecido", "valorar", "afortunado"],
                    serenity: ["calma", "serenidad", "paz", "tranquilidad"],
                    curiosity: ["curioso", "interesado", "descubrir", "explorar"],
                    nostalgia: ["recuerdo", "extraño", "añoro", "pasado", "melancolía"],
                    pride: ["orgullo", "logro", "capaz", "satisfecho"],
                    guilt: ["culpa", "arrepentido", "me equivoqué", "fallé"],
                    fatigue: ["cansado", "agotado", "sin fuerzas", "dormir"],
                    loneliness: ["solo", "sola", "aislado", "sin compañía"],
                    compassion: ["compasión", "empatía", "comprensión", "ayuda"],
                    relief: ["alivio", "descanso", "tranquilo", "por fin"],
                    hope: ["esperanza", "optimismo", "confío", "creer", "adelante"]
                };
                for (const [emotion, words] of Object.entries(extendedKeywords)) {
                    if (words.some(w => text.includes(w))) return emotion;
                }
                return originalDetector(text);
            };
        }

        console.log("✨ script.js enriquecido con más emociones y frases humanas ✨");
    </script>

</body>

</html>
